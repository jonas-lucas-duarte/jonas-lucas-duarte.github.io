<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <title>Workbench</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="0">
        <!-- imported -->
        <!--basic styles-->
        <link href="main_data/bootstrap.css" rel="stylesheet">
        <link href="main_data/bootstrap-responsive.css" rel="stylesheet">
        <link rel="stylesheet" href="main_data/font-awesome.css">
        <!--[if IE 7]>
        <link rel="stylesheet"
              href="../shared/ace/assets/css/font-awesome-ie7.min.css"/>
        <![endif]-->
        <!--page specific plugin styles-->
        <link rel="stylesheet" href="main_data/jquery-ui-1.css">
        <link rel="stylesheet" href="main_data/jquery.css">
        <link rel="stylesheet" href="main_data/colorbox.css">
        <!--fonts-->
        <link rel="stylesheet" href="main_data/ace-fonts.css">
        <!--ace styles-->
                    <link rel="stylesheet" href="main_data/chosen.css">
            <link rel="stylesheet" href="main_data/ace.css">
            <link rel="stylesheet" href="main_data/ace-responsive.css">
            <link rel="stylesheet" href="main_data/ace-skins.css">
            <link rel="stylesheet" href="main_data/datepicker.css">
            <link rel="stylesheet" href="main_data/jsPanel.css">
            <!-- Add the slick-theme.css if you want default styling -->
            <link rel="stylesheet" type="text/css" href="main_data/slick.css">
            <link rel="stylesheet" type="text/css" href="main_data/slick-theme.css">
                <!--[if lte IE 8]>
        <link rel="stylesheet" href="../shared/ace/assets/css/ace-ie.min.css"/>
        <![endif]-->
        <!-- Vocareum styles -->
        <link rel="stylesheet" href="main_data/vocareum.css">
        <script src="main_data/localStorage.js"></script>
        <!-- js start -->
        <!-- jquery start -->
        <!--[if !IE]>-->
        <script type="text/javascript">
          window.jQuery || document.write("<script src='../shared/ace/assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
        </script><script src="main_data/jquery-2.js"></script>
        <!--<![endif]-->
        <!--[if IE]>
        <script type="text/javascript">
            window.jQuery || document.write("<script src='../shared/ace/assets/js/jquery-1.10.2.min.js'>" + "<" + "/script>");
        </script>
        <![endif]-->
        <script type="text/javascript">
          if ("ontouchend" in document) document.write("<script src='../shared/ace/assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
        </script>
        <script src="main_data/jquery-ui-1.js"></script>
        <script src="main_data/jquery_007.js"></script>
        <script src="main_data/jquery_006.js"></script>
        <script src="main_data/fuelux.js"></script>
        <script src="main_data/jquery_004.js"></script>
        <!-- jquery end -->
        <!-- js end -->
        <script src="main_data/bootstrap.js"></script>
        <script src="main_data/ace.js"></script>
        <script src="main_data/ace-extra.js"></script>
        <script src="main_data/bootbox.js"></script>
        <script src="main_data/jquery_008.js"></script>
        <script src="main_data/chosen.js"></script>
        <script src="main_data/bootstrap-datepicker.js"></script>
        <script src="main_data/bootstrap-tag.js"></script>
        <script src="main_data/jquery_005.js"></script>
        <script src="main_data/additional-methods.js"></script>
        <script src="main_data/jquery_003.js"></script>
        <script src="main_data/jquery_002.js"></script>
        <!-- Golden Layout Dependencies -->
        <script src="main_data/goldenlayout.js"></script>
        <script src="main_data/goldenlayout_002.js"></script>
        <link rel="stylesheet" href="main_data/goldenlayout-base.css">
        <link rel="stylesheet" href="main_data/goldenlayout-light-theme.css">
        <style>
            html,
            body {
                height: 100%;
                font-size: 95%;
                background-color: rgb(255, 255, 255) !important;
            }

            .vocbtn-round-corner {
                border-radius: 3px !important;
                margin: 0 5px 2px 0px !important;
            }

            #wrap {
                min-height: 100%;
                height: auto !important;
                height: 100%;
                /* Negative indent footer by it's height */
                margin: 0 auto -30px;
            }

            /* Set the fixed height of the footer here */
            #push,
            #footer {
                height: 30px;
                position: fixed;
            }

            #footer {
                background-color: #333;
                color: #ccc;
            }

            /* Lastly, apply responsive CSS fixes as necessary */
            @media (max-width: 767px) {
                #footer {
                    margin-left: -20px;
                    margin-right: -20px;
                    padding-left: 20px;
                    padding-right: 20px;
                }
            }

            /* one more CSS fixes as necessary */
            @media (max-width: 979px) {
                #page-content {
                }
            }


            /* Custom page CSS
            -------------------------------------------------- */
            /* Not required for template or sticky footer method. */

            #wrap > .container {
                padding-top: 60px;
            }

            .container .credit {
                margin: 20px 0;
            }

            code {
                font-size: 80%;
            }

            .dropdown-menu > li > div:hover,
            .dropdown-menu > li > div:focus {
                color: #ffffff;
                text-decoration: none;
                background-color: #0081c2;
                background-image: -moz-linear-gradient(top, #0088cc, #0077b3);
                background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#0088cc), to(#0077b3));
                background-image: -webkit-linear-gradient(top, #0088cc, #0077b3);
                background-image: -o-linear-gradient(top, #0088cc, #0077b3);
                background-image: linear-gradient(to bottom, #0088cc, #0077b3);
                background-repeat: repeat-x;
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff0088cc', endColorstr='#ff0077b3', GradientType=0);
            }

            .dropdown-menu > li > div {
                display: block;
                padding: 3px 20px;
                clear: both;
                font-weight: normal;
                line-height: 20px;
                color: #333333;
                white-space: nowrap;
            }

            .ace-nav > li > div {
                position: relative;
                color: #EEE;
                display: block;
                height: 100%;
                padding: 0 8px !important;
                background-color: transparent;
            }

            .ace-nav > li > div > [class*="icon-"] {
                font-size: 16px;
                color: #EEE;
                display: inline-block;
                width: 20px;
                text-align: center;
            }

            .tree .tree-selected > [class*="icon-"]:first-child {
                color: 0 !important;
            }

        </style>

        <style>
            .spinner-preview {
                width: 100px;
                height: 100px;
                text-align: center;
                margin-top: 60px;
            }

            .dropdown-preview {
                margin: 0 5px;
                display: inline-block;
            }

            .dropdown-preview > .dropdown-menu {
                display: block;
                position: static;
                margin-bottom: 5px;
            }

            .btn-group > .btn,
            .btn-group + .btn {
                margin: 0 1px 0 0;
                border-width: 1px !important;
            }

            /*
            .alert {
              color: black;
            }
            */

            .alert-success {
                color: #155724 !important;
            }

            .alert-error, .alert-danger {
                color: #721c24 !important;
            }

            .alert-warning {
                color: #856404 !important;
            }

            .chosen-container-single .chosen-default {
                color: black;
            }

            .vocbtn-ac {
                border-radius: 3px !important;
                padding: 1px 12px !important;
                margin: 0 8px 5px 0px !important;
                min-width: 60px !important;
                line-height: 30px !important;
                border-width: 1px !important;
            }

            .vocbtn2 {
                border-radius: 3px !important;
                padding: 1px 8px !important;
                margin: 0 8px 5px 0px !important;
                margin: 0 0px 0 0px !important;
                min-width: 40px !important;
                line-height: 30px !important;
                border-width: 1px !important;
            }

            .vocbtn-action {
                background: none repeat scroll 0% 0% rgb(0, 109, 204) !important;
                border-color: rgb(0, 109, 204) !important;
            }

            .vocbtn-action:hover, .vocbtn-primary:focus {
                background: none repeat scroll 0% 0% rgb(0, 109, 204) !important;
                border-color: rgb(0, 109, 204) !important;
            }

            .vocbtn-status {
                background: #f5f5f5 !important;
                text-shadow: 0 0 0 !important;
                color: #2D3B45 !important;
                border: 1px solid !important;
                border-color: #C7CDD1 !important;
            }

            .vocbtn-status:hover, .vocbtn-default:focus {
                background: #C7CDD1 !important;
            }

            .table-header {
                background-color: #394B58 !important;
            }

            .tree .tree-item, .tree .tree-folder .tree-folder-header {
                color: black;
            }

            .voc-link, .breadcrumb li a {
                color: rgb(32, 57, 157);
            }

            .table thead tr {
                color: #000 !important;
            }

            .breadcrumb li, .breadcrumb li .divider {
                color: #000 !important;
            }

            .loadinggif {
                display: block;
                position: absolute;
                flex: none;
                top: 0;
                margin-top: 45px;
                padding-top: -45px;
                left: 0;
                z-index: 50;
                width: 100vw;
                height: 90vh;
                background-color: #fff;
                background-image: url("../shared/img/vocpacifier.gif");
                background-size: 20%;
                background-repeat: no-repeat;
                background-position: center;
        </style>
        <script type="text/javascript">
          function removeSpinner(){
            $("#loader").remove();
          }
        </script>
    </head>
    <body onload="removeSpinner()">
        
        <script type="text/javascript">
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }


      
      /* for CSRF tokens */
      /* NOTE: ajaxPreFilter works better than the ajaxSetup where ajax happens when form.serialize is called */
      var csrfToken = "XNq%2FfFNUfQ7fTY32Uz71Ew%3D%3D";
      $.ajaxPrefilter(function (options, originalData, xhr) {
        if (options.data) {
          if (options.data instanceof FormData) {
            //let the form send the vockey
          } else {
            try {
              pdata = JSON.parse(options.data);
              pdata['vockey'] = csrfToken;
              options.data = JSON.stringify(pdata);
            } catch (e) {
              options.data += "&vockey=" + csrfToken;
            }
          }
        } else {
          options.data = "vockey=" + csrfToken;
        }
      });

      /*
      $('form').submit(function(){
        $(this).append("<input type='hidden' name='vockey' value='"+csrfToken+"' />");
        return true;
      });
      $.ajaxSetup({
        data: {
            vockey: csrfToken
        }
      });
      */

      function refreshNewSessionPage() {
        var url = window.location.href;
        var msg = 'Redirected+to+newly+logged+in+session.+Please+retry+the+operation';
        if (url.indexOf('?') > -1) {
          url += '&w=' + msg;
        } else {
          url += '?w=' + msg;
        }
        window.location.href = url;
      }
    </script>

                <div class="clearfix">

                
            <!-- moved to different functions -->
            

            
            <div id="page-content" class="clearfix" style="background-color:rgb(255,255,255);margin: 5px 10px 0px 10px;">
                <div class="row-fluid">
                    

                    
                    
                    
                    <script src="main_data/jquery_009.js"></script>


                    
                    <!-- Displays Maintenance Banner on top of page -->
                                        <!-- PAGE CONTENT BEGINS HERE -->
                    

<script>
     function showdbDetail(host,port,name,pwd){
       var target = document.getElementById("report_db_msg_box");
       target.innerHTML = "<strong>Host:</strong>" + host + '<br>' +
                          "<strong>Port:</strong>" + port + '<br>';
       if(name!='') target.innerHTML +=
                          "<strong>Name:</strong>" + name + '<br>';
        target.innerHTML += pwd;
       $("#modal-table-report-db").modal("show");
     }
	function show_voc_gritter($sticky, $msg, failed) {
		if (failed) {
			color_string = "gritter-error gritter-light";

		} else {
			color_string = "gritter-note gritter-light";
		}
		var duration = 2000;
		// if ($sticky) $duration = 10000;
		
		$.extend($.gritter.options, {
			position: 'bottom-right'
		});
		$.gritter.add({
			title: $msg,
			time: 2000,
			sticky: $sticky,
			class_name: color_string	
		});
	}

	function show_voc_gritter_duration($sticky, $msg, failed, duration) {
		if (failed) {
			color_string = "gritter-error gritter-light";

		} else {
			color_string = "gritter-note gritter-light";
		}
		$.extend($.gritter.options, {
			position: 'bottom-right'
		});
		$.gritter.add({
			title: $msg,
			time: duration,
			sticky: $sticky,
			class_name: color_string	
		});
	}

        var advance_features = "1";

        function show_grades(panel, fullwidth) {
            // mhui
            var jde = false;
            var rde = false;

            if (panel == 0)
            {
            	$('#grades-modal').modal('show');
            	return;
            }
            var element =  document.getElementById('gradeframe');
        	if (element == null || typeof(element) == 'undefined')
        	{
        		$('#grades-modal').modal('show');
        		return;
        	}

            // show the grade panel
            document.getElementById('gradeframe').style.display = "block";
            document.getElementById('gradeframedivider').style.display = "block";

            if (fullwidth) {
              document.getElementById('gradeframe').style.width = "100%";
              document.getElementById('gradeframe').style.height = "100vh";
              document.getElementById('gradeframedivider').style.display = "none";
              document.getElementById('gradeframehide').style.display = "none";
              document.getElementById('gradedetails').style.display = "block";
            }

            // mhui
            if (jde || rde) {
              $('#jupyterIframeParent').width(document.getElementById('gradeframedivider').offsetLeft-5);

           	  // hack to fix the grade panel height in jidebox
              $('#gradeframe').height($('#jidebox').height()-50);
              $('#gradeframedivider').height($('#jidebox').height()-50);
            }

              var gradesPanel = $('#grades-panel'),
                  gradesPanelIframe = gradesPanel.find('iframe'),
                  gradesSpinner = gradesPanel.find('#gradespinner');

              gradesSpinner.removeClass('hidden-1');
              var url = 'main.php?m=grades_review&modalMode=1&asnId=890069&stepid=890070&userid=1975667';
                                              gradesPanelIframe.prop('src', url);

              gradesPanelIframe.on('load', function() {
                gradesSpinner.addClass('hidden-1');
              });
          }
</script>




<div class="breadcrumbs  hidden-1" style="float: left; position: absolute; background-color:transparent; border-bottom:0px">
  <ul class="breadcrumb voctext" id="breadcrumb" style="margin-left: 12px !important;">
    <li>
      <span id="breadcrumb-user-link" class=" hidden-1"></span>
    </li>
    <li class="liprojbc">
      <span class="divider  hidden-1">/</span>
      <span id="breadcrumb-proj-link" class=" hidden-1"><span class="use-pointer" style="color: rgb(32, 57, 157);" onclick="location.href='main.php?m=course&amp;code=vc_2_0_05042022org265_326&amp;step=890069'" tabindex="0" role="button">Lab 1 -  Introduction to AWS IAM</span></span>
    </li> <!-- proj end -->
    
    
  </ul>
  <!-- TODO: cleanup -->
  <div class="pull-right" id="breadcrumb-step-status">
  </div>		
</div>

<script type="text/javascript">	
  var vocdomain = document.domain.split('.').slice(-2).join('.')
  document.domain = vocdomain;

  //mhui
  var clabsamis = [];

  function updateClusterAMIs()
  {
	  $('#clabstbl tr').each(function (i, row) {
          var myrow = $('#clabstbl tr:eq(' + i + ')');
          if (i > 0)
          {
              myrow.find('td:eq(7)').html('<select style="width:100px;margin-bottom:0px;" onchange="chgvm(' + i + ')">'+ $('#clabsamis').html()+'</select>');
              myrow.find('td:eq(7) select').val(clabsobj[i-1]['ami']);
          }
        });  
  }
  
  function retrieveOrgAMIs()
  {
    var orgid = 237;
    var labtype = "ct";

    var jqxhr = $.ajax('../util/vcput.php?a=getClusterAmisForOrg'
                     + '&orgid='  + orgid)
                 .done(function(data, textStatus, jqXHR) {
                   //console.log(data);
                   try {
             	     var result = JSON.parse(data);
                     if (result['status'] == 'Error') {
                       //alert("Unable to retrieve ami list: " + result['msg'])
                     }
                     else {
                       var foundSelected = false;
                       if (typeof(result['amis']) !== undefined)
                       {
                    	   clabsamis = result['amis']
                         var select = document.getElementById("clabsamis");
                         select.options.length = 0;
                         select.options[select.options.length] = new Option('', '');
                         for (index in clabsamis)
                         {
                           select.options[select.options.length] = new Option(clabsamis[index], index);
                           if (index == "")
                           {
                             //console.log("Index = " + index);
                             select.value = index;
                             foundSelected = true;
                           }
                         }              
                       }
                       if (foundSelected === false)
                       {
                         select.value = '';
                       }
                       if (labtype == 'cl') // update the AMI dropdowns
                       {
                         chgvmtype();
                         //updateClusterAMIs();
                       }
                     }
                   }
                   catch (err) {
                     //alert("Exception retrieving ami list: " + err)
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   //alert("Error retrieving ami list");
                 });
  }


  function endawslabconfirmed(v) {
       //awslabtimer('');
     if(v) $('#endawslab').html('End Lab <i id="awsbtnspinbox" class="icon-spin icon-spinner"></i>');
     $.ajax({
        url: "../util/vcput.php?a=endaws&stepid=890070&version=0&mode=s&type=1",
     })
     .done(function(ret_val) {
        var result = JSON.parse(ret_val);
        var end_lab_status = result['status'];
        ret_val = result['msg'];
         
         if(end_lab_status == 'success') {awslabtimer('');}
         
         var lb = document.getElementById("aws-modal-label");
         lb.innerHTML = 'End Lab';
         var target = document.getElementById("report_aws_msg_box");
         target.innerHTML = ret_val;
         var progress = document.getElementById('report_aws_progress_box');
         progress.innerHTML = '';
         $('#modal-table-report-aws').appendTo("#editordiv");
         $('#modal-table-report-aws').modal('show');
         $('#detailspinbox').hide();
         if(v) $('#endawslab').html('End Lab');
      })
     .fail(function(ret_val) {
       alert('failed to end the lab');
       $('#detailspinbox').hide();
       if(v) $('#endawslab').html('End Lab');
     });
     }
  function endawslab(v) {
        bootbox.dialog('Are you sure you want to end the lab?',
        [
          {
            "label" : "Yes",
            "class" : "btn vocbtn-ac vocbtn-action",
            "callback": function() {
              endawslabconfirmed(v);
            }
          },
          {
            "label" : "No",
            "class" : "btn vocbtn-ac vocbtn-status"
          }
        ]);
    }
  function awslabchkdone() {
         $.ajax({
        url: "../util/vcput.php?a=labready&stepid=890070&version=0&mode=s&type=1",
     })
     .done(function(ret_val) {
         var target = document.getElementById('report_aws_progress_box');
         target.innerHTML = ret_val;
         if( ret_val.search(/ready/)>=0 ){
           $('#detailspinbox').hide();
           $('#startawslab').html('Start Lab');
         } else if (ret_val.search(/in creation/)>=0 ) {
           target.innerHTML = '<i class="icon-spin icon-spinner"></i>' + target.innerHTML;
           window.setTimeout(awslabchkdone, 10000); 
         } else {
           $('#detailspinbox').hide();
           $('#startawslab').html('Start Lab');
           if (ret_val.search(/failed/)>=0 ) {
             show_voc_gritter(true, ret_val, true);
           }
         }
      })
     .fail(function(ret_val) {
       alert('failed to check the lab status');
       $('#detailspinbox').hide();
       $('#startawslab').html('Start Lab');
     }); 
     }
  function startawslab(v) {
        if(v) $('#startawslab').html('Start Lab <i id="awsbtnspinbox" class="icon-spin icon-spinner"></i>');
     $.ajax({
        url: "../util/vcput.php?a=startaws&stepid=890070&version=0&mode=s&type=1",
     })
     .done(function(ret_val) {
         var result = JSON.parse(ret_val);
         var lab_status = result['status'];
         ret_val = result['msg'];

         var lb = document.getElementById("aws-modal-label");
         lb.innerHTML = 'Start Lab';
         var target = document.getElementById("report_aws_msg_box");
         target.innerHTML = ret_val;
         document.getElementById('report_aws_progress_box').innerHTML = '';
         var progress = document.getElementById('report_aws_progress_box');
         progress.innerHTML = '';
         $('#modal-table-report-aws').appendTo("#editordiv");
         $('#modal-table-report-aws').modal('show');
         $('#detailspinbox').hide();
         awslabtimer(ret_val);
                  if(awsscnt>0 && v ) window.setTimeout(awslabchkdone, 1000);
         if(!awsscnt && v) $('#startawslab').html('Start Lab');
      })
     .fail(function(ret_val) {
       alert('failed to start the lab');
       $('#detailspinbox').hide();
       if(v) $('#startawslab').html('Start Lab');
     });
     }
         // awssX -- session
       // awsbX -- budget
       // awscX -- credential
       var awsstatus = [];
       var awsscnt = false;
       var awsccnt = false;
       var awsbcnt = false;
       var awstype = 'S';
       var awshandle = false;
       var awsstime = new Date().getTime();
       awsstime = Math.round( awsstime/1000 );
       function vcInsertSpace(s, type)
       { // make sure we have 11 chars;
         var str = '';
         str+='&nbsp;';
         return str;
       }
       function awscoundown()
       {
         if( awsscnt===false ){
           awsscnt = 0;
                    $.ajax({
               url: "../util/vcput.php?a=getaws&nores=1&stepid=890070&version=0&mode=s&type=1",
             })
             .done(function(ret_val) {
                var emid = document.getElementById('vocuseremail');
                if( emid ){
                  emid.innerHTML = "jonas.lima33@aluno.ce.gov.br";
                }
                if( ret_val.search(/(Cloud|VM) (Lab|Access)/)>=0 ){
                  awslabtimer(ret_val);
                } else if( ret_val.search(/Remaining session time: /)>=0 ){
                  var tv = ret_val.match(/Remaining session time: ([0-9]+h)?([0-9]+m)?([0-9]+s)/);
                  awsscnt = 0;
                  if( tv ){
                    if( tv[1] ) awsscnt = 3600 * parseInt(tv[1]);
                    if( tv[2] ) awsscnt += 60*parseInt(tv[2]);
                    if( tv[3] ) awsscnt += parseInt(tv[3]);
                  }
                  if( awshandle ) clearTimeout(awshandle);
                  awshandle = window.setTimeout(awscoundown , 300);
                }
                // get the startercode term
                if( ret_val.search(/Term: /) >= 0 ){
                  var tv = ret_val.match(/Term: ([0-9]+ day[s]? )?([0-9]+):([0-9]+):([0-9]+)/);
                  awsccnt = 0;
                  if( ret_val.search(/Remaining credit: /)>=0 ){
                    var cr = ret_val.match(/Remaining credit: \$<\/strong>(.*)\//);
                    awsbcnt = parseFloat(cr[1]);
                    if( tv ){
                      if( tv[1] ) awsccnt = 3600*24*parseInt(tv[1]);
                      if( tv[2] ) awsccnt += 3600*parseInt(tv[2]);
                      if( tv[3] ) awsccnt += 60*parseInt(tv[3]);
                      if( tv[4] ) awsccnt += parseInt(tv[4]);
                    }
                  }
                }
                // mhui: display the status
                if( ret_val.search(/Status: /)>=0 ){
                    var mst = ret_val.match(/Status: ([^<]+)</);
                    var st = mst[1];
                    	awsstatus = st.split(":");
                        var e = document.getElementById("awsstatus");
                        if( e ) e.innerHTML = awsstatus[0];
                    	if (awsstatus.length>1) {
                          var e = document.getElementById("awsstatusdetails");
                          if(e) e.innerHTML = awsstatus[1];
                    	}
                        if(awsstatus[0]=='Deactivated') {
                           $('#awsbtn').attr("disabled", true);
                           if( $("#c9btn").length ){
                             $('#c9btn').attr("disabled", true);
                           }
                        }
                  }
              })
             .fail(function(ret_val) {
               alert('failed to retrieve AWS credentials');
             }); 
                    return false;
         }
         var tnow = new Date().getTime();
         tnow = Math.round(tnow/1000);
         // Budget ('B')
         tstr = '$' + (awsbcnt? awsbcnt : '0.00');
         var e = document.getElementById("awsstimetxtB");
         if( e ) e.innerHTML = vcInsertSpace(tstr, 'B') +  tstr;
         var types = {"0":"T", "1":"S"};
         for( var v in types ){ 
           var type = types[v];
           var left = (type=='S'? awsscnt : awsccnt) - (tnow-awsstime);
           if(left<0){
             left = 0;
           }
           var tstr = '';
           var tms = 0;
           if( left<=0 ) tstr = '00:00:00';
           else {
             if( left>=(24*3600) ){
               var tday = Math.floor(left/(24*3600));
               tstr += tday + 'd ';
               left = left - tday*24*3600;
             }
             if( left>=3600 ){
               var thr = Math.floor(left/3600);
               tstr += thr + ':';
               tms = left - thr * 3600;
             } else {
               tms = left;
               tstr = '0:';
             }
             var tm = type!='S'? Math.floor(tms/60) : Math.ceil(tms/60);
             var ts = tms - tm*60;
             tstr += (tm<10? '0' : '') + tm; // + ':' + (ts<10? '0' : '') + ts; 
             if( type!='S' ){
               tstr += ':' + (ts<10? '0' : '') + ts;
             }
           }
           if( left>0 ){
             awshandle = window.setTimeout(awscoundown , 60000); //3000
           }
           var e = document.getElementById("awsstimetxt" + type);
           if( e ) e.innerHTML =  vcInsertSpace(tstr, type) +  tstr;
         }
         return false;
       }
       function awslabtimer(ret_val)
       {
         awsstime = new Date().getTime();
         awsstime = Math.round( awsstime/1000 );
         awsscnt = 0;
         if( ret_val.search(/Remaining session time:/)>=0 ){
           var tv = ret_val.match(/Remaining session time: ([0-9]+ day[s]? )?([0-9]+):([0-9]+):([0-9]+)\(/);
           if( tv ){
             if( tv[1] ) awsscnt = 24*3600 * parseInt(tv[1]);
             if( tv[2] ) awsscnt += 3600*parseInt(tv[2]);
             if( tv[3] ) awsscnt += 60*parseInt(tv[3]);
             if( tv[4] ) awsscnt += parseInt(tv[4]);
           }
         }
         if( awshandle ) clearTimeout(awshandle);
         awshandle = window.setTimeout(awscoundown , 300);
       }
       awshandle = window.setTimeout(awscoundown , 300);
    function showawsact(v){
        $('#detailspinbox').show();
     if(v==1) $('#showawsdetail').html('Account Details <i id="awsbtnspinbox" class="icon-spin icon-spinner"></i>');
     $.ajax({
        url: "../util/vcput.php?a=getaws&type=1&stepid=890070&version=0&v="+v,
     })
     .done(function(ret_val) {
         var lb = document.getElementById("aws-modal-label");
         lb.innerHTML = 'Credentials';
         var target = document.getElementById("report_aws_msg_box");
         target.innerHTML = ret_val;
         var progress = document.getElementById('report_aws_progress_box');
         progress.innerHTML = '';
         $('#modal-table-report-aws').appendTo("#editordiv");
         $('#modal-table-report-aws').modal('show');
         $('#detailspinbox').hide();
         if(v) $('#showawsdetail').html('Account Details');

         if( ret_val.search(/(Cloud|VM) (Lab|Access)/)>=0 ){
           awslabtimer(ret_val);
         } else if( ret_val.search(/Remaining session time: /)>=0 ){
           var tv = ret_val.match(/Remaining session time: ([0-9]+h)?([0-9]+m)?([0-9]+s)/);
           awsscnt = 0;
           if( tv[1] ) awsscnt = 3600 * parseInt(tv[1]);
           if( tv[2] ) awsscnt += 60*parseInt(tv[2]);
           if( tv[3] ) awsscnt += parseInt(tv[3]);
           if( awshandle ) clearTimeout(awshandle);
           awshandle = window.setTimeout(awscoundown , 300);
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve AWS credentials');
       $('#detailspinbox').hide();
       if(v==1) $('#showawsdetail').html('Account Details');
     });
     }
  function showclabs(str){
     $('#detailspinbox').show();
     $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
     })
     .done(function(ret_val) {
         var target = document.getElementById("report_clabs_msg_box");
         target.innerHTML = (str? str : '');
         try {
           resp = jQuery.parseJSON(ret_val);
           target.innerHTML += resp.message;
         } catch(err) {
           target.innerHTML += 'Failed to obtain lab status. If the problem persists, please report this problem to support@vocareum.com.';
         }
         //$('#modal-table-report-clabs').appendTo("#editordiv");
         $('#modal-table-report-clabs').modal('show');
         $('#detailspinbox').hide();
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials');
       $('#detailspinbox').hide();
     });
  }
  function cdbtime(resp)
  {
    if( (typeof resp['session_time'] != 'undefined') && resp['session_time'] ){
      awsstime = new Date().getTime();
      awsstime = Math.round( awsstime/1000 );
      awsscnt = resp['session_time'];
      if( awshandle ) clearTimeout(awshandle);
      awshandle = window.setTimeout(awscoundown , 300);
    }
  }
  function showcdbdetails(dbtype){
    str = false;
     $('#detailspinbox').show();
     $.ajax({
        url: "../util/vcput.php?a=getcdb&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work&dbtype="+dbtype,
     })
     .done(function(ret_val) {
         var target = document.getElementById("report_cdb_msg_box");
         target.innerHTML = (str? str : '');
         try {
           resp = jQuery.parseJSON(ret_val);
           cdbtime(resp);
           target.innerHTML += resp.message;
         } catch(err) {
           target.innerHTML += 'Failed to obtain DB status. If the problem persists, please report this problem to support@vocareum.com.';
         }
         //$('#modal-table-report-cdb').appendTo("#editordiv");
         $('#modal-table-report-cdb').modal('show');
         $('#detailspinbox').hide();
      })
     .fail(function(ret_val) {
       alert('failed to retrieve DB credentials');
       $('#detailspinbox').hide();
     });
  }
  function launchclabs_confirmed(ischk)
  {
    if (true) {
      changeClabsState("Start", 'Starting', $('#labspinbox'), ischk);
    }
    else {
      launchclabs_confirmed_1(ischk);
    }
  }

  var clabshandle = false;
  function launchclabs_confirmed_1(ischk){
    if(clabshandle) clearTimeout(clabshandle);
    clabshandle = false;
    if( !ischk ) $('#labspinbox').show();

     $.ajax({
        url: "../util/vcput.php?a=" + (ischk? 'getclabs' : 'launchclabs') + "&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
     })
     .done(function(ret_val) {
         if( !ischk && ret_val.indexOf('success')<0 ){
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Failed to launch your lab. If the problem persists, please report to support@vocareum.com for assistance.';
           $('#modal-table-report-clabs').modal('show');
         } else if ( ischk && ret_val.indexOf('NotReady')>=0 ){
           clabshandle = setTimeout(function() { launchclabs_confirmed(1); }, 1000);
         } else if ( ischk && ret_val.indexOf('Ready')>=0 ){
           $('#labspinbox').hide();
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Lab is ready';
         } else if ( ischk && (ret_val.indexOf('Terminated')>=0 || ret_val.indexOf('Stopped')>=0) ){
           $('#labspinbox').hide();
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Please re-launch the lab through Start Lab.';
         } else {
           clabshandle = setTimeout(function() { launchclabs_confirmed(1); }, 1000);
         }
      })
     .fail(function(ret_val) {
       alert('failed to launch Lab');
       $('#labspinbox').hide();
     });
  }


  var clabsStateData = null;
  function showEmptyClabsStateModal()
  {
    $('#clabsStateModal_vms').hide();
    $('#clabsStateModal_body').hide();
    $('#clabsStateModal_ta').text('Retrieving lab information...');
    $('#clabsStateModal_ta').show();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  function clabsStateModalSetMsg(msg)
  {
    $('#clabsStateModal_ta').text(msg);
    $('#clabsStateModal_ta').show();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  function clabsStateModalSetFinalState(state, msg)
  {
    var status = "";

    vms = clabsStateData['vms'];
    for (var i = 0; i < vms.length; i++)
    {
      $('#clabs_modal_vm_' + i).hide();
      $('#clabs_modal_vm_spinner_' + i).hide();
      var vm = vms[i];
      var mc = vm['machine'];
      if (mc)
      {
        if (mc['state'] == "Failed")
        {
          if (mc['status'] != "")
          {
            status += "\n  " + mc['hostname'] + ': ' + mc['status'];
          }
        }
      }
    }

    clabsStateModalSetMsg(msg + status);
  }

  var clabsVmLastState = [];
  function buildAndShowClabsStateModal(clabs_data, start_state)
  {
    vms = clabs_data['vms'];

    data = '<table class="table table-first-column-check table-hover" style="margin-bottom:0px" border=1 frame=void rules=rows>';
    for (var i = 0; i < vms.length; i++)
    {
      vm = vms[i];
      data += '<tr id="vm_' + i + '" class="clabs-state-modal-tr-vm">';
      data += '<td class="clabs-state-modal-td-vm span4">';
      data += vm['name'];
      data += '</td>';
      data += '<td class="clabs-state-modal-td-state span4" id="clabs_modal_vm_state_' + i + '">';
      data += start_state + '&nbsp; <i id="clabs_modal_vm_spinner_' + i + '" class="icon-spin icon-spinner"></i>';
      data += '</td></tr>';
      clabsVmLastState.push(start_state);
    }
    data += '</table>';

    $('#clabsStateModal_body').show();
    $('#clabsStateModal_vms').html(data);
    $('#clabsStateModal_vms').show();
    $('#clabsStateModal_ta').hide();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  var clabsChangeStateTimer = null;
  function changeClabsState(ctrl, printState, spinner, chkCounter)
  {
    clearTimeout(clabsChangeStateTimer);
    var voc2022labs = false;
    if (chkCounter == 0)
    {
      op = (ctrl == "Stop") ? 'endclabs' : 'launchclabs';
      $.ajax({
      url: "../util/vcput.php?a=" + op + "&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
      })
      .done(function(ret_val) 
       {
         
         if (!voc2022labs) showEmptyClabsStateModal();
         console.log(ret_val);
         try 
         {
           var result = JSON.parse(ret_val);
           if (result['status'] != 'success')
           {
             clabsStateModalSetMsg('Failed to ' + ctrl + ' your lab. If the problem persists, please report to support@vocareum.com for assistance.');
             spinner.hide();
           }
           else 
           {
             clabsChangeStateTimer = setTimeout(changeClabsState, 100, ctrl, printState, spinner, 1);
           }
         }
         catch(err) 
         {
           clabsStateModalSetMsg('Exception changing state of lab1: ' + err);
           spinner.hide();
         }
       })
       .fail(function(data, textStatus, jqXHR)
       {
         clabsStateModalSetMsg("Failed to get lab1 information");
         spinner.hide();
       });
    }
    else
    {
      var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work")
        .done(function(data, textStatus, jqXHR)
        {
          try 
          {
            console.log(data);
            var result = JSON.parse(data);
            if (result['status'] == 'Error')
            {
              clabsStateModalSetMsg("Could not get lab information: " + result['msg']);
              spinner.hide();
            }
            else
            {
              clabsStateData = result;
              if (chkCounter == 1)
              {
                
                if(!voc2022labs) buildAndShowClabsStateModal(result, printState);
                clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
              }
              else
              {
                // check the state - if we've reached a good final state, all done
              
                state = result['lab_state'];
                status = result['lab_status']

                // let's first update all the vm individual states
                vms = result['vms'];
                for (var i = 0; i < vms.length; i++)
                {
                  vm = vms[i];
                  st = vm['state'];
                  if (st != clabsVmLastState[i])
                  {
                    var msg = st;
	            if (  (st != "Ready")
                       && (st != "Stopped")
                       && (st != "Terminated")
                       && (st != "Failed") )
                    {
                      msg += '&nbsp; <i id="clabs_modal_vm_spinner_' + i + '" class="icon-spin icon-spinner"></i>';
                    }
                    $('#clabs_modal_vm_state_' + i).html(msg);
                    clabsVmLastState[i] = st;
                  }
                }

                if (state == "Failed")
                {
                  msg = 'Failed to launch lab';
                  if (status != "")
                  {
                    msg += ": " + status;
                  }
                  clabsStateModalSetFinalState('Failed', msg);
                  spinner.hide();
                }
                else if (  (ctrl == "Stop")
                        && ( (state == "None")
                          || (state == "Stopped")
                          || (state == "Terminated") ) )
                {
                  // done!!
                  var print_state = state;
                  if (state == "None")
                  {
                    print_state = "Stopped";
                  }
                  if (!voc2022labs) clabsStateModalSetFinalState(state, 'Your lab is now ' + print_state);
                  spinner.hide();
                  awslabtimer(''); // end-timer
                }
                else if (ctrl == "Start")
                {
                  if (state == "Ready")
                  {
                    // done!!
                    // cdbtime(result); if node != t
                    if (!voc2022labs) clabsStateModalSetFinalState(state, 'Your lab is now ' + state + '. The session time is ' + awsscnt + ' seconds (' + Math.ceil(awsscnt/60) + ' minutes)');
                    
                    
                    displayVoc2022();
                    spinner.hide();
                  }
                  else if ( (state == "Stopped")
                         || (state == "Terminated") )
                  {
                    // something went wrong
                    msg = 'Please re-launch your lab';
                    if (status != "")
                    {
                      msg += ": " + status;
                    }
                    clabsStateModalSetFinalState(state, msg);
                    spinner.hide();
                  }
                  else
                  {
                    clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
                  }
                }
                else
                {
                  clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
                }
              }
            }
          }
          catch(err)
          {
            console.log("Exception: " + err);
            clabsStateModalSetMsg('Exception stopping lab2: ' + err);
            spinner.hide();
          }
        })
        .fail(function(data, textStatus, jqXHR)
        {
          clabsStateModalSetMsg("Failed to get lab2 information");
          spinner.hide();
        });
    }
  }


function displayVoc2022(indx = 0, access_type = '', refresh = 0) 
{
  console.log("vmBtnClicked()");
var vm_indx = indx; //e.target.dataset.indx;
var subtype;
var state;
var vm;
var str;
var allTabs = false;
var hideConsole = false;

var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work" + '&novnc=1' + '&vm_indx=' + vm_indx)
 .done(function(data, textStatus, jqXHR)
 {
	 if (data.indexOf('<ERROR:INVALID_SESSION>') !== -1) 
   { // invalid session
	   window.location.reload();
		 return;
	 }
	    
   try 
   {
     var result = JSON.parse(data);
     if (result['status'] == 'Error')
     {
        show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);

     }
     else
     {
       subtype = result['subtype'];
       state = result['lab_state'];

       // just a precuationary measure in case the check returns with state != Ready and at the same time
       // we are trying to start the check for a just started lab
       vcSetupPeriodicUiCheck(vcPeriodUiCheckReloadDelay);

       // get the appropriate container/vm
       vm = result['vms'][vm_indx];
       state = vm['state'];
	     vm_extip = (typeof(vm['extip']) != 'undefined')? vm['extip'] : vm['ip'];
       vm_user = vm['user'];
       vm_access = vm['access'];
       vm_access_url = (typeof(vm['access_url']) != 'undefined')? vm['access_url'] : false;
       vm_simple_url = (typeof(vm['simple_url']) != 'undefined')? vm['simple_url'] : false;
       
       var access_v2 = (typeof(vm['access_v2']) != 'undefined')? vm['access_v2'] : false;
       var access_name, access_port;

       // handles the mysql db container when no access is passed back
       if (vm_access.length == 0)
       {
    	   $('#vmspinbox'+indx).addClass('hidden-1');
         //console.log('cdb = ' + JSON.stringify(result['cdb'][0]));
    	   return;
       }
       
       if (state != "Ready")
       {
         if (typeof(vmspinbox) != 'undefined' && vmspinbox != null)
         {
        	 $('#vmspinbox'+indx).addClass('hidden-1');
         }
       }
       else
       {
         if (access_type == '')
         {
            if (access_v2)
            {
            	  access_type = access_v2[0]['name']; //type
            	  access_name = access_v2[0]['name'];
            	  access_port = access_v2[0]['port']
            }
            else
            {
                var keys = Object.keys(vm_access);
                console.log(keys);
                if (keys.length == 0) {return;}
                access_type = keys[0];
                access_port = vm_access[access_type];
            }
         }

         var is_telnet = access_type.includes("telnet");
         console.log('access type = '+access_type);

         //2020-01-26: new access_url
         if (vm_access_url)
         {
     	     access_name = access_type;
 	         if (typeof(vm_access_url[access_name]) != "undefined") 
 	         {
 	        	 var url = vm_access_url[access_name]["url"]; //"https://eval.vocareum.com";

 	           var cookieName = vm_access_url[access_name]["cookie"]["name"]; //"vocLabAccess";
 	           var cookieValue = vm_access_url[access_name]["cookie"]["value"]; //"ttyd";
 	           var cookiePath = vm_access_url[access_name]["cookie"]["path"]; //"/";
 	           var cookieDomain = vm_access_url[access_name]["cookie"]["domain"]; //"vocareum.com";

                   var checkUrl = url;
                   if (cookieDomain == "vocareum.com")
                   {
 	             str = cookieName + "=" + cookieValue + "; path=" + cookiePath + "; domain=" + cookieDomain + "; SameSite=None; secure";
 	             document.cookie = str;
 	             console.log(str);
                   }
                   else
                   {
                     url = url + "/redirector" + "?name=" + encodeURIComponent(cookieName) + "&value=" + encodeURIComponent(cookieValue);
                   }
 	           
 	           var keys = Object.keys(vm_access_url);
 	           vmCheckAndDisplayFrame(checkUrl, url, cookieName, cookieValue, 0);
 	         }
 	         else
 	         {
 	        	 show_voc_gritter(false, "Failed: Could not get " + access_name + " access_url information", true);
 	         }

        	 $('#vmspinbox'+indx).addClass('hidden-1');
         }
         
         else if (vm_simple_url)
         {
           access_name = access_type;
           if (typeof(vm_simple_url[access_name]) !== "undefined") 
           {
             var url = vm_simple_url[access_name]["url"];
             setTimeout(vmDisplayFrameAfterDelay, 100, url); // may need a check for ui readiness...
           }
           else
 	   {
 	     show_voc_gritter(false, "Failed: Could not get " + access_name + " simple_url information", true);
 	   }
           $('#vmspinbox'+indx).addClass('hidden-1');
         }

         else if (access_type != 'ssh' && access_type != 'telnet' && !is_telnet && //subtype != 16 && 
                 (typeof vm['novnc_proxy'] !== "undefined") && vm['novnc_proxy']) 
         {
             console.log(vm['novnc_proxy']);
             document.getElementById('vmBtn'+vm_indx_current).style.borderTop = "0px solid rgb(0,109,204)";
             document.getElementById('vmBtn'+indx).style.borderTop = "3px solid #6495ED";
             vm_indx_current = indx;

             ///////////////////
             if (newTab || onlyReadme)
             {
            	 if (access_v2)
               {
            	   for (var j=0; j<access_v2.length; j++)
                 {
                   if (access_type == access_v2[j]['name'])
                   {
                     console.log("v2 new tab = " + access_v2[j]['type'] + "://" + vm['extip'] + ":" + access_v2[j]['port']);
       	             window.open(access_v2[j]['type'] + "://" + vm['extip'] + ":" + access_v2[j]['port']);
       	             break;
                   }
                 }
               }
            	 else 
               {
                 console.log("newTab: open a new tab - http://" + vm['extip'] + ":" + vm_access[access_type]);   
                 window.open("http://" + vm['extip'] + ":" + vm_access[access_type]);
               }
            	 $('#vmspinbox'+indx).addClass('hidden-1');
             }
             else
             {
            	 
            	 // if there's already something in the frame and we are effectively just reloading the iframe,
               // unload and it first and give the existing ws connection time to be closed first - otherwise 
               // there's a conflict
               if (!onlyReadme)
               {
                 setTimeout(vmBtnDelayedNovnc, 2000, vm, indx, vmspinbox);
               }
             }
         }
         else if (access_type != 'ssh' && access_type != 'telnet')
         {
           //console.log("newTab = " + newTab);
           if (newTab)
           {
        	   if (access_v2)
             {
            	   for (var j=0; j<access_v2.length; j++)
                 {
                   if (access_type == access_v2[j]['name'])
                   {
                     console.log("v2-1 new tab = " + access_v2[j]['type'] + "://" + vm['extip'] + ":" + access_v2[j]['port']);
       	             window.open(access_v2[j]['type'] + "://" + vm['extip'] + ":" + access_v2[j]['port']);
       	             break;
                   }
                 }
             }
        	   else if (access_type == 'https')
        	   {
        		   console.log("https://" + vm['extip'] + ":" + vm_access[access_type]);
               window.open("https://" + vm['extip'] + ":" + vm_access[access_type]);
        	   }
        	   else
        	   {
               console.log("http://" + vm['extip'] + ":" + vm_access[access_type]);
               window.open("http://" + vm['extip'] + ":" + vm_access[access_type]);
        	   }
           }
           else
           {
        	     var url;
        	     if (access_v2)
               {
              	 for (var j=0; j<access_v2.length; j++)
                 {
                   if (access_type == access_v2[j]['name'])
                   {
                     console.log("v2-1 new tab = " + access_v2[j]['type'] + "://" + vm['extip'] + ":" + access_v2[j]['port']);
         	           url = access_v2[j]['type'] + "://" + vm['extip'] + ":" + access_v2[j]['port'];
         	           break;
                   }
                 }
               }
        	     else
        	     {
        	       console.log("https://" + vm['extip'] + ":" + vm_access[access_type]);
                 url = "https://" + vm['extip'] + ":" + vm_access[access_type];
        	     }
               if (!document.mozFullScreen && !document.webkitFullScreen) 
               {
            	   //load the readme
            	   if (onlyReadme)
	               {
		               vmp_3();
	               }
            	   else if (readme == 1)
      	         {
      	        	if (!cloudera && !hideFileBrowser && !hideSource) {vmp_1_22_3();} 
      	        	else {
      	        	  console.log("calling vmp_22_3 from vmpbtnclicked #2");
      	        	  vmp_22_3();
      	        	}
      	     		 }
      	     		 else
      	     		 {
      	     			if (!cloudera && !hideFileBrowser && !hideSource) {vmp_1_22();} else {vmp_22();}
      	     		 }
            	   if (canSubmit) {document.getElementById('vmp-ideheader').style.display = "block"; vmp_ideheader = true;}
	     		   
      	     	   vmp_resize();
               }
               $('#panel2-iframe').attr("src", url);
           }
           
           if (typeof(vmspinbox) != 'undefined' && vmspinbox != null)
           {
        	   $('#vmspinbox'+indx).addClass('hidden-1');
           }
         }
         else if ((access_type == 'ssh' && (typeof vm['ssh_cmd'] !== "undefined") && vm['ssh_cmd']) ||
        		      (access_type == 'telnet' && (typeof vm['telnet_cmd'] !== "undefined") && vm['telnet_cmd']))
         {
           console.log('ssh');

           document.getElementById('vmBtn'+vm_indx_current).style.borderTop = "0px solid rgb(0,109,204)";
           document.getElementById('vmBtn'+indx).style.borderTop = "3px solid #6495ED";
           vm_indx_current = indx;

           // clear periodic_save
           if (savefilehandle) {clearTimeout(savefilehandle);}


           // Three cases:
           // 
           // 1. no terminal has ever been launched
           //    - start terminal
           //    - ssh cntnr
           // 2. terminal disappeared
           //    - "press" the launch button
           //    - ssh cntnr
           // 3. terminal is present
           //    - check if tab for this vm is already there
           //      - if so, select it
           //      - if not, open a new tab and ssh cntnr

           var isNewWin = true;
           const termExp = /\/terminal\//;
           var telement = document.getElementById('panel2-iframe');
           if ($('#panel2-iframe').attr("src") == "")
           {
             $('#panel2-iframe').attr("src", "https://proxy.vocareum.com/hostip/172.31.27.250:3000");
             $('#panel2-iframe').on('load', function() {
                 /*
                var elmnt = telement.contentWindow.document.getElementById('open');
                if (typeof(elmnt) != "undefined" && elmnt != null) {
                  elmnt.style.display = "none";
                  }
                 */
              });
           }
           else if (termExp.test($('#panel2-iframe').attr("src")) === false)
           {
             $('#panel2-iframe').attr("src", "https://proxy.vocareum.com/hostip/172.31.27.250:3000");
             $('#panel2-iframe').on('load', function() {
                var elmnt = telement.contentWindow.document.getElementById('open');
                if (typeof(elmnt) != "undefined") {
                  elmnt.style.display = "none";
                  }
              });
           }
           else if (! telement.contentWindow.vocTerminalIsAvailable())
           {
             telement.contentWindow.vocStartTerminal();
             var elmnt = telement.contentWindow.document.getElementById('open');
                if (typeof(elmnt) != "undefined") {
                  elmnt.style.display = "none";
                  }
           }
           else
           {
             isNewWin = false;
           }
           setTimeout(vocTerminalTimeout, 500, telement, access_type, vm, isNewWin, 0);

           // reset filetree and panel
           if (!cloudera && !hideFileBrowser && !hideSource) //(!cloudera)
	         {
     	       initEditor();
     	       initFileTree();
             resetFileTree();
             refreshFileTree(false, true);
             refreshS3WorkareaTree(0);
             refreshSubTree();
           
             //mhui
             window.setTimeout('periodic_save()', 60000);
	         }
	         
         }
         else if ((typeof vm['err'] !== "undefined") && vm['err'])
         {
           bootbox.dialog("Unable to access:  " + vm['err'], 
                          [{
                            "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action",
                          }]
           );                      
         }
       }
     }
   }
   catch(err)
   {
     console.log("Exception: " + err);
   }
 })
 .fail(function(data, textStatus, jqXHR)
 {
   show_voc_gritter(false, "Failed: Could not get lab information", true);
 });
}


var vmCheckAndDisplayFrameCounterMax =  20;
function vmCheckAndDisplayFrame(checkUrl, displayUrl, cookieName, cookieValue, counter)
{
  console.log("vmCheckAndDisplayFrame()");
  $.ajax({
    url: "../util/vcput.php?a=checkVmAccess&displayUrl=" + checkUrl + "&cookieName=" + cookieName + "&cookieValue=" + cookieValue
  })
   .done(function(data) 
   {
     try 
     {
       var result = JSON.parse(data);
       console.log("vmCheckAndDisplayFrame: " + data);
       if (result['status'] == 'Error') 
       {
         console.log("vmCheckAndDisplayFrame: Error");
       }
       else 
       {
         if (result['http_status'] == 503)
         {
           if (counter < vmCheckAndDisplayFrameCounterMax)
           {
             if (counter == 1)
             {
               show_voc_gritter_duration(false, 'Waiting for the UI to be ready', false, Math.abs(vmCheckAndDisplayFrameCounterMax - 3) * 1000);
             }
             var sleepTime = 1;
             if (counter > 120)
             {
               sleepTime = 10;
             }
             else if (counter > 20)
             {
               sleepTime = 5;
             }
             console.log("vmCheckAndDisplayFrame: UI not ready; sleep for " + sleepTime + " second(s)");
             setTimeout(vmCheckAndDisplayFrame, sleepTime * 1000, checkUrl, displayUrl, cookieName, cookieValue, counter + sleepTime);
             return;
           }
         }
       }
       $.gritter.removeAll();
       setTimeout(vmDisplayFrameAfterDelay, 1000, displayUrl);
     } 
     catch (err) 
     {
       console.log("vmCheckAndDisplayFrame:Exc " + err);
       $('#panel2Iframe').attr("src", displayUrl);
     }
   })
   .fail(function(data, textStatus, jqXHR) 
   {
     console.log("vmCheckAndDisplayFrame: Fail");
     $('#panel2Iframe').attr("src", displayUrl);
   });
}

function vmDisplayFrameAfterDelay(displayUrl)
{
  $('#panel2Iframe').attr("src", displayUrl);
}

var vcPeriodicUiCheckHandle = null;
var vcPeriodUiCheckReloadDelay = 5000;     // 5 s
var vcPeriodUiCheckFirstDelay = 30000;     // 30 s
var vcPeriodUiCheckSamplingDelta = 180000; // 3 min
function vcSetupPeriodicUiCheck(delay)
{

    if (! vcPeriodicUiCheckHandle)
    {
      vcPeriodicUiCheckHandle = window.setTimeout(vcPeriodicUiCheck, delay);
    }
}

function vcPeriodicUiCheck()
{
  $.ajax({
    url: "../util/vcput.php?a=vcPeriodicUiCheck&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
  })
  .done(function(data, textStatus, jqXHR)
  {
    try 
    {
      var result = JSON.parse(data);
      if (result['status'] != 'Error')
      {
        var lab_info = result['lab_info'];
        var state = lab_info['lab_state'];
        if (state == "Ready") 
        {
          vcPeriodicUiCheckHandle = window.setTimeout(vcPeriodicUiCheck, vcPeriodUiCheckSamplingDelta);
        }
        else
        {
          // gray out the screen?
          vcPeriodicUiCheckHandle = null;
          console.log("The lab state is no longer 'Ready'; stopping periodic ui check");
          return;
        }
      }
    }
    catch(err)
    {
      console.log("vcPeriodicUiCheck:Error: " + err);
      vcPeriodicUiCheckHandle = window.setTimeout(vcPeriodicUiCheck, vcPeriodUiCheckSamplingDelta);
    }
  })
  .fail(function(data, textStatus, jqXHR)
  {
    console.log("vcPeriodicUiCheck:Fail: " + textStatus);
    vcPeriodicUiCheckHandle = window.setTimeout(vcPeriodicUiCheck, vcPeriodUiCheckSamplingDelta);
  });
}

  function endclabs_confirmed(ischk)
  {
    if (true) {
      changeClabsState("Stop", 'Shutting down', $('#endclabspinbox'), ischk);
    }
    else {
      endclabs_confirmed_1(ischk);
    }
  }

  var endclabshandle = null;
  function endclabs_confirmed_1(ischk) {
    clearTimeout(endclabshandle);
    if (! ischk) $('#endclabspinbox').show();

    $.ajax({
      url: "../util/vcput.php?a=" + (ischk? 'stateclabs' : 'endclabs') + "&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
    })
     .done(function(ret_val) {
       console.log(ret_val);
       try {
         var result = JSON.parse(ret_val);
         if (!ischk) {
           if (result['status'] != 'success') {
             $('#endclabspinbox').hide();
             var target = document.getElementById("report_clabs_msg_box");
             target.innerHTML = '<br>Failed to end your lab. If the problem persists, please report to support@vocareum.com for assistance.';
             $('#modal-table-report-clabs').modal('show');
           }
           else {
             clabshandle = setTimeout(function() { endclabs_confirmed(1); }, 1000);
           }
         } else {
           if (   (result['state'] == "None")
               || (result['state'] == "Stopped")
               || (result['state'] == "Terminated") ) {
             $('#endclabspinbox').hide();
             var target = document.getElementById("report_clabs_msg_box");
             target.innerHTML = '<br>Your lab has been stopped.';
             $('#modal-table-report-clabs').modal('show');
             awslabtimer(''); // end-timer
           } else {
             clabshandle = setTimeout(function() { endclabs_confirmed(1); }, 1000);
           }
         }
       }
       catch(err) {
         $('#endclabspinbox').hide();
         var target = document.getElementById("report_clabs_msg_box");
         target.innerHTML = '<br>Exception stopping lab: ' + err;
         $('#modal-table-report-clabs').modal('show');
       }
     })
     .fail(function(ret_val) {
       $('#endclabspinbox').hide();
       var target = document.getElementById("report_clabs_msg_box");
       target.innerHTML = '<br>Failed to end Lab.';
       $('#modal-table-report-clabs').modal('show');
     });
  }

  function endclabs_question(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Yes",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               endclabs_confirmed(0);
             }
           },
           {
             "label" : "No",
             "class" : "btn vocbtn-ac vocbtn-status",
             "callback": function() {
               $('#endclabspinbox').hide();
             }
           }
         ]);
  }
  function endclabs_note(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Close",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               $('#endclabspinbox').hide();
             }
           }
         ]);
  }
  function launchclabs_note(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Close",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               $('#labspinbox').hide();
             }
           }
         ]);
  }
  function launchclabs_question(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Yes",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               launchclabs_confirmed(0);
             }
           },
           {
             "label" : "No",
             "class" : "btn vocbtn-ac vocbtn-status",
             "callback": function() {
               $('#labspinbox').hide();
             }
           }
         ]);
  }
  function endclabs(){
    $('#endclabspinbox').show();
    $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
     })
     .done(function(ret_val) {
         var resp;
         var target = document.getElementById("report_clabs_msg_box");
         try {
           resp = jQuery.parseJSON(ret_val);
           if( resp.status=='Ready' || resp.status=='stopped' ){
             endclabs_question('Are you sure you want to end the following? <br><br>' + resp.message + '<br>');
           } else {
             endclabs_note('Your lab has not started yet.');
           }
         } catch(err) {
           endclabs_note('Your lab has not started yet.');
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials, report this problem to support@vocareum.com if the problem persists.');
       $('#labspinbox').hide();
     });
  }
  function launchclabs(){
    $('#labspinbox').show();
    $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
     })
     .done(function(ret_val) {
         var resp;
         var target = document.getElementById("report_clabs_msg_box");
         try {
           resp = jQuery.parseJSON(ret_val);
           if( resp.status=='Ready' ){
             if (true) {
               launchclabs_confirmed(0);
             } else {
               launchclabs_question('Are you sure you want to launch a new lab? When you launch a new lab, the earlier one shown below will be terminated and its content will be deleted completely.<br><br>' + resp.message + '<br>');
             }
           } else {
             launchclabs_confirmed(0);
           }
         } catch(err) {
           launchclabs_confirmed(0); 
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials, report this problem to support@vocareum.com if the problem persists.');
       $('#labspinbox').hide();
     });
  }

  // set the cookie for the web stuff
  var str;
  if (true)
  {
    str = "domain_latestWebProxy" + "=" + "https://proxy.vocareum.com/hostip/172.31.27.250:5000/vocproxy/110056375719756671975667890070016280fd90b115c3.55177772" + "; path=/" + "; domain=vocareum.com";
  }
  // else
  // {
  //   str = "domain_latestWebProxy" + "=" + "expired" + "; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT" + "; domain=vocareum.com";
  // }
  document.cookie = str;
  
  function vocWebSocket() {
    // should we have our own class and wait for server connection?
    var url = "wss://proxy.vocareum.com";
    var ws = new WebSocket(url + "/xfer/" + "" + "/client");
    // var ws = new WebSocket("ws://jag.vocareum.com:8088/xfer/" + "" + "/client");
    return ws;
  }

  function vocWebSocketUrl() {
    var baseUrl = "wss://proxy.vocareum.com";
    var fullUrl = baseUrl + "/xfer/" + "" + "/client";
    return fullUrl;
  }

  function vocProxyShowErrMsg(msg) {
    bootbox.dialog(msg, 
                   [{
                     "label" : "Ok",
                     "class" : "btn vocbtn-ac vocbtn-action",
                    }]
    );
  }
  
  function vocProxyGetWsUrl() {
    url = "wss://proxy.vocareum.com/hostip/172.31.27.250:5000/vocproxy/110056375719756671975667890070016280fd90b115c3.55177772";
    console.log("Proxy URL: " + url);
    return url;
  }

  function vocProxyWebSocket() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    var url = vocProxyGetWsUrl();
    var ws = new WebSocket(url);
    // Note: this error callback may be overridden by calling code
    //       in that case, it is up to that code to handle the error appropriately
    ws.onerror = function() {
      vocProxyShowErrMsg("Error: WebSocket connection closed due to error - is your WebSocket server running?<br><br>If it is running (and listening on the correct port) and a page reload does not resolve it, please contact Vocareum Technical Support");
    };
    return ws;
  }

  function vocProxyWebSocketUrl() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    return vocProxyGetWsUrl();
  }

  function vocProxyWebUrl() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    url = "https://proxy.vocareum.com/hostip/172.31.27.250:5000/vocproxy/110056375719756671975667890070016280fd90b115c3.55177772";
    console.log("Proxy URL: " + url);
    return url;
  }

  function vocCommShowErrMsg(msg) {
    vocProxyShowErrMsg(msg);
  }
  function vocCommGetWsUrl() {
    url = "wss://proxy.vocareum.com/hostip//voccomm/";
    console.log("Proxy URL: " + url);
    return url;
  }
  function vocCommWebSocket(type) {
    if (true)
    {
      vocCommShowErrMsg("Error: comm channel setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    var url = vocCommGetWsUrl();
    var ws = new WebSocket(url + "/" + type + "?vocmsgs=1");
    // Note: this error callback may be overridden by calling code
    //       in that case, it is up to that code to handle the error appropriately
    ws.onerror = function() {
      vocCommShowErrMsg("Error: WebSocket connection closed due to error - if a page reload does not resolve it, please contact Vocareum Technical Support");
    };
    return ws;
  }
  function vocCommWebSocketUrl() {
    if (true)
    {
      vocCommShowErrMsg("Error: comm channel setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    return vocCommGetWsUrl();
  }

  var imageBuildModalDotTimer;
  var checkImageBuildTimer;
  var vocBuildImages = null;
  var vocImageBuildNew = true;

  var lastImageName = "";
  var lastBaseImage = null;
  var lastDockerFile = "";

  var savedBuildAccessElements = document.createElement("div");
  var savedBuildAccessActualElement = document.createElement("div");

  function imageBuildClearAccessOptions(saveFirst)
  {
    // remove all .image-build-access - except the first one
    // remove the first .image-build-access-actual

    var currentAccessElements = document.getElementsByClassName("image-build-access");
    for (var i = currentAccessElements.length - 1; i > 0; i--)
    {
      if (saveFirst)
      {
        savedBuildAccessElements.appendChild(currentAccessElements[i]);
      }
      else
      {
        currentAccessElements[i].remove();
      }
    }

    var currentActualAccessElements = document.getElementsByClassName("image-build-access-actual");
    if (currentActualAccessElements.length > 0)
    {
      if (saveFirst)
      {
        savedBuildAccessActualElement.appendChild(currentActualAccessElements[0]);
      }
      else
      {
        currentActualAccessElements[0].remove();
      }
    }
  }

  function imageBuildRestoreAccessOptions()
  {
    if (savedBuildAccessActualElement.children.length > 0)
    {
      document.getElementById("image_build_access_0").appendChild(savedBuildAccessActualElement.firstChild);

      if (savedBuildAccessElements.children.length > 0)
      {
        var parent = document.getElementById("imageBuildModal_body");
        // remember - we stored the access elements in reverse order
        var currentAccessElements = savedBuildAccessElements.children;
        for (var i = currentAccessElements.length - 1; i >=0; i--)
        {
          parent.appendChild(currentAccessElements[i]);
        }
      }
    }
  }

  function getContainerImageFromNameId(name, val)
  {
    if ('vocareum' in vocBuildImages) {
      ib = vocBuildImages['vocareum'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          img = ib[key];
          if ((img.name == name) && (img.id == val))
          {
            return img;
          }
        }
      }
    }

    return false;
  }

  function getContainerUserImageFromId(val)
  {
    if ('user' in vocBuildImages) {
      ib = vocBuildImages['user'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          img = ib[key];
          if (img.id == val)
          {
            return img;
          }
        }
      }
    }

    return false;
  }

  function imageBaseOptionSelected(target)
  {
    var name = target.options[target.selectedIndex].text;
    var value = target.options[target.selectedIndex].value;

    lastBaseImage = value;
    imageBuildClearAccessOptions(false);

    img = getContainerImageFromNameId(name, value);
    if (img.access)
    {
      try
      {
        var access = JSON.parse(img.access);
        for (var i = 0; i < access.length; i++)
        {
          var acc = access[i];
          var newIndx = addContainerImageAccess();
          document.getElementById("image_build_access_name_" + newIndx).value = acc.name;
          document.getElementById("image_build_access_port_" + newIndx).value = acc.port;
          document.getElementById("image_build_access_type_select_" + newIndx).value = acc.type;
        }
      }
      catch (err)
      {
        alert("Failed to parse access data: " + img.access)
      }
    }
  }

  function imageBuildOptionSelected(target)
  {
    console.log(target.value);

    var image_name = target.options[target.selectedIndex].text;

    if (image_name in vocBuildImages['user'])
    {
      // first remove all the existing "access" stuff
      // if (prevSelectionWasNew - vocImageBuildNew?) -> save it

      if (vocImageBuildNew)
      {
        // previous value was "new"
        imageBuildClearAccessOptions(true);
        lastImageName = document.getElementById('image_build_name').value; // id
        lastBaseImage = document.getElementById("imageBuildModal_select_baseimage").value; // id
        lastDockerFile = document.getElementById('image_build_dockerfile').value;
        vocImageBuildNew = false;
        
      }
      else
      {
        imageBuildClearAccessOptions(false);
      }  

      img = vocBuildImages['user'][image_name];
      
      $('#image_build_name').val(img.id); // id -> name
      $('#image_build_name_div').hide();

      $('#image_build_dockerfile').val(img.dockerfile);
      document.getElementById("imageBuildModal_select_baseimage").value = img.baseimage_id;

      if (img.access)
      {
        try
        {
          var access = JSON.parse(img.access);
          for (var i = 0; i < access.length; i++)
          {
            var acc = access[i];
            var newIndx = addContainerImageAccess();
            document.getElementById("image_build_access_name_" + newIndx).value = acc.name;
            document.getElementById("image_build_access_port_" + newIndx).value = acc.port;
            document.getElementById("image_build_access_type_select_" + newIndx).value = acc.type;
          }
        }
        catch (err)
        {
          alert("Failed to parse access data: " + img.access)
        }
      }

      $('#imageBuildModal_ta').text("retrieving last build log...");
      $('#imageBuildModal_ta').show();
      getImageBuildLog(img.dockerfile, false);
    }
    else
    {
      vocImageBuildNew = true;
      $('#image_build_name_div').show();
      $('#image_build_name').val(lastImageName);
      $('#image_build_dockerfile').val(lastDockerFile);
      $("#imageBuildModal_select_baseimage").val(lastBaseImage);
      $('#imageBuildModal_ta').text("");
      $('#imageBuildModal_ta').hide();
      // for the access elements, first clear everthing and then add back if we've saved anything
      imageBuildClearAccessOptions(false);
      imageBuildRestoreAccessOptions();
    }
  }

  function isEmpty(obj) {
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        return false;
      }
      return true;
    }
  }
  function getImageBuildLog(dockerFile, scrollIt)
  {
    // can now build again
    $('#imageBuildModal_build').show();
    // also re-retrieve image list coz we probably added a new one - in that case scrollIt will be true
    if (scrollIt)
    {
      prepareBuildImageModal(true);
    }
    
    var target = document.getElementById('imageBuildModal_ta');
    var jqxhr = $.ajax('../util/vcput.php?a=checklab_nocfgchk'
                     + '&stepid=' + 890070                     + '&mode=' + 's'
                     + '&ownerid=' + 1975667                     + '&init=' + dockerFile)
                 .done(function(data, textStatus, jqXHR) {
                   // console.log(data);
                   try {
                     var result = JSON.parse(data);
                     if (result['status'] == 'not built') {
                       msg = 'Status: not built<br>Init file:' + dockerFile + '<br>' + result['message'];
                     } else if (result.status =='error'){
                       msg = 'Status: failed<br>' + 'Init file:' + dockerFile + '<br>' + 'Built at ' + result['time'] + '<br>' + result['message'];
                     } else if (result['status'] == 'building') {
                       msg = 'Status: in progress<br>' + 'Init file:' + dockerFile + '<br>' + 'Started at ' + result['time'] + '<br>' + result['message'];
                     } else if (result['status'] == 'success') {
                       msg = 'Status: completed<br>' + 'Init file:' + dockerFile + '<br>' + 'Built at ' + result['time'] + '<br>' + result['message']
                           + '<br>' + 'Status: completed<br>';
                     } else {
                       msg = 'Internal error, report this to support.vocareum.com<br>' + 'Init file: ' + dockerFile;
                     }
                     target.innerHTML = msg;
                     if (scrollIt) {
                       $("#imageBuildModal_ta").animate({
                         scrollTop:$("#imageBuildModal_ta")[0].scrollHeight - $("#imageBuildModal_ta").height()
                       },1000);
                     }
                   }
                   catch (err) {
                     var htm = target.innerHTML;
                     target.innerHTML = htm + '<br>' + 'Error: Exception retrieving image build log: ' + err;
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   var htm = target.innerHTML;
                   target.innerHTML = htm + '<br>' + 'Error retrieving image build log';
                 });
  }

  function checkImageBuild(dockerFile)
  {
    var blds = [];
    blds.push(dockerFile);
    var jqxhr = $.ajax('../util/vcput.php?a=chkbld'
                     + '&stepid=' + 890070                     + '&mode=' + 's'
                     + '&ownerid=' + 1975667                     + '&files=' + JSON.stringify(blds))
                 .done(function(data, textStatus, jqXHR) {
                   console.log("CHK DONE");
                   try {
                     console.log(data);
                     var resultAll = JSON.parse(data);
                     var result = resultAll[0];
                     if (result['status'] == 'error') {
                       clearTimeout(imageBuildModalDotTimer);
                       $('#imageBuildModal_ta').text("Build Error");
                       getImageBuildLog(dockerFile, true);
                     }
                     else if (result['status'] == 'success') {
                       clearTimeout(imageBuildModalDotTimer);
                       $('#imageBuildModal_ta').text(result['status']);
                       getImageBuildLog(dockerFile, true);
                     }
                     else if (result['status'] != 'building') {
                       $('#imageBuildModal_ta').text(data); // should never really happen
                     }
                     else {
                       // building
                       checkImageBuildTimer = setTimeout(checkImageBuild, 3000, dockerFile);
                     }
                   }
                   catch (err) {
                     clearTimeout(imageBuildModalDotTimer);
                     $('#imageBuildModal_ta').text('Error: Exception retrieving image build status: ' + err);
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   clearTimeout(imageBuildModalDotTimer);
                   $('#imageBuildModal_ta').text('Failure retrieving image build status');
                   console.log("CHK FAILED");
                 });
  }

  function imageBuildModalModalDots()
  {
    text = $('#imageBuildModal_ta').text();
    $('#imageBuildModal_ta').text(text + '.');
    imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);
  }

  var firsTimeShowingImageModal = true;

  function showBuildImageModal()
  {
    console.log(vocBuildImages);

    // setup the select
    // if image_name is set, we'll try to find it in this select - if found, set selected
    // otherwise select "create new image"
    var imageBuildName = $('#image_build_name').val();
    console.log("image build name: " + imageBuildName);
    var foundSelected = false;

    var data = '';
    data += '<select id="imageBuildModal_select" name="imageBuildModal_select" style="width:100%; margin-bottom:0px" onchange="imageBuildOptionSelected(this)" >';

    data += '<option value="0">Create new image</option>';

    // data += '<option selected disabled hidden>Select image</option>';

    // images built in this course
    if ('user' in vocBuildImages) {
      ic = vocBuildImages['user'];
      if (Object.keys(ic).length > 0) {
        data += '<optgroup label="Use existing image">';
        for (var key in ic) {
          if (ic.hasOwnProperty(key)) {
            img = ic[key];
            // console.log(img);
            if (imageBuildName == img.id) {
              data += '<option selected value=' + img.id + '>' + img.name + '</option>';
              foundSelected = img;
            } else {
              data += '<option value=' + img.id + '>' + img.name + '</option>';
            }
          }
        }
        data += '</optgroup>';
      }
    }

    $('#imageBuildModal_select_div').html(data);

    if (foundSelected)
    {
      // no need to show the name div
      $('#image_build_name_div').hide();
    }

    // select-base
    data = '';
    data += '<select id="imageBuildModal_select_baseimage" name="imageBuildModal_select_baseimage" style="width:100%; margin-bottom:0px"  onchange="imageBaseOptionSelected(this)">';
    var foundSelectedBaseImage = false;
    if ('vocareum' in vocBuildImages) {
      ib = vocBuildImages['vocareum'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          var dumpedIt = false;
          img = ib[key];
          if (foundSelected) { 
            if (foundSelected.baseimage_id == img.id) { 
              data += '<option selected value=' + img.id + '>' + img.name + '</option>';
              foundSelectedBaseImage = img;
              dumpedIt = true;
            }
          }
          else {
            if (lastBaseImage == img.id) { 
              data += '<option selected value=' + img.id + '>' + img.name + '</option>';
              foundSelectedBaseImage = img;
              dumpedIt = true;
            }
          }
          if (dumpedIt == false) {
            data += '<option value=' + img.id + '>' + img.name + '</option>';
          }
        }
      }
    }

    data += '</select>';

    $('#imageBuildModal_select_baseimage_div').html(data);

    if (foundSelectedBaseImage == false)
    {
      $("#imageBuildModal_select_baseimage").prop("selectedIndex", -1);
    }

    if (firsTimeShowingImageModal)
    {
      $('#imageBuildModal_ok').hide();
      $('#imageBuildModal_cancel').show();
    }
    else
    {
      // whatever is set is fine
    }
    $('#imageBuildModal_build').show();

    // $('#imageBuildModal_ta').hide();
    $("#imageBuildModal").css('height', 'auto');
    $('#imageBuildModal').modal();

    firsTimeShowingImageModal = false;
  }

  function prepareBuildImageModal(showModal)
  {
    var jqxhr = $.ajax('../util/vcput.php?a=getImages'
                     + '&courseid=' + 54610                     + '&isbuildimage=1')
                 .done(function(data, textStatus, jqXHR) {
                   try {
                     console.log(data);
                     var result = JSON.parse(data);
                     if (result['status'] == 'error') {
                       alert('Error getting image list: ' + result['message']);
                     }
                     else {
                       if (typeof result['images'] === 'undefined') {
                         alert('Error: no image list found');
                       }
                       else {
                         vocBuildImages = result['images'];
                         if (showModal) {
                           showBuildImageModal();
                         }
                       }
                     }
                   }
                   catch (err) {
                     alert('Error: Exception getting image list: ' + err);
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   alert('Error: Failure getting image list');
                 });
  }

  function buildContainerImage()
  {
    var imageName = document.getElementById('image_build_name').value.trim();
    var dockerFile = document.getElementById('image_build_dockerfile').value.trim();

    if (imageName === "")
    {
      alert("The image name needs to be set");
      return;
    }
    if (dockerFile === "")
    {
      alert("The docker file name needs to be set");
      return;
    }

    // imageName could be an id for existing images - if so, convert it to name
    var mappedName = getContainerUserImageFromId(imageName);
    imageName = mappedName ? mappedName.name : imageName;

    var currentAccessActualElements = document.getElementsByClassName("image-build-access-actual");
    var accessArray = [];
    for (var i = 0; i < currentAccessActualElements.length; i++)
    {
      var id = currentAccessActualElements[i].dataset.id;
      var name = document.getElementById("image_build_access_name_" + id).value.trim();
      var port = document.getElementById("image_build_access_port_" + id).value.trim();
      var e = document.getElementById("image_build_access_type_select_" + id);
      var type = e.options[e.selectedIndex].text;
      console.log("ACCESS " + id + " : " + name + " / " + type + " / " + port);
      if ((name === "") || (port === "") || (type == 0))
      {
        alert("At least one access type definition is incomplete; please set all the fields or delete the row");
        return;
      }
      if (! (/^\d+$/.test(port)))
      {
        alert("Port numbers need to be positive integers; please fix the incorrect port value: " + port);
        return;
      }
      // accessArray.push({ "name" : name, "type" : type, "port" : port });
      var arr = {};
      arr["name"] = name;
      arr["type"] = type;
      arr["port"] = port;
      accessArray.push(arr);
    }
    
    // right now we don't give users a choice - since we always start from our base
    var userArray = {};
    userArray["user"] = "labsuser";
    userArray["suser"] = "labsadmin";
    userArray["sysuser"] = "";

    var mountsArray = {};

    // if this is a supposed to be a new image, make sure that it does not already exist
    if (vocImageBuildNew)
    {
      if (vocBuildImages) {
        if ('user' in vocBuildImages) {
          if (imageName in vocBuildImages['user']) {
            alert("An image with this name '" + imageName + "' already exists; please select a new unique name");
            return;
          }
        }
      }
    }
    var select_baseimage = document.getElementById('imageBuildModal_select_baseimage');
    
    var imageSelVal = select_baseimage.value;
    var imageSelTxt = select_baseimage.options[select_baseimage.selectedIndex].text.trim();

    $('#imageBuildModal_ok').show();
    $('#imageBuildModal_cancel').hide();
    $('#imageBuildModal_build').hide();
    $('#imageBuildModal_ta').text("building..."); // "Building image.");
    $('#imageBuildModal_ta').show();
    $("#imageBuildModal").animate({ scrollTop: $('#imageBuildModal').prop("scrollHeight")}, 1000);
    // imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);

    var jqxhr = $.ajax({
      type: 'POST',
      url: '../util/vcput.php?a=buildImage&stepid=890070&version=0&mode=s',
      data: {
        baseimage: imageSelTxt,
        baseimage_id: imageSelVal,
        imagename: imageName,
        dockerfile: dockerFile,
        access: JSON.stringify(accessArray),
        users: JSON.stringify(userArray),
        mounts: JSON.stringify(mountsArray)
      }
    })
    .done(function(data, textStatus, jqXHR) {
      try {
        console.log(data);
        var result = JSON.parse(data);
        if (result['status'] == 'error') {
          $('#imageBuildModal_ta').text('Error: ' + result['message']);
          // put Cancel/Build back
          $('#imageBuildModal_ok').hide();
          $('#imageBuildModal_cancel').show();
          $('#imageBuildModal_build').show();
        }
        else {
          if (result['status'] == 'building') {
            $('#imageBuildModal_ta').text("building...");
            imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);
            // need to periodically check the build status
            checkImageBuildTimer = setTimeout(checkImageBuild, 3000, dockerFile);
          }
          else {
            $('#imageBuildModal_ta').text(result['status']);
          }
          vocImageBuildNew = false;
        }
      }
      catch (err) {
        $('#imageBuildModal_ta').text('Error: Exception building image: ' + err);
        // put Cancel/Build back
        $('#imageBuildModal_ok').hide();
        $('#imageBuildModal_cancel').show();
        $('#imageBuildModal_build').show();
      }
    })
    .fail(function(data, textStatus, jqXHR) {
      console.log("BuldImage: Fail");
      $('#imageBuildModal_ta').text('Error: Build Image failed');
      // put Cancel/Build back
      $('#imageBuildModal_ok').hide();
      $('#imageBuildModal_cancel').show();
      $('#imageBuildModal_build').show();
    });
  }

  function deleteAccessContainerImage(e)
  {
    var target = e.target;
    var id = target.dataset.id;

    var firstBuildAccess = document.getElementById("image_build_access_0");

    var targetAncestor = target.closest('.image-build-access');

    var currentAccessElements = document.getElementsByClassName("image-build-access");

    if (targetAncestor != firstBuildAccess)
    {
      for (var i = 0; i < currentAccessElements.length; i++)
      {
        var el = currentAccessElements[i];
        if (el.dataset.id == id)
        {
          el.remove();
          break;
        }
      }
    }
    else
    {
      // remove the first one (image-build-access-actual) - but we need to then move the next ones (if any) up
      
      var actualAccessElement = targetAncestor.querySelector(".image-build-access-actual");
      actualAccessElement.remove();

      if (currentAccessElements.length > 1)
      {
        // get the first image-build-access-actual and append it to firstBuildAccess

        var imageModalBody = document.getElementById("imageBuildModal_body");
        var firstImageBuildAccessActual = imageModalBody.querySelector(".image-build-access-actual");
        var firstImageBuildAccessActualParent = firstImageBuildAccessActual.closest('.image-build-access');
        
        firstImageBuildAccessActual.classList.remove("offset3");
        firstBuildAccess.appendChild(firstImageBuildAccessActual);
        firstImageBuildAccessActualParent.remove();
      }
    }
  }

  function addContainerImageAccess()
  {
    var currentAccessElements = document.getElementsByClassName("image-build-access-actual");
    var myId = currentAccessElements.length;
    console.log("MY ID: " + myId);

    // myId == 0 => this is the first access type (inline with the "Access:" label)

    if (myId > 0)
    {
      var topDiv = document.createElement("div"); 
      topDiv.classList.add("control-group");
      topDiv.classList.add("row-fluid");
      topDiv.classList.add("image-build-access");
      // topDiv.setAttribute("name", "image_build_access");
      topDiv.setAttribute("id", "image_build_access_" + myId);
      topDiv.setAttribute('data-id', myId);
    }
    else
    {
      topDiv = document.getElementById("image_build_access_0");
    }

    middleDiv = document.createElement("div"); 
    middleDiv.classList.add("span4");
    middleDiv.classList.add("row-fluid");
    middleDiv.classList.add("image-build-access-actual");
    middleDiv.setAttribute('data-id', myId);
    // middleDiv.setAttribute("name", "image_build_access_actual");
    middleDiv.setAttribute("id", "image_build_access_actual_" + myId);
    if (myId > 0)
    {
      middleDiv.classList.add("offset3");
    }
    topDiv.appendChild(middleDiv);
    
    // name
    nameOuterDiv = document.createElement("div"); 
    nameOuterDiv.classList.add("span4");
    middleDiv.appendChild(nameOuterDiv);

    nameInnerDiv = document.createElement("div"); 
    nameInnerDiv.classList.add("span12");
    nameOuterDiv.appendChild(nameInnerDiv);

    input = document.createElement("input");
    input.className = "span12";
    input.setAttribute("id", "image_build_access_name_" + myId);
    input.setAttribute("placeholder", "name");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "80");
    input.setAttribute('data-id', myId);
    input.style.marginBottom = "0px";
    nameInnerDiv.appendChild(input);

    // type
    typeOuterDiv = document.createElement("div"); 
    typeOuterDiv.classList.add("span4");
    middleDiv.appendChild(typeOuterDiv);

    typeInnerDiv = document.createElement("div"); 
    typeInnerDiv.classList.add("span12");
    typeOuterDiv.appendChild(typeInnerDiv);

    var select = document.createElement("select");
    select.style.width = "100%";
    select.style.marginBottom = "0px";
    select.setAttribute('data-id', myId);
    select.setAttribute("id", "image_build_access_type_select_" + myId);

    var op = new Option("Type", 0, true, true);
    op.disabled = true;
    op.hidden = true;
    select.appendChild(op);
          op = new Option("http", "http");
      select.appendChild(op);
    
    typeInnerDiv.appendChild(select);

    // port
    portOuterDiv = document.createElement("div"); 
    portOuterDiv.classList.add("span3");
    middleDiv.appendChild(portOuterDiv);

    portInnerDiv = document.createElement("div"); 
    portInnerDiv.classList.add("span12");
    portOuterDiv.appendChild(portInnerDiv);

    input = document.createElement("input");
    input.className = "span12";
    input.setAttribute("id", "image_build_access_port_" + myId);
    input.setAttribute("placeholder", "port");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "80");
    input.setAttribute('data-id', myId);
    input.style.marginBottom = "0px";
    input.style.textAlign = "right";
    portInnerDiv.appendChild(input);

    // trash
    trashOuterDiv = document.createElement("div"); 
    trashOuterDiv.classList.add("span1");
    trashOuterDiv.classList.add("row-fluid");
    middleDiv.appendChild(trashOuterDiv);

    button = document.createElement("button");
    button.classList.add("icon-button");
    // button.setAttribute("id", myId);
    button.style.paddingTop = "8px";
    trashOuterDiv.appendChild(button);

    icon = document.createElement("i");
    icon.classList.add("icon-trash");
    // icon.classList.add("icon-large");
    icon.setAttribute('data-id', myId);
    icon.addEventListener('click', deleteAccessContainerImage);
    button.appendChild(icon);

    if (myId > 0)
    {
      parent = document.getElementById("imageBuildModal_body");
      parent.appendChild(topDiv);
    }

    // scroll up in case we added more access elements that can be displayed together
    $("#imageBuildModal_body").animate({
      scrollTop:$("#imageBuildModal_body")[0].scrollHeight - $("#imageBuildModal_body").height()
    },100);

    return myId;
  }

  // from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md
  // node.remove polyfill for IE
  (function (arr) {
    arr.forEach(function (item) {
      if (item.hasOwnProperty('remove')) {
        return;
      }
      Object.defineProperty(item, 'remove', {
        configurable: true,
        enumerable: true,
        writable: true,
        value: function remove() {
          if (this.parentNode === null) {
            return;
          }
          this.parentNode.removeChild(this);
        }
      });
    });
  })([Element.prototype, CharacterData.prototype, DocumentType.prototype]);

</script>
  



	<script type="text/javascript">	
	//var projtypespan_elem = document.getElementById("breadcrumb-type-link");
	var projlinkspan_elem = document.getElementById("breadcrumb-proj-link");
	var projuserspan_elem = document.getElementById("breadcrumb-user-link");


         //projtypespan_elem.innerHTML = '<span class=\"use-pointer\" style=\"color: rgb(32, 57, 157);\" onclick=\"location.href=\'main.php?m=course&code=vc_2_0_05042022org265_326&step=890069\'\" tabindex=\"0\" role=\"button\">ACFv2BR-19623-a034N00000hZZgpQAG</span>';
      projlinkspan_elem.innerHTML = 
      '<span class=\"use-pointer\" style=\"color: rgb(32, 57, 157);\" onclick=\"location.href=\'main.php?m=course&code=vc_2_0_05042022org265_326&step=890069\'\" tabindex=\"0\" role=\"button\">Lab 1 -  Introduction to AWS IAM</span>';
     

  $("#breadcrumb-step-block").detach();

	
  $("#breadcrumb-vers-block").detach();
    
	
	</script>	
	
	


	
	

	

<link rel="stylesheet" href="main_data/codemirror.css">
<script src="main_data/codemirror.js"></script>

<script src="main_data/clike.js"></script>
<script src="main_data/xml.js"></script>
<script src="main_data/python.js"></script>
<script src="main_data/php.js"></script>

<script src="main_data/markdown.js"></script>
<script src="main_data/gfm.js"></script>
<script src="main_data/overlay.js"></script>

<link rel="stylesheet" href="main_data/neat.css">

<script src="main_data/javascript.js"></script>
<!-- removed from later versions
<script src="../shared/codemirror-5.25.2/keymap/extra.js"></script> 
-->
<script src="main_data/active-line.js"></script>
<script src="main_data/matchbrackets.js"></script>
<script src="main_data/search.js"></script>
<script src="main_data/searchcursor.js"></script>
<script src="main_data/dialog.js"></script>
<link rel="stylesheet" href="main_data/dialog.css">

<script src="main_data/closebrackets.js"></script>
<script src="main_data/closetag.js"></script>


<script src="main_data/diff_match_patch.js"></script>
<script src="main_data/merge.js"></script>
<link rel="stylesheet" href="main_data/merge.css">




<script src="main_data/css.js"></script>
<script src="main_data/sql.js"></script>

<link rel="stylesheet" href="main_data/show-hint.css">
<script src="main_data/show-hint.js"></script>
<script src="main_data/javascript-hint.js"></script>
<script src="main_data/html-hint.js"></script>
<script src="main_data/xml-hint.js"></script>
<script src="main_data/sql-hint.js"></script>
<script src="main_data/css-hint.js"></script>

<style type="text/css">

.breadcrumbs {
    z-index: 999 !important;
}

.content pre {
    padding: 5px 0px !important;
    margin: 0px 0px 4px !important;
    line-height: 15px !important;
    border: none !important;
    font-size: 12px !important;
    background: transparent !important;    
}

div:-webkit-full-screen {
  width: 100% !important;
  background-color: white;
}
div:-moz-full-screen {
  width: 100% !important;
  background-color: white;
}
div:-ms-fullscreen {
  width: 100% !important;
  background-color: white;
}
div:fullscreen {
  width: 100% !important;
  background-color: white;
}

/* While in fullscreen, hide any children with class 'tohide' */
:-webkit-full-screen .tohide {
  display: none;
}
:-moz-full-screen .tohide {
  display: none;
}
:-ms-fullscreen .tohide {
  display: none;
}
:fullscreen .tohide {
  display: none;
}

         


#page-content {
    position: absolute;
    left: 0;
    right: 0;
    top: 0px;
    bottom: 10px;
    background-color: white;
}

body > div > #page-content {
    top: 0px;
}
#page-content > div,
#page-content #editorbox,
#page-content #editordiv,
#page-content #editordiv > div,
#page-content #editordiv .tab-content #filelisting .widget-box,
#page-content #editordiv .tab-content #filelisting .widget-box .widget-body,

#page-content #editordiv #editorTabs,

#page-content #editordiv .tab-content,

#page-content #editordiv .tab-content #filelisting {
    height: 100%;
    overflow: auto;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box; 
}

#page-content #editordiv .tab-content #filelisting .widget-box {
    margin: 0;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

#page-content #editordiv .tab-content #codeframe,
#page-content #editordiv .tab-content #buildframe,
#page-content #editordiv .tab-content #htmlframe,
#page-content #editordiv .tab-content #terminalframe
#page-content #editordiv .tab-content #gradeframe
{
    height: 100%;
    position: relative;
    overflow: hidden;
}

#page-content #editordiv .tab-content #htmlframe
{
    background-color: white;
}


#page-content #editordiv .tab-content #codeframe #codeform0,
#page-content #editordiv .tab-content #htmlframe #div_htmlframe,
#page-content #editordiv .tab-content #buildframe #buildtextarea {
    position: absolute;
    top: 1px;
    bottom: 0;
    left: 4px;
    right: 4px;
}



.CodeMirror {
    font-size: 13px;
    border: 1px solid #eee;
    width: auto;
    height: 100%;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

.CodeMirror-scroll {
  overflow-y: auto;
  overflow-x: auto;
  margin-bottom: -10px !important;
  padding-bottom: 10px !important;
}


.CodeMirror-linenumber {
  color: #000 !important;
}

.CodeMirror-hints, .CodeMirror-hint, .CodeMirror-hint-active { 
    z-index:2147483647 !important;
}

#buildtextarea {
	background-color: white;
    overflow: auto;
    border: 1px solid light-gray;
    padding: 5px;
    margin-bottom: 0;
}

.tree {
  font-size: 12px;
}

.tree .tree-selected > [class*="icon-"]:first-child {
  color: 0 !important;
}

#video-viewer-modal {
    height: 80% !important;
}

#image-viewer-modal {
    height: 80% !important;
}

#gallery-viewer-modal {
    height: 80% !important;
}

#image-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#image-viewer-modal .modal-body table,
#image-viewer-modal .modal-body table tbody,
#image-viewer-modal .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#image-viewer-modal .modal-body table tbody td {
    text-align: center;
}

#image-viewer-modal .modal-body img {
    max-height: 100%;
    max-width: 100%;
}

.modal-80percent {
    height: 80% !important;
}

#other-viewer-modal {
    height: 80%;
}

#other-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#other-viewer-modal .modal-body table,
#other-viewer-modal .modal-body table tbody,
#other-viewer-modal .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#other-viewer-modal .modal-body table tbody td {
    text-align: center;
}

#other-viewer-modal .modal-body img {
    max-height: 100%;
    max-width: 100%;
}


#modal-table-widgetoutput {
    height: 80%;
}

#modal-table-widgetoutput .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#modal-table-widgetoutput .modal-body table,
#modal-table-widgetoutput .modal-body table tbody,
#modal-table-widgetoutput .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#modal-table-widgetoutput .modal-body table tbody td {
    text-align: center;
}

#modal-table-widgetoutput .modal-body img {
    max-height: 100%;
    max-width: 100%;
}

.widgetoutput pre {
    padding: 5px 0px !important;
    margin: 0px 0px 4px !important;
    line-height: 15px !important;
    border: none !important;
    font-size: 12px !important;
    background: transparent !important;    
}




#browser-viewer-modal {
    height: 80% !important;
}

#modal-upload-wait {
    height: 80% !important;
}

#modal-git-wait {
    height: 60% !important;
    width : 60% !important;
}

#browser-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    padding: 0px;
    left: 0;
    right: 0;
    top: 38px;
    bottom: 0;
}

#modal-table-report-all-html {
    height: 80% !important;
}

#modal-table-report-all-html .modal-body {
    max-height: none;
    position: absolute;
    padding: 0px;
    left: 0;
    right: 0;
    top: 38px;
    bottom: 0;
}

#report_aws_div .modal-body0 {
    position: relative;
    max-height: 100%;
    overflow-y: auto;
}

.vocidetoolbarbtn {
    background-color: transparent;
    border: 1px solid lightgray; 
    margin-right: 4px; 
    margin-left: 0px;
    color: rgb(0, 0, 0);}

.vmtoolbarbtn {
    border-radius: 3px!important;
    background-color: transparent;
    border: 1px solid lightgray; 
    margin-right: 4px; 
    margin-left: 0px;
    color: rgb(0, 0, 0);}

#waitClusterButton:disabled,
#waitClusterButton[disabled] {
  border: 0px;
}

#waitClusterButton:disabled:hover { 
  background-color: #abbac3 !important;
}

.jupyter-modal-td-file {
  text-align:left !important;
  border:0px !important; 
  padding-bottom:0px !important;
}
.jupyter-modal-td-checkbox {
  margin-bottom:6px !important;
  width:20px !important;
}


    .merge-modal-td-asn {
      text-align:left !important;
      border:0px !important; 
      padding-bottom:0px !important;
      padding-left:0px !important;
      padding-top:4px !important;
    }
    .merge-modal-td-checkbox {
      margin-bottom:6px !important;
      margin-right:6px !important;
      width:20px !important;
    }
  
.clabs-state-modal-tr-vm {
    border-bottom:1px solid lightgray;
}
.clabs-state-modal-td-vm {
  text-align:left !important;
  border:0px !important; 
  padding-bottom:0px !important;
}
.clabs-state-modal-td-state {
  text-align:right !important;
  border:0px !important; 
  padding-bottom:4px !important;
}

.icon-button {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    outline: none;
    border: 0;
    background: transparent;
}
</style>

      

	
    <div class="span12" id="editordiv" style="margin-left:0px;margin-right:0px;"><!-- editor and logs -->	

			    <div class="tabbable" id="editorTabs" style="overflow:hidden"> <!-- start tabbable -->
					    <ul class="nav nav-tabs" id="idenav" style=" margin-top:6px; 
                                                        
                                                        
                                                        "> <!-- ul tabs -->
									<!-- dropdown actions -->
                                   <div class="pull-right">

                    
                	

                
                                      
                  
                                      
                                                                                                      <div id="reports" class="btn-group" style="margin-left:0px;">
                          <div id="reportsdropdown" data-toggle="dropdown" class="dropdown-toggle btn vocbtn2 vocbtn-status" href="#" tabindex="0" role="button">
                             <i id="detailspinbox" class="icon-spin icon-spinner" style="display: none;"></i>
                             Details <i class="icon-caret-down"></i>
                          </div>
                          <ul class="dropdown-menu dropdown-info dropdown-yellow pull-right dropdown-caret dropdown-close" style="padding-top: 0px; border: 1px solid darkgray;">

                            <li>
                            <table class="table" style="margin-bottom:0px !important; border: 1px solid lightgray">
                                      <thead>
                                  <tr>
                                    <th style="width:140px">Details</th>
                                    <th></th>
                                  </tr>
      
                                      </thead>
                                      <tbody id="subdetails">
          
                                    		      
                                                                        
                                                                        <tr><td>AWS:</td><td> <div class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button" style="border:0px; line-height:17px !important" onclick="showawsact(0);" id="showawsbtn">Show</div></td></tr>                                                                          </tbody>

                                </table>
                                                                            
                                      
                            </li>  		      

                            
                                                                        
                                                                        
                      </ul>
                        </div>
                                         

                
                                
                
                                                                        
                                                                        
      <div class="btn-group" style="margin-left:0px;" id="awsbtn">
                      <div class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button">
                        AWS
                      </div>
                    </div>
                                                        <div class="btn-group" style="margin-left:0px;">
                      <div class="btn vocbtn2 vocbtn-status" data-toggle="tab" id="startawslab" href="#" tabindex="0" role="button" onclick="startawslab(1);">Start Lab</div>
                    </div>
                                                        <div class="btn-group" style="margin-left:0px;">
                      <div class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button" id="endawslab" onclick="endawslab(1);">
                        End Lab
                      </div>
                    </div>
                                                                                        <div class="btn-group" style="margin-left:0px;" id="awsstimeS">
                      <div class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button">
                                <span id="awsstimetxtS">&nbsp;1:53</span>&nbsp;&nbsp;
                         <div style="display:none;">
                                <span id="awsstimetxtT">&nbsp;00:00:00</span>&nbsp;&nbsp;
                                <span id="awsstimetxtB">&nbsp;$0.00</span>
                         </div>
                      </div>
                    </div>
                                 
                <!-- cluster start -->
                                <!-- cluster end -->
                
                <!-- new ide -->
                                
                                                                                <div class="btn-group" id="help-window" style="margin-left:0px;">
                    <div class="btn vocbtn2 vocbtn-status" tabindex="0" role="button" data-toggle="tab" href="#">
                          Instructions                      </div>
                </div>
                                                
                
                  <!-- commands end -->
                  <!-- commands start -->
                                          <!-- commands end -->

                                          <!-- Git actions -->
                        
                        <div id="liactions2" class="btn-group" style="margin-left:0px;">
                          <div id="actionsdropdown_liactions2" class="dropdown-toggle btn vocbtn2 vocbtn-status" href="#" tabindex="0" role="button">
                            <span id="editor-label-actions">Actions</span>
                            <i class="icon-caret-down"></i>
                          </div>

                          <ul class="dropdown-menu dropdown-info dropdown-yellow pull-right dropdown-caret dropdown-close">
                          
                                                   
                                                                                      <iframe id="dl_startercode" style="display:none;"></iframe>
                                   <script type="text/javascript">
                                      function downloadStartcode()
                                      {
                                        $.ajax({
                                                url: '../util/vcput.php?a=dlstartercode&stepid=890070&version=0',
                                                type: 'get',
                                                success: function(data) {
                                                        var ampos = data.search('msg::');
                                                        var bmpos = data.search('::msg');
                                                        var apos = data.search('voc::');
                                                        var bpos = data.search('::voc');
                                                        if(ampos>=0 && bmpos>=0 && bmpos>ampos ){
                                                          consolePrint(data.substring(ampos+5,bmpos));
                                                        }
                                                        if(apos>=0 && bpos>=0){
                                                          document.getElementById('dl_startercode').src = data.substring(apos+5,bpos);
                                                        }
                                                      }
                                             });
                                      }
                                      function downloadReports()
                                      {
                                        $.ajax({
                                                url: '../util/vcput.php?a=dlreports&stepid=890070&version=0',
                                                type: 'get',
                                                success: function(data) {
                                                        var ampos = data.search('msg::');
                                                        var bmpos = data.search('::msg');
                                                        var apos = data.search('voc::');
                                                        var bpos = data.search('::voc');
                                                        if(ampos>=0 && bmpos>=0 && bmpos>ampos ){
                                                          consolePrint(data.substring(ampos+5,bmpos));
                                                        }
                                                        if(apos>=0 && bpos>=0){
                                                          document.getElementById('dl_startercode').src = data.substring(apos+5,bpos);
                                                        }
                                                      }
                                             });
                                      }
                                      function downloadSolution()
                                      {
                                        $.ajax({
                                                url: '../util/vcput.php?a=dlsolution&stepid=890070&version=0',
                                                type: 'get',
                                                success: function(data) {
                                                        var ampos = data.search('msg::');
                                                        var bmpos = data.search('::msg');
                                                        var apos = data.search('voc::');
                                                        var bpos = data.search('::voc');
                                                        if(ampos>=0 && bmpos>=0 && bmpos>ampos ){
                                                          consolePrint(data.substring(ampos+5,bmpos));
                                                        }
                                                        if(apos>=0 && bpos>=0){
                                                          document.getElementById('dl_startercode').src = data.substring(apos+5,bpos);
                                                        }
                                                      }
                                             });
                                      }
                                   </script>

                                <li class="divider"></li>
                                                              <li>
                                    <a href="#" onclick="downloadStartcode()" tabindex="0" role="button">
                                        <i class="icon-arrow-down"></i>
                                          Download startercode
                                      </a>
                                </li>
                                <li id="download_solution" class="hidden-1">
                                    <a href="#" onclick="downloadSolution()" tabindex="0" role="button">
                                        <i class="icon-arrow-down"></i>
                                          Download solution
                                      </a>
                                </li>
                                                                                                             
                         
                         
                         
                         
                                                    <li class="divider"></li>
                           <li id="apps_dd_submenu" class="dropdown-submenu pull-left dropdown-caret dropdown-close">
                             <a tabindex="0" href="#">Applications</a>
                             <ul id="apps_dd_menu" class="dropdown-menu" style="padding-right:4px">
                                                                                                                                <li class="linux_app">
                                 <a data-toggle="tab" data-command="1" class="appbutton" href="#" tabindex="0" role="button">
                                   Eclipse                                   <i id="app_spinbox_1" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="2" class="appbutton" href="#" tabindex="0" role="button">
                                   MySQL WB                                   <i id="app_spinbox_2" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="5" class="appbutton" href="#" tabindex="0" role="button">
                                   pgAdmin                                   <i id="app_spinbox_5" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="3" class="appbutton" href="#" tabindex="0" role="button">
                                   Spyder                                   <i id="app_spinbox_3" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="4" class="appbutton" href="#" tabindex="0" role="button">
                                   Desktop                                   <i id="app_spinbox_4" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="6" class="appbutton" href="#" tabindex="0" role="button">
                                   Android Studio (beta)                                   <i id="app_spinbox_6" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="11" class="appbutton" href="#" tabindex="0" role="button">
                                   Thonny                                   <i id="app_spinbox_11" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                              <li class="divider"></li>
                               <li class="linux_app">
                                 <a data-toggle="tab" data-command="11" class="appstopbutton" href="#" tabindex="0" role="button">
                                   Stop App
                                   <i id="app_spinbox_stop" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                             </ul>
                           </li>
                         
                                                  
                                                  
                                                                                  <li class="divider"></li>
                                <li>
                                    <a href="#" onclick="confirmResetAsnBtn('../util/vcreset.php?vockey=XNq%2FfFNUfQ7fTY32Uz71Ew%3D%3D&amp;asnid=890069&amp;stepid=890070&amp;mode=s&amp;vmd=100')" tabindex="0" role="button">
                                        <i class="icon-undo"></i>
                                          Reset assignment
                                      </a>
                                </li>
                                                                                  
                                                    </ul>
                        </div>
                                  
                
                
                    
                    
		   		  
		        		  
                      </div>
							</ul> <!-- ul tabs end -->

                     <div class="tab-content" id="idebox" style="overflow:hidden; padding:4px; padding-bottom: 5px; "> <!-- tab-content start -->

                  
<!-- start of buildframe -->
<!-- end of buildframe -->
                              
                      
                                                            <textarea id="scratchpad" class="hide"></textarea>                                                                     
                                      <div id="ideButtonDiv" style="height: 30px; margin-top:4px; ">
                                                                                  <div class="clearfix"></div>
                                        
                                        <div class="pull-right ">
                                        <button type="button" id="editor-save-status-btn" class="vocidetoolbarbtn vobtn-status" style="display:none" tabindex="0" role="button">
                                        </button>
                                              <span id="editor-save-status" style="padding-right:5px" class=""></span>


                                                                                              <a class="btn btn-mini vocbtn_toolbar" style="margin-left: 4px !important; margin-right: 4px !important;" href="#" id="htmlreloadbtn">Reload</a>
                                              
                                        <button type="button" id="showfiletree" class="vocidetoolbarbtn" tabindex="0" role="button">
                                        Files
                                          <i class="bigger-110 icon-only icon-check" style="min-width: 15px; margin-left:4px" id="showfiletreeicon"></i>
                                        </button>
                               
                                                                              <button type="button" id="showdocs" class="vocidetoolbarbtn" tabindex="0" role="button">
                                          README
                                          <i class="bigger-110 icon-only icon-check-empty" style="min-width: 15px; margin-left:4px" id="showdocviewicon"></i>
                                        </button>
                                                                                                                    <button type="button" id="showterminal" class="vocidetoolbarbtn" tabindex="0" role="button">
                                          Terminal                                          <i class="bigger-110 icon-only icon-check-empty" style="min-width: 15px; margin-left:4px" id="showterminalicon"></i>
                                        </button>
                                        <button type="button" id="showcodeview" class="vocidetoolbarbtn" tabindex="0" role="button">
                                          Source                                          <i class="bigger-110 icon-only icon-check" style="min-width: 15px; margin-left:4px" id="showcodeviewicon"></i>
                                        </button>
                                                                                  <button type="button" id="showhtml" class="vocidetoolbarbtn" style="" tabindex="0" role="button">
                                            Html
                                            <i class="bigger-110 icon-only icon-check" style="min-width: 15px; margin-left:4px" id="showhtmlicon"></i>
                                          </button>
                                                                                
                                                                              </div>

                          <div id="filelistbuttons" class="pull-left" style="height: 27px; display: block;">
                              <div id="newbtn" class="btn-group pull-left" style="display:none">
                                <div id="newdropdown" data-toggle="dropdown" class="dropdown-toggle btn btn-mini vocbtn-status vocbtn_toolbar pull-left" href="#" tabindex="0" role="button" aria-label="New">
                                  <span style="font-size:12px;">New</span>
                                  <i class="icon-caret-down"></i>
                                </div>
                                <ul class="dropdown-menu dropdown-info dropdown-caret dropdown-close" style="text-align:left">
                                  <li class="divider"></li>
                                  <li>
                                      <div href="#" id="filenewbtn" tabindex="0" role="button" aria-label="File">
                                           File
                                      </div>
                                  </li>
                                  <li>
                                    <div href="#" id="foldernewbtn" tabindex="0" role="button" aria-label="Folder">
                                         Folder
                                    </div>
                                  </li>
                                </ul>
                              </div>
                              <div href="#" id="filerenamebtn" class="btn btn-mini vocbtn-status vocbtn_toolbar pull-left" style="display:none" tabindex="0" role="button" aria-label="Rename">
                                  Rename
                              </div>
                              

                              <div href="#" id="filedelbtn" class="btn btn-mini vocbtn-status vocbtn_toolbar pull-left" style="display:none" tabindex="0" role="button" aria-label="Delete">
                                  Delete
                              </div>

                              <div href="#" id="fileuploadbtn" class="btn btn-mini vocbtn-status vocbtn_toolbar pull-left" style="display:none" tabindex="0" role="button" aria-label="Upload">
                                   Upload
                              </div>
                              <form id="fileuploadform" action="" enctype="multipart/form-data" method="post" style="display:none">
                                  <input type="file" id="fileuploadfield" name="fileuploadfield" multiple="">
                              </form>
                              
                            <div href="#" id="filecopybtn" class="btn btn-mini vocbtn-status vocbtn_toolbar pull-left" style="display: block;" tabindex="0" role="button" aria-label="Copy">
                                   Copy
                            </div>
                            <div href="#" id="filepastebtn" class="btn btn-mini vocbtn-status vocbtn_toolbar pull-left" style="display:none" tabindex="0" role="button" aria-label="Paste">
                                   Paste
                            </div>
                              <div href="#modal-table-download_from_ide" data-toggle="modal" id="downloadbtn" style="" tabindex="0" role="button" aria-label="Download" class="pull-left btn btn-mini vocbtn-status vocbtn_toolbar" title="Download the selected item">
                                <i class="icon-download-alt icon-large"></i>
                              </div>
                              
                            <div id="cmdprogressbtn" class="pull-left" style="margin-top: 2px; margin-left: 4px; display: none;"><i class="icon-spin icon-spinner"></i></div>
                            <div id="filestatuslabel" class="pull-left" style="font-size:12px; margin-top:2px; margin-left:4px;"></div>

                           </div> <!-- filelistbuttons -->

                                          <div id="editor_current_file_div" style="text-align:center;padding:2px 0px 0px 0px; margin:0px;
                                            background-color:rgb(255, 255, 255);color: rgb(0, 0, 0);border:none;">
                                              <span id="file_colon" style="display:none;" class="">File:</span>
                                              <span id="editor_current_file" style="display: inline-block; vertical-align: top; max-width: 500px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" class="">resource/asnlib/public/docs/lang/pt-br/README.html</span>
                                                                                            <span id="editor_current_ts" class=""><span>
                                          </span></span></div> <!-- editor_current_file_div -->

                               
                                      </div> <!-- ideButtonDiv -->
                                  
                                  

                                  
                       <!--   mhui -->
                       <!-- gradepanel -->

<div id="gradeframe" class="span1" style="float: right; width:250px; height: 100%; border: 1px solid lightgray; margin-bottom: 0px; margin-right: 0px; margin-left: 0px; display: none;">
  <div id="grades-panel" style="border: 0px solid red; width: 100%; height: 100%;">
    <div id="gradeframehide" tabindex="0" role="button" aria-label="Close grade panel" class="" style="float: right; cursor: pointer; padding: 5px 8px 8px 8px; line-height: 20%; margin-right: 8px; font-size: 200%; border: 0px solid red;">-</div>
      <div class="btn-group span2" id="gradedetails" style="float: right; padding-top: 5px; display: none;">
        <a href="https://labs.vocareum.com/main/main.php?m=editor&amp;asnid=890069&amp;stepid=890070&amp;hideNavBar=1" target="_blank" class="btn vocbtn2 vocbtn-status" tabindex="0" role="button">Details
        </a>
      </div>
    <div style="clear: right;"></div>
    <div id="gradespinner" class="center hidden-1" style="border: 0px solid red; width: 100%; height: 100%; margin-top: 20px; background-color: #fff;">
      <i class="icon-spinner icon-spin light-grey bigger-275" style="width: 42px; height: 42px; margin: auto;"></i>
    </div>
    <iframe style="overflow: auto; border: 0px solid blue; width: 100%; height: 100%;" src="about: blank"></iframe>
  </div>
</div>

<div class="span1 ui-draggable" id="gradeframedivider" style="float: right; border: 0px solid red; display: none; display:none; width:8px; height:90%; margin:0px; background:url('../shared/img/vocdivider-v.png') no-repeat scroll 3px 50% transparent;padding: 5px 0px;cursor: col-resize;"></div>



<script type="text/javascript">

var addEvent = function(object, type, callback) {
    if (object == null || typeof(object) == 'undefined') return;
    if (object.addEventListener) {
        object.addEventListener(type, callback, false);
    } else if (object.attachEvent) {
        object.attachEvent("on" + type, callback);
    } else {
        object["on"+type] = callback;
    }
};

addEvent(window, "resize", function(event) {
        var jde = false;
        var rde = false;
        
        if (document.getElementById('gradeframe').style.display === 'none') {
          if (jde || rde) {
               $('#jupyterIframeParent').width($('#jidebox').width());
          }
        } else {
          if (jde || rde) {
             $('#jupyterIframeParent').width(document.getElementById('gradeframedivider').offsetLeft-5);
          }
       }
});

$('#gradeframehide').on('click', function() {
    var jde = false;
    var rde = false;
    
      document.getElementById('gradeframe').style.display = "none";
      document.getElementById('gradeframedivider').style.display = "none";
      if (jde || rde) {
           $('#jupyterIframeParent').width($('#jidebox').width());
      }

});

var input = document.getElementById("gradeframehide");

//Execute a function when the user releases a key on the keyboard
input.addEventListener("keyup", function(event) {
// Number 13 is the "Enter" key on the keyboard
if (event.keyCode === 13) {
 // Cancel the default action, if needed
 event.preventDefault();
 // Trigger the button element with a click
 document.getElementById("gradeframehide").click();
}
});

$('#gradeframedivider').draggable({
axis: 'x',
containment: 'parent',
helper: 'clone',
iframeFix: true,
drag: function (event, ui) {
    var jde = false;
    var rde = false;
    var filetree = true;
    
    if (jde || rde)
    {
      var jidebox_width = $('#jidebox').width();
      var width = jidebox_width - ui.offset.left;
      //if (width < 100) return;

      $('#gradeframe').width(width);
      $('#jupyterIframeParent').width(ui.offset.left-10);
      $('#jupyterIframeParent').css('pointer-events', 'none');
    }
    else
    {
      var width = $("#idebox").width() - ui.offset.left;
      var width_of_right_panel = $("#idebox").width() - width - $('#filelisting').width();
      if (width_of_right_panel < 200) {
        return;
      }
      if (width < 100) {
        return;
      }
      $('#gradeframe').width(width);
    }
},

start: function() {
    var jde = false;
    var rde = false;
    
    if (jde || rde)
    {
    	$('#jupyterIframe').css('pointer-events', 'none');
    }
        // Temporarily disable mouse events for terminal
      $('#terminalIframe').css('pointer-events', 'none');
              $('#readeMeIframe').css('pointer-events', 'none');
    },

stop: function() {
    var jde = false;
    var rde = false;
    
    if (jde || rde)
    {
    	$('#jupyterIframe').css('pointer-events', 'auto');
    }
        // Re-enable mouse events for terminal
      $('#terminalIframe').css('pointer-events', 'auto');
              $('#readeMeIframe').css('pointer-events', 'auto');
    }

});

</script>
                       
                       
                        <div id="filelisting" class="span1" style="margin-left: 0px; width: 200px; min-width: 200px; transform: translate3d(0px, 0px, 0px); height: 309px; display: block;"> <!-- listing -->
                          <!-- file buttons -->
                          <div tyle="min-width:200px; text-align:center;padding:1px 0px 0px 0px; margin:0px;
                              background-color:rgb(248, 248, 248);color: rgb(153, 153, 153);border:none;">


                              <div class="clearfix"></div>

                              <div class="well" id="well_selectedfile" style="margin: 3px 0px 0px; padding: 2px 2px 1px 10px; font-size: 12px; color: black; border-image: none; border-width: 1px 1px medium; border-style: solid solid none; text-align: left;"><span id="span_selectedfile">resource/asnlib/public/docs/lang/pt-br/README.html</span></div>


                          </div>
                          <!-- file buttons end -->

                               <div id="innerfilelisting" style="min-width:300px;height:100%;padding-bottom:40px !important;"> <!-- prevents file name breaking -->
                                    <div id="fileform" class="hide" style="text-align: center; padding: 0px; margin: 0px; background-color: rgb(248, 248, 248); color: rgb(153, 153, 153); border: medium none; display: none;">
                                          <input class="pull-left span12" type="text" id="input_filename" placeholder="type name here" style="margin-bottom:0px" value="resource/asnlib/public/docs/lang/pt-br/README.html">
                                          <input type="hidden" id="input_filetype" value="file">
                                          <div href="#" id="filecreatebtn" class="btn btn-mini vocbtn-action vocbtn_toolbar pull-left" style="padding: 0px 8px !important" tabindex="0" role="botton">
                                              Submit
                                          </div>
                                          <div href="#" id="filecancelbtn" class="btn btn-mini vocbtn-status vocbtn_toolbar pull-left" style="padding: 0px 8px !important" tabindex="0" role="botton">
                                              Cancel
                                          </div>
                                    </div> <!-- fileform -->
                                    <div class="clearfix"></div>

                                    <div id="tree1" class="tree tree-selectable" style="background:white;"><div class="tree-folder" style="display:none;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"></div>			</div>			<div class="tree-item" style="display: none; user-select: none;">				<i class="icon-caret-right"></i>				<div class="tree-item-name"></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>resource</b></span><i class="icon-lock bigger-140" style="padding-left:4px"></i></div>				</div>				<div class="tree-folder-content" style="display: block;"><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>lib</b></span><a class="badge badge-info pointer pull-right voc-tree-help tree-btn" tabindex="0" role="button" style="margin-right: 20px;" data-target="#LIB-help-modal" data-toggle="modal">?</a></div>				</div>				<div class="tree-folder-content" style="display: block;"><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>publicdata</b></span></div>				</div>				<div class="tree-folder-content" style="display: none;"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>public</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>asnlib</b></span><a class="badge badge-info pointer pull-right voc-tree-help tree-btn" tabindex="0" role="button" style="margin-right: 20px;" data-target="#ASNLIB-help-modal" data-toggle="modal">?</a></div>				</div>				<div class="tree-folder-content"><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>publicdata</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>public</b></span></div>				</div>				<div class="tree-folder-content"><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>docs</b></span></div>				</div>				<div class="tree-folder-content"><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>lang</b></span></div>				</div>				<div class="tree-folder-content"><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>en-us</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>en-us-cli</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>es-es</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>id-id</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>ja-jp</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>ko-kr</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-minus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>pt-br</b></span></div>				</div>				<div class="tree-folder-content"><div class="tree-item tree-selected" style="user-select: none; display: block;">				<i class="icon-caret-right"></i>				<div class="tree-item-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">README.html</span></div>			</div><div class="tree-item" style="user-select: none; display: block;">				<i class="icon-caret-right"></i>				<div class="tree-item-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">README.md</span></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>images</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>zh-cn</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>scripts</b></span><a class="badge badge-info pointer pull-right voc-tree-help tree-btn" tabindex="0" role="button" style="margin-right: 20px;" data-target="#Scripts-help-modal" data-toggle="modal">?</a></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>startercode</b></span></div>				</div>				<div class="tree-folder-content"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div><div class="tree-folder" style="display: block;">				<div class="tree-folder-header" style="user-select: none;">					<i class="icon-plus"></i>					<div class="tree-folder-name"><span class="tree-btn" tabindex="0" role="button" style="display: inline-block; vertical-align: top; max-width: 75%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><b>work</b></span><span id="workunsubmitted" class="label label-important" style="margin-left:6px;padding:3px 8px 1px;display:none">Submit needed</span></div>				</div>				<div class="tree-folder-content" style="display: none;"></div>				<div class="tree-loader" style="display: none;"><div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div></div>			</div></div>
                                                                        <div id="trees3" class="tree" style="background:white;"></div>
                                    

                                    <script type="text/javascript">
                                    var $assets = "assets";//this will be used in fuelux.tree-sampledata.js
                                    </script>
                               </div> <!-- innerfilelisting -->
                        </div>	<!-- filelisting end -->
                                                  <div class="span1 vocdivider ui-draggable" id="filelistdivider" style="width: 8px; height: 90%; margin: 0px; background: transparent url(&quot;../shared/img/vocdivider-v.png&quot;) no-repeat scroll 3px 50%; padding: 5px 0px; cursor: col-resize; display: block;"></div>
                                                <!-- <div id="rightdiv">   anything right of the vertical divider -->
                        
                                    

                                                <div id="instructions" class="span1 " style="height: 98%; margin-left: 0px; border-top: 1px solid rgb(238, 238, 238); width: 617px; min-width: 200px; display: none;"> <!-- instructions -->
                          <div class="content" style="height: 98%">
                                 <span id="readmeframehide" tabindex="0" role="button" aria-label="Close panel" style="float: right; cursor: pointer; padding: 5px 8px 8px 8px; line-height: 20%; margin-right: 8px; font-size: 200%; border: 0px solid red;   ">-</span>
                                                                  <span id="readmeframelang" style="float: left; cursor: pointer;">
                                   <select style="margin: 5px;" id="localeLangReadmeSelect">
                                                                          <option value="en-us">EN-US</option>
                                                                          <option value="en-us-cli">EN-US-CLI</option>
                                                                          <option value="es-es">ES-ES</option>
                                                                          <option value="id-id">ID-ID</option>
                                                                          <option value="ja-jp">JA-JP</option>
                                                                          <option value="ko-kr">KO-KR</option>
                                                                          <option value="pt-br" selected="selected">PT-BR</option>
                                                                          <option value="zh-cn">ZH-CN</option>
                                                                        </select>
                                 </span>
                                                                   <iframe id="readMeIframe" name="readMeIframe" title="README" src="main_data/README.htm" style="overflow:none;border:2px;position:relative; border-top: 1px solid #eee;" width="100%" height="95%"></iframe>
			  </div>
			</div>
                        <div class="span1 vocdivider  ui-draggable" id="instructionsdivider" style="width: 8px; height: 100%; margin: 0px; background: transparent url(&quot;../shared/img/vocdivider-v.png&quot;) no-repeat scroll 3px 50%; padding: 5px 0px; cursor: col-resize; display: none;"></div>
                       			
                       <div id="htmlframe" class=" hide" style="height: 184.746px; display: block;">
                         <div id="div_htmlframe" style="height: 98%; border:1px solid lightgray">
                           <div id="div_html_frame_inner" style="height: 100%; width:100%;"><iframe id="htmliframe" src="main_data/README_002.htm" style="border:0px" title="HTML" width="100%" height="100%"></iframe></div>
                         </div>
                       </div>

                        <div class="vocdivider_h1 ui-draggable" id="html_divider" style="display: none; height: 3px; padding-top: 2px !important; padding-bottom: 2px !important; margin: 0px; overflow: hidden; background: transparent url(&quot;../shared/img/vocdivider-h.png&quot;) no-repeat scroll center 50%; padding-right: 0px; padding-left: 0px; cursor: row-resize;">
                        </div>

                              <div id="codeframe" class="" style="margin-right: 0px; height: 184.746px; display: block;">

                                  <div id="div_codeform0_or_draw" style="height: 100%">
                                    <div id="div_codeform0" style="height: 100%">
                                      <form id="codeform0" style="margin-bottom: 0px; position: absolute; height: 100%;">
                                        <textarea id="codearea0" aria-label="Source code" style="display: none;">Choose a file to load from the Files menu on the left</textarea><div class="CodeMirror cm-s-neat CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 173px; left: 92px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" wrap="off">-</textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none; display: block; bottom: 0px;"><div style="min-width: 1px; height: 22219px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 30px; min-height: 22199px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"><div class="CodeMirror-selected" style="position: absolute; left: 4px; top: 0px; width: 970px; height: 13px;"></div><div class="CodeMirror-selected" style="position: absolute; left: 4px; top: 22178px; width: 49px; height: 13px;"></div><div class="CodeMirror-selected" style="position: absolute; left: 4px; top: 13px; width: 970px; height: 22165px;"></div></div><div class="CodeMirror-cursors" style="visibility: hidden;"></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;" class=""><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-meta">&lt;!doctype html&gt;</span></span></pre></div><div style="position: relative;" class=""><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">meta</span> <span class="cm-attribute">charset</span>=<span class="cm-string">'UTF-8'</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">meta</span> <span class="cm-attribute">name</span>=<span class="cm-string">'viewport'</span> <span class="cm-attribute">content</span>=<span class="cm-string">'width=device-width initial-scale=1'</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;" class=""><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text=""></span></span></pre></div><div style="position: relative;" class=""><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">link</span> <span class="cm-attribute">href</span>=<span class="cm-string">'https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&amp;subset=latin,latin-ext'</span> <span class="cm-attribute">rel</span>=<span class="cm-string">'stylesheet'</span> <span class="cm-attribute">type</span>=<span class="cm-string">'text/css'</span> <span class="cm-tag cm-bracket">/&gt;&lt;</span><span class="cm-tag">style</span> <span class="cm-attribute">type</span>=<span class="cm-string">'text/css'</span><span class="cm-tag cm-bracket">&gt;</span>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">.mac-os-11 { --title-bar-height: 28px; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit inherit; background-repeat: inherit inherit; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">iframe { margin: auto; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">a.url { word-break: break-all; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">a:active, a:hover { outline: 0px; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">#write.first-line-indent p { text-indent: 2em; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">#write.first-line-indent li { margin-left: 2em; }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation">.for-image #write { padding-left: 8px; padding-right: 8px; }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 22199px;"></div><div class="CodeMirror-gutters" style="height: 22229px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div>
                                      </form>
                                    </div>
                                                                      </div>
                                  
                              </div> <!-- end of codeframe -->
                  
                        <div class="vocdivider_h2 ui-draggable" id="console_divider" style="display: none; height: 3px; padding-top: 2px !important; padding-bottom: 2px !important; margin: 0px; overflow: hidden; background: transparent url(&quot;../shared/img/vocdivider-h.png&quot;) no-repeat scroll center 50%; padding-right: 0px; padding-left: 0px; cursor: row-resize;">
                        </div>


<!-- start of buildframe -->
            <div id="buildframe" class="" style="height: 0px; padding-left: 4px; padding-right: 4px; margin-left: 0px; display: none;">
                

                                    <script type="text/javascript">	
                      var vocdomain = document.domain.split('.').slice(-2).join('.')
                      document.domain = vocdomain;
                    </script>


                    <div class="widget-box row-span" style="margin:1px 0px; border:1px solid lightgray">
                        <div class="widget-body">
                      <div class="widget-main" style="padding:0px">
                                <div id="consolediv" class="tab-pane " style="height: 0px; display: none;">
                                                                  <iframe id="terminalIframe" name="terminalIframe" title="Console" src="main_data/a_003.htm" style="overflow:none;border:0px" width="100%" height="100%"></iframe>
                                                                </div>
                            </div>
                        </div>
                    </div>
                
            </div> <!-- buildframe -->
                              
            
            
<!-- end of buildframe -->

<!-- Panel 2 -->
										</div> <!-- tab-content end -->

				  </div><!-- end tabbable -->

	  <div id="modal-table-report-aws" class="modal hide fade" tabindex="-1" style="height: 80% !important; overflow: auto; display: none;" aria-hidden="true">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px" id="aws-modal-label">Start Lab</span>
    </div>
  </div>

   <div id="report_aws_div" class="modal-body0 no-padding">
     <p id="report_aws_msg_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;overflow: auto;">Region: us-east-1<br>Lab
 ID: 
arn:aws:cloudformation:us-east-1:730761632345:stack/c54610a890070l2120914t1w730761632345/b756a0b0-d451-11ec-b699-0e02418742a3<br>Creation Time: 2022-05-15T06:19:57-0700<br><br>Refresh session at: 2022-05-15T06:20:17-0700<br>Remaining session time: 02:00:00(120 minutes)<br></p>
   </div>
   <div class="modal-body0 no-padding">
     <p id="report_aws_progress_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;overflow: auto;">Lab status: ready<br></p>
   </div>

</div></div> <!-- editor and logs -->



	</div> <!-- end dirs and editor -->

<!-- start of modals -->


<!-- view output start -->
							<div id="modal-table-output" class="modal hide fade" tabindex="-1">
								<div class="modal-header no-padding">
									<div class="table-header">
										<button type="button" class="close" data-dismiss="modal">
											<h3>Close</h3>
										</button>
											<span style="font-size:20px">Output</span>
									</div>
								</div>

								<div class="modal-body no-padding" id="div-output" style="height:600px;">

								</div>
							</div>
<!-- end view output -->

<!-- diff window -->
							<div id="modal-table-diff" class="modal hide fade" tabindex="-1">
								<div class="modal-header no-padding">
									<div class="table-header">
										<button type="button" class="close" data-dismiss="modal">
																						<h3>Close</h3>
										</button>
											<span style="font-size:20px">View Changes</span>
									</div>
								</div>

								<div class="modal-body no-padding" id="div-diff">

								</div>
							</div>
<!-- end diff window -->

<!-- video viewer -->
    <div id="video-viewer-modal" class="modal hide fade" tabindex="-1">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal"></button>
                Video viewer
            </div>
				</div>

        <div class="modal-body">
            <table><tbody><tr><td>
               <div id="video-viewer-modal-div">
              </div>
            </td></tr></tbody></table>
        </div>
   </div>
<!-- end video viewer -->
<!-- image viewer -->
    <div id="image-viewer-modal" class="modal hide fade" tabindex="-1">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal"></button>
                Image viewer
            </div>
				</div>

        <div class="modal-body">
            <table><tbody><tr><td>
                            <img id="image-viewer-modal-image">
            </td></tr></tbody></table>
        </div>
   </div>
<!-- end image viewer -->

<!-- largefile viewer -->
    <div id="largefile-viewer-modal" class="modal hide fade" tabindex="-1" style="height:200px">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal"></button>
                File too big for viewer
            </div>
				</div>

        <div class="modal-body">
                <h4>The file is too big for the viewer. Please download the file instead.</h4>
                <br><mute>Only files smaller than 1 MB are shown in the viewer.</mute>
        </div>
   </div>
<!-- end largefile viewer -->


<!-- Uploader -->
 <div id="modal-upload-wait" class="modal hide fade" tabindex="-1">
   <div class="modal-header no-padding">
     <div class="table-header">
       <button type="button" class="close" onclick="afterUpload();" data-dismiss="modal"></button>
       <span style="font-size:20px">Status</span>
     </div>
   </div>

   <div id="uploadWaitMsgDiv" class="modal-body no-padding">
     <p id="uploadWaitMsgBox" style="margin-left: 20px !important;"></p>
   </div>
 </div>

<!-- other viewer -->
    <div id="other-viewer-modal" class="modal hide fade" tabindex="-1">
      <div class="modal-header no-padding">
        <div class="table-header">
          <button type="button" class="close" data-dismiss="modal"></button>
            File viewer
        </div>
      </div>

      <div class="modal-body">
          <table><tbody><tr><td>
               <object type="application/pdf" id="other-viewer-modal-area" width="100%" height="100%">No default viewer found</object>
          </td></tr></tbody></table>
      </div>
    </div>
<!-- end other viewer -->
<!-- browser viewer -->
    <div id="browser-viewer-modal" class="modal hide fade" tabindex="-1">
      <div class="modal-header no-padding">
        <div class="table-header">

          <button type="button" class="close" data-dismiss="modal"></button>
          <span id="browser-viewer-title">Viewer</span>
          <a class="" target="_blank" href="" id="browser-viewer-link">
							<i style="margin-left:10px" class="icon-external-link icon-only white"></i>
					</a>
        </div>
      </div>

      <div class="modal-body" id="browser-viewer-body">
          <iframe id="browser-viewer-iframe" src="main.htm" width="100%" height="100%" frameborder="0"></iframe>
      </div>
    </div>
<!-- browser viewer -->


<div id="Scripts-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                Scripts            </span>
        </div>
    </div>
    <div class="modal-body">
        Specify the shell scripts that will be run during various 
phases. These scripts are always run in a directory which has a copy of 
student submission.
    </div>
</div>
<div id="Grading-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                Grading
            </span>
        </div>
    </div>
    <div class="modal-body">
Grading script - this script can be run for grading student submission. 
It can either be run in batch on all student submissions from the 
control panel or can be run on an individual student submission by 
selecting the grading button from the grading panel. You can test this 
script by selecting Run Scripts =&gt; Grading. The script will be run 
in the work directory in this IDE.
    </div>
</div>

<div id="RUN-help-modal" class="modal hide fade modal-80percent" tabindex="-1">
    <div class="modal-header no-padding">
        <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                RUN
            </span>
        </div>
    </div>
    <div class="modal-body">
If this script is specified then a Run button shows up on student IDE 
which the user can execute. This script runs on the student work 
directory unlike Submission script which runs on submitted assignment.
    </div>
</div>
<div id="BUILD-help-modal" class="modal hide fade modal-80percent" tabindex="-1">
    <div class="modal-header no-padding">
        <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                BUILD
            </span>
        </div>
    </div>
    <div class="modal-body">
If this script is specified then a Build button shows up on student IDE 
which the user can execute. This script runs on the student work 
directory unlike Submission script which runs on submitted assignment.
    </div>
</div>
<div id="Submission-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                Submission
            </span>
        </div>
    </div>
    <div class="modal-body">
Submission script - this script is run when the student submits his/her 
assignment. You can use this script to either perform sanity checks like
 whether the submission compiles or can run either some or all of tests 
that will be used to grade the submission. Note: this script runs on 
last submitted assignment for the user. You can test this script by 
selecting Run Scripts =&gt; Submission. It will be executed in the 
work directory of this IDE.
    </div>
</div>
<div id="LIB-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                LIB            </span>
        </div>
    </div>
    <div class="modal-body">
$LIB - Use this directory to store resource files common to more than 
one assignment for this course. Assignment specific resources should be 
stored in $ASNLIB.
    </div>
</div>
<div id="ASNLIB-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                ASNLIB            </span>
        </div>
    </div>
    <div class="modal-body">
$ASNLIB - This is a directory where the teacher can store all the files 
that are needed to run scripts. This directory is not visible to or 
accessible by the students.
    </div>
</div>
<div id="StarterCode-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal"></button> &nbsp;
            <span class="modal-title">&nbsp;
                StarterCode            </span>
        </div>
    </div>
    <div class="modal-body">
All the files in this directory are copied to the student work area when
 s/he starts working on the assignment. Once the student has started 
working on the assignment, any changes made to the starter code are not 
reflected in the student work area.
    </div>
</div>

<div id="modal-table-download_from_ide" class="modal hide fade" tabindex="-1" style="height:200px">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
	<h3>Close</h3>
      </button>
      <span style="font-size:15px">Preparing ZIP File</span>
    </div>
  </div>
  
  <div class="modal-body" id="div-output-download_from_ide" style="height:200px;">
  
  </div>
</div>

<div id="modal-table-od_terminal" class="modal hide fade" tabindex="-1" style="height:400px">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
	<h3>Close</h3>
      </button>
      <span style="font-size:15px">Terminal</span>
    </div>
  </div>
  
  <div class="modal-body no-padding" id="div-output-od_terminal" style="height:360px">
  
  </div>
</div>
<div id="modal-table-report-db" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Database Credentials</span>
    </div>
  </div>

   <div id="report_db_div" class="modal-body no-padding">
     <p id="report_db_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>

<script type="text/javascript">

var autoloadFileOccured = 0;

function sshkeyboxdownload(s, f)
{
  var t = document.createElement('a');
  t.setAttribute('href', 'data:application/octet-stream;charset=utf-16le;base64,' + s);
  t.setAttribute('download', f);
  t.style.display = 'none';
  document.body.appendChild(t);
  t.click();
  document.body.removeChild(t);
}
function ssodownload(id)
{
  $.ajax({
    url: '../util/vcput.php',
    type: 'post',
    data: {
      a: 'ssodownload',
      data:id,
      step:890070    },
    success: function(data) {
      if( data.search(/^Error/) >=0 ){
        alert(data);
      } else {
        sshkeyboxdownload(data, 'ssourl.txt');
      }
    },
    fail: function(data) {
      alert('Failed to retrieve SSO URL');
    }
  });
}
  function sshkeyboxshow(){
     $("#sshkeybox").show();
     $("#sshkeyboxbtn").hide();
  }
  function clikeyboxshow(){
     $("#clikeybox").show();
     $("#clikeyboxbtn").hide();
  }
</script>
<div id="modal-table-report-buildclabs" class="modal hide fade" tabindex="-1" style="height:65% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" id="clabscls" class="close" data-dismiss="modal" onclick="endvm()"></button>
      <span style="font-size: 15px">Build Labs</span>
    </div>
    <br>
    <div class="control-group">
        <div class="controls">
          <div class="row-fluid">
            <div class="span3" style="margin-left: 20px;">
              <select id="clabstype" name="clabstype" class="span6" onchange="chgvmtype();">
                  <option value="ct" selected="selected">Container</option>
                                  <option value="cl">VM</option>
                              </select>
            </div>
            
            <div class="span3" style="margin-left: 20px; display: none;">
              <select id="clabsamis" name="clabsamis" class="span6">
              </select>
            </div>

            <div class="span6" style="float: left;width: 700px; border: 0px solid red; font-size: 13px; display:block">
                Systemuser <input id="systemuser" name="systemuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" type="text">
                Scriptuser <input id="scriptuser" name="scriptuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" type="text">
                Labuser <input id="labsuser" name="labsuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" type="text">
                Sudo <input class="span1" style="margin-right: 20px;" id="labssudo" name="labssudo" type="checkbox">
            </div>
            
          </div>
        </div>
    </div>
  </div>
  <div id="report_buildclabs_div" class="modal-body no-padding" style="height:100%; !important;">
     <table class="table table-first-column-check table-hover" id="clabstbl" style="border-top: 0 !important;">
       <tbody><tr><th style="text-align:center;"><input class="span1" style="margin-right: 20px; width:40%" id="clabschk" onclick="chkvm();" type="checkbox"></th>
                    <th>Dockerfile </th>
           <th>Init File</th>
           <th>Hostname</th>
           <th>Port</th>
           <th>Script</th>
           <th>Persistent Workarea</th>
           <th>Status</th>
           <th></th>
               </tr>
          </tbody></table>
     <div style="margin-left:10px;">
       <div id="clabsstatus" class="hidden-1">
         <p id="clabselapsed"></p><p><i class="icon-spin icon-spinner"></i>
         Build is in progress, it can take a few minutes to complete.
       </p></div>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 10px !important;" id="clabsbtnadd" onclick="addvm()">Add</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" id="clabsbtndel" onclick="delvm()">Delete</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" id="clabsbtnbld" onclick="bldvm()">Build</a>
       <a id="saveVmBtn" class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" onclick="savevm(false)">Save</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" onclick="clsvm()">Close</a>
     </div>
     <hr>
     <p id="report_buildclabs_msg_box" style="margin-left: 10px;height:100%; !important; font-family: Courier;"></p>
   </div>
</div>

<div id="modal-table-report-cdb" class="modal hide fade" tabindex="-1" style="height:40% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Database Credentials</span>
    </div>
  </div>

   <div id="report_cdb_div" class="modal-body no-padding">
     <p id="report_cdb_msg_box" style="margin-left: 10px;height:30%; !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-clabs" class="modal hide fade" tabindex="-1" style="height:70% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Container Lab</span>
    </div>
  </div>

   <div id="report_clabs_div" class="modal-body no-padding">
     <p id="report_clabs_msg_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-web" class="modal hide fade" tabindex="-1" style="left:5%; width:90% !important; height:15% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Web/WebSocket Details</span>
    </div>
  </div>

   <div id="report_web_div" class="modal-body no-padding">
     <p id="report_web_msg_box" style="margin-left: 10px !important; font-family: Courier; margin-top: 5px;"></p>
   </div>
</div>





<div class="modal hide fade" id="imageBuildModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
  <div id="imageBuildModal_dialog" class="modal-dialog "> <!-- jupyter-modal-dialog -->
    <div id="imageBuildModal_content" class="modal-content">

      <div id="imageBuildModal_header" class="modal-header">
        <h3>Build Container Image</h3>
        <h6>
          The build context will be the resource/lib directory; the dockerfile also needs to be placed there.
        </h6>
                  <h6>
            If you're building a new image, please select the base 
Vocareum docker image. Also, please make sure you do not have any "FROM"
 directive in your dockerfile.
          </h6>
                </div>

      <div id="imageBuildModal_body" class="modal-body" style="padding-bottom: 0px; max-height:250px">

        <div class="control-group row-fluid">
          <div class="span2" style="padding-top:3px">
            <label class="control-label"></label>
          </div>
          <div class="span5" id="imageBuildModal_select_div">
            <select id="imageBuildModal_select" name="imageBuildModal_select" style="width:100%">
              <option selected="selected" disabled="disabled" hidden="">Select image</option>
              <optgroup label="Create new image (select base)">
                <option value="img1">Img1</option>
                <option value="img2">Img2</option>
              </optgroup>
              <optgroup label="Use existing image">
                <option value="img3">Img3</option>
                <option value="img4">Img4</option>
              </optgroup>
            </select>
          </div>
          <div class="span4" id="image_build_name_div">
            <input id="image_build_name" name="image_build_name" class="span12" placeholder="Image name" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
<!--
        <div class="control-group row-fluid" id="image_build_name_div">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">Image Name :</label>
          </div>
          <div class="span6">
            <input id="image_build_name" name="image_build_name" class="span12" placeholder="Course-unique name" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
-->
        <div class="control-group row-fluid" style="display:block">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Base Image :</label>
          </div>
          <div class="span5" id="imageBuildModal_select_baseimage_div">
            <select id="imageBuildModal_select_baseimage" name="imageBuildModal_select_baseimage" style="width:100%">
              <option value="img1" selected="selected">Img1</option>
              <option value="img2">Img2</option>
            </select>
          </div>
        </div>
        
        <div class="control-group row-fluid">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Dockerfile :</label>
          </div>
          <div class="span5">
            <input id="image_build_dockerfile" name="image_build_dockerfile" class="span12" placeholder="Dockerfile" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        
        <div class="control-group row-fluid image-build-access" id="image_build_access_0" data-id="0">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Access :</label>
          </div>
          
          <div class="span1 row-fluid">
            <button class="icon-button" id="image_build_access_plus" style="padding-top:6px">
              <i class="icon-plus-sign icon-large"></i>
            </button>
          </div>
<!--
          <div class="span5 row-fluid">
            <div class="span5">
              <div class="span12">
                <input id="image_build_access_name_0" class="span12" data-id="0" placeholder="name" type="text" maxlength="80" style="margin-bottom:0px">
              </div>
            </div>
            <div class="span4">
              <div class="span12">
                <select id="image_build_access_type_select_0" style="width:100%; margin-bottom:0px" data-id="0">
                  <option selected disabled hidden value="0">Type</option>
                                      <option value="http">http</option>
                                  </select>
              </div>
            </div>
            <div class="span3">
              <div class="span12">
                <input id="image_build_access_port_0" class="span12" placeholder="port" type="text" maxlength="80" data-id="0" style="margin-bottom:0px">
              </div>
            </div>
          </div>
          
          <div class="span1 row-fluid">
            <button class="icon-button" data-id="0" style="padding-top:6px">
              <i class="icon-trash icon-large"></i>
            </button>
          </div>
 -->

        </div>
       
        <!--
        <div class="control-group row-fluid">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">Init File :</label>
          </div>
          <div class="span5">
            <input id="image_build_initfile" name="image_build_initfile" class="span12" placeholder="Script run after container start" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        -->
        <!--
        <div class="control-group row-fluid">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">User Name :</label>
          </div>
          <div class="span5">
            <input disabled id="image_build_user" name="image_build_user" class="span12" value="labsuser" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        -->
        
      </div>

      <div class="modal-footer" id="imageBuildModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="imageBuildModal_output">
          <div id="imageBuildModal_ta" style="overflow:scroll; height:150px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; padding-left: 6px; resize:none; border-bottom:1px solid lightgray;" contenteditable="true">
          </div>
        </div>

        <button id="imageBuildModal_ok" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
        <button id="imageBuildModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Cancel</button>
        <button id="imageBuildModal_build" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Build</button>
        
      </div>

    </div>
  </div>
</div>

<div class="modal hide fade" id="quizModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
	<div id="quizModal_dialog" class="modal-dialog ">
		<div id="quizModal_content" class="modal-content">
			<div id="quizModal_header" class="modal-header">
				<h3>Generate Quiz (BETA)</h3>
			</div>
			<div id="quizModal_body" class="modal-body" style="padding-bottom: 0px; max-height:500px">
				<h6>
					Generating a quiz for this assignment will do the following:
				</h6>
				<ul>
					<li>
						<h6>
							Convert any markdown files in the work area into html and place them under asnlib/public/docs
						</h6>
					</li>
					<li>
						<h6>
							Copy over all non-markdown contents of work/docs to asnlib/public/docs
						</h6>
					</li>
					<li>
						<h6>
							Automatically generate rubrics for each question
						</h6>
					</li>
					<li>
						<h6>
							Flag this assignment for quiz grading. To remove this flag, generate quiz again with no markdown files in the work area.
						</h6>
					</li>
				</ul>
				<h6>
					There can be only one markdown file viewable per part. If multiple 
markdown files in different languages exist please ensure that they have
 the same scores and answers for grading consistency.
				</h6>
				<br>
				<div class="controls">
					<div class="row-fluid">
						<div class="span2">
							<label class="control-label">Show hints:</label>
						</div>
						<input name="show_hints" id="show_hints" class="ace ace-switch ace-switch-6" type="checkbox">
						<span class="lbl"></span>
					</div>
				</div>
				<div class="controls">
					<div class="row-fluid">
						<div class="span2">
							<label class="control-label">Multi-Tab/Exam Format:</label>
						</div>
						<input name="multi_tab" id="multi_tab" class="ace ace-switch ace-switch-6" type="checkbox">
						<span class="lbl"></span>
					</div>
				</div>
			</div>
			<div id="quizModal_footer" class="modal-footer" style="padding: 15px 0 15px 0 !important; background-color:white">
				<button id="quizModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Generate</button>
				<button id="quizModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Cancel</button>
			</div>
		</div>
	</div>
</div>

<div id="modal-table-report-cluster" class="modal hide fade" tabindex="-1" style="left:10%; width:70% !important; height:15% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Cluster Details</span>
    </div>
  </div>

   <div id="report_cluster_div" class="modal-body no-padding">
     <p id="report_cluster_msg_box" style="margin-left: 10px !important; font-family: Courier; margin-top: 5px;"></p>
   </div>
</div>

<div id="modal-table-report-submission" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Submission Report</span>
    </div>
  </div>

   <div id="report_submission_div" class="modal-body no-padding">
     <p id="report_submission_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
   
</div>

<div id="modal-table-report-grading" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">Grading Report</span>
    </div>
  </div>
   
   <div id="report_grading_div" class="modal-body no-padding">
     <p id="report_grading_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>

</div>


<div id="modal-table-report-all-html" class="modal hide fade" tabindex="-1">
  <div class="modal-header no-padding">
    <div class="table-header">

      <button type="button" class="close" data-dismiss="modal"></button>
      <span id="modal-table-report-all-html-title">Grading Report</span>
      <a class="" target="_blank" href="" id="modal-table-report-all-html-link">
					<i style="margin-left:10px" class="icon-external-link icon-only white"></i>
			</a>
    </div>
  </div>

  <div class="modal-body" id="modal-table-report-all-html-body">
      <iframe id="modal-table-report-all-html-iframe" src="main.htm" width="100%" height="100%" frameborder="0"></iframe>
  </div>
</div>


<div id="modal-table-report-run" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">RUN Report</span>
    </div>
  </div>
   
   <div id="report_run_div" class="modal-body no-padding">
     <p id="report_run_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-build" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal"></button>
      <span style="font-size: 15px">BUILD Report</span>
    </div>
  </div>

   <div id="report_build_div" class="modal-body no-padding">
     <p id="report_build_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>

<div id="modal-edit-vers" class="modal hide fade" tabindex="-1" style="height:70% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal" onclick="location.href='main.php?m=editor&amp;mode=s&amp;asnid=890069&amp;stepid=890070&amp;version=0'">
        <h3>Close</h3>
      </button>
      <span style="font-size: 15px">Edit Versions <i id="versspinbox" class="icon-spin icon-spinner" style="display: none;"></i></span>
    </div>
  </div>

   <div id="edit_vers_div" class="modal-body no-padding" style="margin-left: 10px !important; font-family: Courier;">
      <table id="verstable" class="table table-hover table-bordered" style="border-top: 0 !important;">
        <tbody><tr>
          <th>Version</th>
          <th>Name</th>
          <th>Deleted</th>
          <th>Action</th>
        </tr>
             </tbody></table>
     <button type="button" class="btn btn-small btn-info vocbtn vocbtn-info" onclick="newvers();">Add a version</button>
   </div>
</div>

<div id="modal-git-actions" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
        <h3>Close</h3>

      </button>
      <span id="git_actions_lable" style="font-size: 15px">Git action status</span>
    </div>
  </div>

   <div id="git_actions_div" class="modal-body no-padding">
     <p id="git_action_msg_box" style="margin-left: 10px !important;"></p>
   </div>
</div>

<div id="grades-modal" class="modal hide fade" tabindex="-1" style="height:75% !important; overflow: hidden !important;">
    <div class="modal-header no-padding">
        <div class="table-header">
            <button type="button" class="close" data-dismiss="modal"></button>
            &nbsp;
            <span class="modal-title"></span>
        </div>
    </div>

    <div class="modal-body" style="max-height: none; height: 85%;">
        <iframe style="width: 100%; height: 100%; border: none;" src="about: blank"></iframe>
        <div id="spinner" class="center" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; background-color: #fff;">
            <div style="width: 100%; height: 100%; position: relative;">
                <i class="icon-spinner icon-spin light-grey bigger-275" style="position: absolute; width: 42px; height: 42px; left: 0; right: 0; top: 0; bottom: 0; margin: auto;"></i>
            </div>
        </div>
    </div>
</div>

<div class="modal hide fade" id="jupyterModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
  <div id="jupyterModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="jupyterModal_content" class="modal-content">

      <div id="jupyterModal_header" class="modal-header">
        <h3>Jupyter</h3>
        <h6>
          This process will strip out the code marked with 
BEGIN_SOLUTION and BEGIN_HIDDEN_TESTS pragmas and copy the resulting 
notebook to the Starter Code.
        </h6>
        <h6>
          This will, optionally, extract nbgrader-style grading items 
and sync them with the Vocareum environment. New grading items will be 
added and existing ones with new scores will be updated. If no 
submissions have been made, an option to delete unused grading items 
will be available.
        </h6>
        <h6>
          A grading script will also be generated (with any existing 
grading script being overwritten) unless that option is de-selected. 
Additionally, there is an option to create a link to the resource 
directory in the Starter Code so that notebooks can access that area via
 './resource'.
        </h6>
      </div>

      <div id="jupyterModal_body" class="modal-body" style="padding-bottom: 0px;">
        <span id="jupyterModal_files">
          Notebook(s) to be released:

          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_1">
              <td class="jupyter-modal-td-file"><input class="span1 jupyter-modal-td-checkbox" type="checkbox" checked="checked">
                File1.ipynb
              </td>
            </tr>
          </tbody></table>

          <br>
          This process will also generate the grading script
          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_ow">
              <td style="text-align:left; border:0px; padding-bottom:0px"><input class="span1" style="margin-bottom:6px; width:20px" type="checkbox" checked="checked">
                Overwrite grading script if it exists
              </td>
            </tr>
          </tbody></table>

        </span>
      </div>

      <div class="modal-footer" id="jupyterModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="jupyterModal_output">
          <textarea id="jupyterModal_ta" style="height:100px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid lightgray;">          </textarea>
        </div>

        <button id="jupyterModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
        <button id="jupyterModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important" data-dismiss="modal">Cancel</button>
        <button id="jupyterModal_release" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Release</button>
        
      </div>

    </div>
  </div>
</div>

<div class="modal hide fade" id="jupyterClearOutputModal" role="dialog" style="width:65%; min-width:400px; max-height:90%; height:auto;">
  <div id="jupyterClearOutputModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="jupyterClearOutputModal_content" class="modal-content">

      <div id="jupyterClearOutputModal_header" class="modal-header">
        <h3>Jupyter</h3>
        <h6>
          This will clear out all the output arrays in the selected 
notebook(s) and save it in a copy; the original notebook will not be 
modified.
        </h6>
        <h6>
          This is useful when notebook sizes get very large due to debug print statements and they take a long time to load.
        </h6>
      </div>

      <div id="jupyterClearOutputModal_body" class="modal-body" style="padding-bottom: 0px;">
        <span id="jupyterClearOutputModal_files">
          Notebook(s) to be released:

          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_1">
              <td class="jupyter-modal-td-file"><input class="span1 jupyter-modal-td-checkbox" type="checkbox" checked="checked">
                File1.ipynb
              </td>
            </tr>
          </tbody></table>

          <br>
          This process will also generate the grading script
          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_ow">
              <td style="text-align:left; border:0px; padding-bottom:0px"><input class="span1" style="margin-bottom:6px; width:20px" type="checkbox" checked="checked">
                Overwrite grading script if it exists
              </td>
            </tr>
          </tbody></table>

        </span>
      </div>

      <div class="modal-footer" id="jupyterClearOutputModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="jupyterClearOutputModal_output">
          <textarea id="jupyterClearOutputModal_ta" style="height:80px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid lightgray;">          </textarea>
        </div>

        <button id="jupyterClearOutputModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important" data-dismiss="modal">Cancel</button>
        <button id="jupyterClearOutputModal_co" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Clear Output</button>
        <button id="jupyterClearOutputModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
      </div>

    </div>
  </div>
</div>


<div class="modal hide fade" id="clabsStateModal" role="dialog" style="max-height:50%; height:auto; width:50%; min-width:300px">
  <div id="clabsStateModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="clabsStateModal_content" class="modal-content">

      <div id="clabsStateModal_header" class="modal-header" style="padding-bottom:10px; border-bottom-color:#3e3e3e">
        <h3>Lab status</h3>
      </div>

      <div id="clabsStateModal_body" class="modal-body" style="padding-bottom: 15px; border-bottom:1px solid; border-bottom-color:#3e3e3e">
        <span id="clabsStateModal_vms">
          <table class="table table-first-column-check table-hover" style="margin-bottom:0px" frame="void" rules="rows" border="1">
            <tbody><tr id="vm_1" class="clabs-state-modal-tr-vm">
              <td class="clabs-state-modal-td-vm span6">
                Linux-1
              </td>
              <td class="clabs-state-modal-td-state span6">
                shutting down <i id="vm_1_spinbox" class="icon-spin icon-spinner"></i>
              </td>
            </tr>
            <tr id="vm_2" class="clabs-state-modal-tr-vm">
              <td class="clabs-state-modal-td-vm span6">
                Linux-2
              </td>
              <td class="clabs-state-modal-td-state span6">
                shutting down <i id="vm_2_spinbox" class="icon-spin icon-spinner"></i>
              </td>
            </tr>
          </tbody></table>
          <br>

        </span>
      </div>

      <div class="modal-footer" id="clabsStateModal_footer" style="padding: 15px 0 15px 0 !important; background-color:white;"> <!--  border-top-color:#3e3e3e"> -->

        <div id="clabsStateModal_msg">
          <textarea id="clabsStateModal_ta" style="height:50px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid; border-bottom-color:#3e3e3e;">          </textarea>
        </div>

        <button id="clabsStateModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Ok</button>
      </div>

    </div>
  </div>
</div>

<!-- end of modals -->



<script>

var left_panel_instructions = 1;
$('#detailspinbox').hide();
$('#versspinbox').hide();

$('#showfullscreen').on('click', function()
	    {
	              var fullbox = document.getElementById("editordiv");

	              if (!document.mozFullScreen && !document.webkitFullScreen) {
	              if (fullbox.mozRequestFullScreen) {
	                  fullbox.mozRequestFullScreen();
	              } else {
	                  fullbox.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
	              }
	            } else {
	              if (document.mozCancelFullScreen) {
	                document.mozCancelFullScreen();
	              } else {
	                document.webkitCancelFullScreen();
	              }
	            }
	    });



	var gloss_theme = 0;
	var editor_content_change = 0;
	var viewer_last_fname = null;
	var viewer_last_fpath = null;
	var viewer_first_fpath = "/";


    var doc_panel_width = 0;
    function isTextFile(ext) {
    	// // EDIT_EXT
    	var js_ext_array = ["java","xml","txt","text","py","c","C","cpp","cc","h","php","js","json","sql","html","vhd","vhdl","properties","mak","hpp","htm","html","sh","pl","pm","ml","R","csv","s","asm","m","pml","config","css","rb"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false;
			return true;
    }
    function isVidFile(ext) {
    	var js_ext_array = ["mp4"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false;
			return true;
    }
    function isImgFile(ext) {
    	var js_ext_array = ["jpg","jpeg","bmp","gif","png"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false;
			return true;
    }
    function isOtherFile(ext) {
    	var js_ext_array = ["pdf"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false;
			return true;
    }
    function isBrowserViewableFile(ext) {
    	var js_ext_array = ["html","htm","md","markdown","mdown"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false;
			return true;
    }

    function canOpenFile(filename) {
			var ext_index = filename.lastIndexOf('.');
			if (ext_index == -1) {
				ext = null;
			} else {
            	ext = filename.substring(ext_index + 1);
			}

			if ((ext == null) || isTextFile(ext)) {
				return true;
			} else {
				return false;
			}
    }

	function findMode(filename) {
		ext = filename.split('.').pop().toLowerCase();
		switch (ext) {
			case "java":
				mode = "text/x-java";
				break;
			case "xml":
				mode = { name: "text/html", alignCDATA: true };
				break;
			case "py":
				mode = "text/x-python";
				break;
			case "php":
				mode = "application/x-httpd-php";
				break;
			case "c":
			case "h":
				mode = "text/x-csrc";
				break;
			case "hpp":
			case "cpp":
			case "c++":
				mode = "text/x-c++src";
				break;
			case "md":
				mode = "gfm";
				break;
			case "js":
				mode = { name: "text/javascript", globalVars: true };
				break;
			case "css":
				mode = "text/css";
				break;
			case "sql":
				mode = "text/x-sql";
				break;
			default:
				mode = { name: "text/html", alignCDATA: true };
				break;
		}
		return mode;
	}
	function findReadOnlyDelimiter(filename) {
		var delim = filename.split('.').pop().toLowerCase();
		switch (ext) {
			case "java":
				delim = "//";
				break;
			case "py":
				delim = "#";
				break;
			case "php":
			case "c":
			case "cpp":
			case "c++":
			default:
				delim = "//";
				break;
		}
		return delim;
	}
	var vocIndentSize = 4;
	
  function vocBetterTab(cm) {
    if (cm.somethingSelected()) {
      cm.indentSelection("add");
    } else {
      cm.replaceSelection(cm.getOption("indentWithTabs")? "\t":
        Array(cm.getOption("indentUnit") + 1).join(" "), "end", "+input");
    }
  }

  function vocDefaultTab(cm) {
    if (cm.somethingSelected()) {
      cm.indentSelection("add");
    }
    else {
      cm.execCommand("insertTab");
    }
  }

  var editor = CodeMirror.fromTextArea(document.getElementById("codearea0"), {
        lineNumbers: true,
        styleActiveLine: true,
    matchBrackets: true,
    autoCloseBrackets: false,
        autoCloseTags: true,
        lineWrapping: true,
    indentUnit: vocIndentSize,
    smartIndent: true,
    mode: {name: "xml", alignCDATA: true},
	theme: "neat",
          extraKeys: { Tab: vocBetterTab },
      });

  cm_mode = findMode("");
  editor.setOption("mode", cm_mode);
  editor.setOption("readOnly", true);

  editor.clearHistory();

  var map = {
    "Cmd-E": function(cm){
      console.log("Command E");
      var terminalFrame = document.getElementById('terminalIframe');
      if (document.getElementById('consolediv') && ($('#consolediv').height() != 0) && terminalFrame) {
          //terminalFrame.focus();
          terminalFrame.contentWindow.vocLaunchTerminalButton().focus();
      } else if (document.getElementById('navbar-logo')) {
          document.getElementById('navbar-logo').focus();
      } else {
          // set focus to any other element if navbar is not present
          document.getElementById('breadcrumb-type-link').focus();
      }
    },
    "Ctrl-Space": "autocomplete"
  }
  editor.addKeyMap(map);
  
  	var lastEditTime = 0;
	numEdits = 1;
	function handleEditorChange(doc, param) {
		lastEditTime = new Date().getTime();
		if (numEdits) {
                   if( save_in_progress ){
                     $('#editor-save-status-btn').hide();
                     $("#editor-save-status").show();
                     $("#editor-save-status").html("Saving...pending");
                   } else {
                     $('#editor-save-status-btn').show();
                     $('#editor-save-status-btn').html("Save pending");
                     $("#editor-save-status").hide();
                   }
		}
		numEdits++;
	}
 	 
 	 editor.on("change", handleEditorChange);
 	 function vocIsFileReadOnly(fpath) {
 	 	return false;
	  }

		function handleUnfocusEvent(cm) {
		if (isSaveNeeded()) {
			voc_save(true, "Saving");
		}
	}
	editor.on("blur", handleUnfocusEvent);
	
  $('.vocdivider').draggable({
    axis: 'x',
    containment: 'parent',
    helper: 'clone',
    drag: function (event, ui) {
        var width = ui.offset.left;
        var width_of_right_panel = $("#idebox").width() - width;
        if (width_of_right_panel < 200) {
          return;
        }
        //if (width > 500) return; // at most
        if (left_panel_instructions) {
          if ($('#showdocviewicon').hasClass("icon-check-empty")) {
            $('#filelisting').width(width);
          } else {
            $('#instructions').width(width);
            doc_panel_width = width;
          }
        } else {
          $(this).prev().width(width);
        }
                  // Temporarily disable mouse events for terminal
          $('#terminalIframe').css('pointer-events', 'none');
                          $('#readMeIframe').css('pointer-events', 'none');
            },
    start: function() {
              // Temporarily disable mouse events for terminal
        $('#terminalIframe').css('pointer-events', 'none');
                    $('#readMeIframe').css('pointer-events', 'none');
          },
    stop: function() {
            // Re-enable mouse events for terminal
      $('#terminalIframe').css('pointer-events', 'auto');
                    $('#readMeIframe').css('pointer-events', 'auto');
          }
  });

  $('.vocdivider_v2').draggable({
    axis: 'x',
    containment: 'parent',
    helper: 'clone',
    iframeFix: true,
    scroll: false,
    drag: function (event, ui) {
        var width = ui.offset.left;

        // min/max of movement is controlled by the min/max where buildframe is defined
        // var width_of_right_panel = $("#buildframe").width();
        // if (width_of_right_panel < 50) {
        //   return;
        // }
        // if (width_of_right_panel > 400) {
        //   return;
        // }

        //mhui
        var idebox_width = $('#idebox').width();
        var element =  document.getElementById('gradeframe');
        if (typeof(element) != 'undefined' && element != null && element.style.display == 'block')
        {
            $('#buildframe').width(idebox_width - width - $('#gradeframe').width() - 10);
        }
        else
        {
            $(this).prev().width(idebox_width - width);
        }
    },
  });



// var for copypaste feature
var copyPasteClipboard = false;
function saveCBClipboard(path, paths=[])
{
    $.ajax({
      url: "../util/vcput.php",
      type: "post",
      data: {
        a: "saveClipboard",
        userid:1975667,
        asnid:890070,
        mode:'s',
        version:'0',
        path:path,
        paths: JSON.stringify(paths)
      },
      success: function(data) {
        var ap = data.search(/voc::/);
        var bp = data.search(/::voc/);
        if(ap>=0 && bp>=0 && bp>ap){
          show_voc_gritter(false, data.substring(ap+5, bp-ap-5), false);
        } else {
          show_voc_gritter(false, "Copied", false);
          copyPasteClipboard = true;
        }
        return false;
      }
    });
}
var pasteprogress=0;
function pasteCB(type, path, source, msg, confirm) {
      /* default value to be used for confirm - better to do it this way
       * than doing it in the funtion signature otherwise some browser
       * versions e.g. IE, Edge has problem showing IDE page
       */
      if(confirm === undefined) {
        confirm = false;
      }
      if( pasteprogress>0 ){
        alert('Paste-workarea is in progress, please wait until the prior operation finishes.');
        return false;
      }
      pasteprogress++;
      var stepstr = "&stepid=890070";
      var url = "../util/vcsave.php?asnid=890069"+stepstr+"&mode=s&version=0&type="+type+(confirm? '&confirm=1' : '') + "&vm=34.209.4.84&labtype=1";
      $.ajax({
        type: 'POST',
        url: url,
        async: false,
        data: {filepath: "./"+path , sourcepath: "./"+source}
        })
          .done(function(ret_val) {
                  if(pasteprogress) --pasteprogress;
                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                      refreshNewSessionPage();
                  }
                  if (ret_val.indexOf('<ERROR:') !== -1) { // error
                    show_voc_gritter(false, ret_val.substring(7), true);
                  } else {
                    show_voc_gritter(false, msg, false);
                    refreshFileTree(true, true);
                  }

          })
             .fail(function(ret_val) {
                  if(pasteprogress) --pasteprogress;
                  show_voc_gritter(false, "Paste-workarea failed. Please check your internet connection", true);
          });
          return true;
}

</script>


		<!-- ace scripts -->
		<!-- page specific plugin scripts -->
		<!-- <script src="../shared/ace/assets/js/fuelux/data/fuelux.tree-sampledata.js"></script> -->
		<script src="main_data/fuelux_002.js"></script>
		
		<script type="text/javascript">
		  var DataSourceTree = function(options) {
        this._data 	= options.data;
        this.url = options.url;
      }
      
      DataSourceTree.prototype.data = function(options, callback) {
        if (this.url) {
          $.ajax({
            url: this.url,
            data: {
              t: 'getFileTreeV2',
              mode: 's',
              ownerid: 1975667,
              tide: 0,
              asnid: 890069,
              asnstep: 890070,
              currversion: '0',
              globalunfoldpath: './LatestSubmission',
              path: options.path ? options.path : ''
            },
            success: function(tree_data) {
              console.log('Dynamic Tree Load');
              console.log(tree_data);
              callback({data: JSON.parse(tree_data)});
            },
            error: function() {
              console.log('failed to load tree');
              callback({data: {}});
            }
          });
        } else { // use frontend implementation to build tree
          // copied from fuelux.tree-sampledata
          var self = this;
          var $data = null;

          if(!("name" in options) && !("type" in options)){
            $data = this._data;//the root tree
            callback({ data: $data });
            return;
          }
          else if("type" in options && options.type == "folder") {
            if("additionalParameters" in options && "children" in options.additionalParameters)
              $data = options.additionalParameters.children;
            else $data = {}//no data
          }

          if($data != null)//this setTimeout is only for mimicking some random delay
            setTimeout(function(){callback({ data: $data });} , parseInt(Math.random() * 0));
        }
      };
            			var treeDataSource;
			            var tree_data;
      console.log('latest: no'); 

 tree_data = { 
  'resource' : {name:'resource',  base:'1',  type:'folder', nc:'',  extraHtml:'<i class=\"icon-lock bigger-140\" style=\"padding-left:4px\"></i>',  unfold:'1',  ed:'0', ec:'0', path:'./resource',} , 
 'work' : {name:'work',  base:'1',  type:'folder', nc:'',  extraHtml:'<span id="workunsubmitted" class="label label-important" style="margin-left:6px;padding:3px 8px 1px;display:none">Submit needed</span>',  unfold:'0',  ed:'0', ec:'1', path:'./work',} , 
 } 

 tree_data['resource']['additionalParameters'] = { 
 'children' : { 
 'lib' : {name:'lib',  type:'folder', nc:'0',  extraHtml:'<a class="badge badge-info pointer pull-right voc-tree-help tree-btn" tabindex="0" role="button" style="margin-right: 20px;" data-target="#LIB-help-modal" data-toggle="modal">?</a>',  unfold:'0',  ed:'0', ec:'0', path:'./resource/lib',} , 
 'asnlib' : {name:'asnlib',  type:'folder', nc:'0',  extraHtml:'<a class="badge badge-info pointer pull-right voc-tree-help tree-btn" tabindex="0" role="button" style="margin-right: 20px;" data-target="#ASNLIB-help-modal" data-toggle="modal">?</a>',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib',} , 
 'scripts' : {name:'scripts',  type:'folder', nc:'0',  extraHtml:'<a class="badge badge-info pointer pull-right voc-tree-help tree-btn" tabindex="0" role="button" style="margin-right: 20px;" data-target="#Scripts-help-modal" data-toggle="modal">?</a>',  unfold:'0',  ed:'0', ec:'0', path:'./resource/scripts',} , 
 'startercode' : {name:'startercode',  type:'folder', nc:'0', unfold:'0', ed:'0', ec:'0', path:'./resource/startercode',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters'] = { 
 'children' : { 
 'publicdata' : {name:'publicdata',  type:'folder', nc:'0', unfold:'0', ed:'0', ec:'0', path:'./resource/asnlib/publicdata',} , 
 'public' : {name:'public',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters'] = { 
 'children' : { 
 'docs' : {name:'docs',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters'] = { 
 'children' : { 
 'lang' : {name:'lang',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters'] = { 
 'children' : { 
 'en-us' : {name:'en-us',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/en-us',} , 
 'en-us-cli' : {name:'en-us-cli',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/en-us-cli',} , 
 'es-es' : {name:'es-es',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/es-es',} , 
 'id-id' : {name:'id-id',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/id-id',} , 
 'ja-jp' : {name:'ja-jp',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/ja-jp',} , 
 'ko-kr' : {name:'ko-kr',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/ko-kr',} , 
 'pt-br' : {name:'pt-br',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/pt-br',} , 
 'zh-cn' : {name:'zh-cn',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/zh-cn',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['en-us']['additionalParameters'] = { 
 'children' : { 
 '.DS_Store' : {name:'.DS_Store',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us/.DS_Store',} , 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/en-us/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['en-us-cli']['additionalParameters'] = { 
 'children' : { 
 '.DS_Store' : {name:'.DS_Store',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us-cli/.DS_Store',} , 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us-cli/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us-cli/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/en-us-cli/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['en-us-cli']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us-cli/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['en-us']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/en-us/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['es-es']['additionalParameters'] = { 
 'children' : { 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/es-es/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/es-es/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/es-es/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['es-es']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/es-es/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/es-es/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['id-id']['additionalParameters'] = { 
 'children' : { 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/id-id/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/id-id/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/id-id/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['id-id']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/id-id/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/id-id/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['ja-jp']['additionalParameters'] = { 
 'children' : { 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ja-jp/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ja-jp/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/ja-jp/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['ja-jp']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ja-jp/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ja-jp/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['ko-kr']['additionalParameters'] = { 
 'children' : { 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ko-kr/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ko-kr/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/ko-kr/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['ko-kr']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ko-kr/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ko-kr/images/lab-scenario.jpeg',} , 
 'lab-scenario.jpg' : {name:'lab-scenario.jpg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/ko-kr/images/lab-scenario.jpg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['pt-br']['additionalParameters'] = { 
 'children' : { 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/pt-br/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/pt-br/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/pt-br/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['pt-br']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/pt-br/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/pt-br/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['zh-cn']['additionalParameters'] = { 
 'children' : { 
 'README.html' : {name:'README.html',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/zh-cn/README.html',} , 
 'README.md' : {name:'README.md',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/zh-cn/README.md',} , 
 'images' : {name:'images',  type:'folder', nc:'0',  extraHtml:'',  unfold:'0',  ed:'0', ec:'0', path:'./resource/asnlib/public/docs/lang/zh-cn/images',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['asnlib']['additionalParameters']['children']['public']['additionalParameters']['children']['docs']['additionalParameters']['children']['lang']['additionalParameters']['children']['zh-cn']['additionalParameters']['children']['images']['additionalParameters'] = { 
 'children' : { 
 'lab-6-table.png' : {name:'lab-6-table.png',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/zh-cn/images/lab-6-table.png',} , 
 'lab-scenario.jpeg' : {name:'lab-scenario.jpeg',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/asnlib/public/docs/lang/zh-cn/images/lab-scenario.jpeg',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['lib']['additionalParameters'] = { 
 'children' : { 
 'publicdata' : {name:'publicdata',  type:'folder', nc:'0', unfold:'0', ed:'0', ec:'0', path:'./resource/lib/publicdata',} , 
 'public' : {name:'public',  type:'folder', nc:'0', unfold:'0', ed:'0', ec:'0', path:'./resource/lib/public',} , 
 } 
 } 

 tree_data['resource']['additionalParameters']['children']['scripts']['additionalParameters'] = { 
 'children' : { 
 'build.sh' : {name:'build.sh',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/scripts/build.sh',} , 
 'run.sh' : {name:'run.sh',  extraHtml:'',   type:'item', nc:'0', ed:'0', ee:'0', path:'./resource/scripts/run.sh',} , 
 } 
 } 

 tree_data['work']['additionalParameters'] = { 
 'children' : { 
 } 
 } 


tree_data_files = ' ./resource ./work ./resource/lib ./resource/asnlib ./resource/scripts ./resource/startercode ./resource/asnlib/publicdata ./resource/asnlib/public ./resource/asnlib/public/docs ./resource/asnlib/public/docs/lang ./resource/asnlib/public/docs/lang/en-us ./resource/asnlib/public/docs/lang/en-us-cli ./resource/asnlib/public/docs/lang/es-es ./resource/asnlib/public/docs/lang/id-id ./resource/asnlib/public/docs/lang/ja-jp ./resource/asnlib/public/docs/lang/ko-kr ./resource/asnlib/public/docs/lang/pt-br ./resource/asnlib/public/docs/lang/zh-cn ./resource/asnlib/public/docs/lang/en-us/.DS_Store ./resource/asnlib/public/docs/lang/en-us/README.html ./resource/asnlib/public/docs/lang/en-us/README.md ./resource/asnlib/public/docs/lang/en-us/images ./resource/asnlib/public/docs/lang/en-us-cli/.DS_Store ./resource/asnlib/public/docs/lang/en-us-cli/README.html ./resource/asnlib/public/docs/lang/en-us-cli/README.md ./resource/asnlib/public/docs/lang/en-us-cli/images ./resource/asnlib/public/docs/lang/en-us-cli/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/en-us/images/lab-6-table.png ./resource/asnlib/public/docs/lang/en-us/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/es-es/README.html ./resource/asnlib/public/docs/lang/es-es/README.md ./resource/asnlib/public/docs/lang/es-es/images ./resource/asnlib/public/docs/lang/es-es/images/lab-6-table.png ./resource/asnlib/public/docs/lang/es-es/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/id-id/README.html ./resource/asnlib/public/docs/lang/id-id/README.md ./resource/asnlib/public/docs/lang/id-id/images ./resource/asnlib/public/docs/lang/id-id/images/lab-6-table.png ./resource/asnlib/public/docs/lang/id-id/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/ja-jp/README.html ./resource/asnlib/public/docs/lang/ja-jp/README.md ./resource/asnlib/public/docs/lang/ja-jp/images ./resource/asnlib/public/docs/lang/ja-jp/images/lab-6-table.png ./resource/asnlib/public/docs/lang/ja-jp/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/ko-kr/README.html ./resource/asnlib/public/docs/lang/ko-kr/README.md ./resource/asnlib/public/docs/lang/ko-kr/images ./resource/asnlib/public/docs/lang/ko-kr/images/lab-6-table.png ./resource/asnlib/public/docs/lang/ko-kr/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/ko-kr/images/lab-scenario.jpg ./resource/asnlib/public/docs/lang/pt-br/README.html ./resource/asnlib/public/docs/lang/pt-br/README.md ./resource/asnlib/public/docs/lang/pt-br/images ./resource/asnlib/public/docs/lang/pt-br/images/lab-6-table.png ./resource/asnlib/public/docs/lang/pt-br/images/lab-scenario.jpeg ./resource/asnlib/public/docs/lang/zh-cn/README.html ./resource/asnlib/public/docs/lang/zh-cn/README.md ./resource/asnlib/public/docs/lang/zh-cn/images ./resource/asnlib/public/docs/lang/zh-cn/images/lab-6-table.png ./resource/asnlib/public/docs/lang/zh-cn/images/lab-scenario.jpeg ./resource/lib/publicdata ./resource/lib/public ./resource/scripts/build.sh ./resource/scripts/run.sh ./work/.gitconfig'
            treeDataSource = new DataSourceTree({data: tree_data});
      
var codeCommentWidgets = [];
	function removeLineWidgets() {
                if (codeCommentWidgets.length) {
                    for (var i = 0; i < codeCommentWidgets.length; i++) {
                        codeCommentWidgets[i].clear();
                    }

                    codeCommentWidgets = [];
            	}
        }
function showCodeComment(ids) {
        var id, codeComment, node;

	removeLineWidgets();
        if (ids == '') {
            return;
        }
        var ids = ids.split(',');

        

    for (var i = 0; i < ids.length; i++) {

        id = ids[i];

        codeComment = getCodeComment(id);
        
        if (codeComment.selectedPeer == 1) {
            commenterName = "Peer reviewer";
        } else {
                            commenterName = codeComment.name;
                    }

        node = $('\
            <div class="vocborder-1" style="position: relative; padding: 4px 30px 4px 6px; background: #f7f7f7; border-color: #ddd !important; border-left: none !important; margin: 4px 0 !important; z-index: 4;">\
                <strong style="color: #3b7fd4;">' + commenterName + ', ' + codeComment.time + ' ago</strong>\
                ' + (codeComment.selectedComment.length ? ('<pre style="padding-top: 4px;">' + codeComment.selectedComment + '</pre>') : '')  + '\
            </div>'
        )[0];

        codeCommentWidgets.push(editor.addLineWidget(codeComment.selectedLine, node, {above: false, coverGutter: false, noHScroll: true}));
    }
}


                var readonlyWidgets = [];
                
                function clearReadOnlyWidgets() {
                    if (readonlyWidgets.length) {
                        for (var i = 0; i < readonlyWidgets.length; i++) {
                            readonlyWidgets[i].clear();
                        }

                        readonlyWidgets = [];
                    }

                }
                function addReadOnlyWidget(widget) {
                    readonlyWidgets.push(widget);
                }
				
			function voc_process_readonly(cm, delim, begins, ends) {
			    var expectingBegin = true;
			    for (i=0; i< cm.doc.lineCount(); i++) {
			    
			    var test = delim+"READONLY_BEGIN";
			    
			        var val = cm.getLine(i);
			        val = val.replace(/ /g,'');
			        if (val == delim+"READONLY_BEGIN") {
			            if (!expectingBegin) return false;
			            begins.push(i);
			            expectingBegin = false;
			        } else if (val == delim+"READONLY_END") {
			        	if (expectingBegin) return false;
			        	ends.push(i);
			        	expectingBegin = true;
			        } else {
			        }
			    }
			    if (begins.length && (begins.length == ends.length)) {
			        return true;
			    } else {
			        return false;
			    }
			}
			var largefileurl = null;

                        function voc_get_viewer_code(fpath, fname, lineNum, codeComments){
                $("#editor_current_file").html('<i class="icon-spin icon-spinner"></i>Reading ... ' + (fpath.substring(2)));

        var stepstr = "&stepid=890070";
        
				var url = "../util/vcprojapi.php?t=filefetch&mode=s&getcode=1&data="+encodeURIComponent(fpath)+"&getlarge=0&asnid=890069&version=0"+stepstr + "&vm=34.209.4.84&labtype=1";
				var data = fpath;

				$.post(url,{},function(ret_val)
				{
					if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
						refreshNewSessionPage();
					}
					
				  if (ret_val.indexOf('VOCAREUM-ERROR') !== -1) { // due to Db traffic or something
                                      show_voc_gritter(false, "Error retrieving file, please try again", true);
                                      return;
                                  }
				  if (ret_val.indexOf('<ERROR:FILE_TOO_BIG>') !== -1) { // too large to show in editor
				      largefileurl = url + "&dl=1";
				      $('#largefile-download').attr('href',largefileurl);
				      $('#largefile-viewer-modal').modal('show');
				      return;
				  }
				

					$('#codebtn').tab('show');

					numEdits = 0; // reset num of edits for this file

					cm_mode = findMode(fpath);
					editor.setOption("mode", cm_mode);
                                        $("#editor-save-status").show();
                                        $('#editor-save-status-btn').hide();
                                        if(ret_val.length>8388608/*8MB*/ || (fpath && fpath.search(/^\.\/(LIB|ASNLIB|resource\/lib|resource\/asnlib)\/publicdata\//)>=0) ){
                                          editor.setOption("readOnly", true);
                                          if(ret_val.length>8388608){
                                            $("#editor-save-status").html("Read only[<font color='red'>8MB+</font>]");
                                          } else {
                                            $("#editor-save-status").html("Read only");
                                          }
                                        } else {
                                          $("#editor-save-status").html("");
                                        }
					editor.setValue(ret_val);
					editor.clearHistory();

					editor_content_change = editor.doc.changeGeneration();
					
						        // check ext. check if copy of default
					var ro_begins = [];
					var ro_ends = [];
					var delim = findReadOnlyDelimiter(fpath);

                    var readonly_lines = voc_process_readonly(editor, delim, ro_begins, ro_ends);
                    
                    clearReadOnlyWidgets(); // clear last

                    if (readonly_lines && (ro_begins.length > 0)) {
                    
                        for (i = 0; i < ro_begins.length; i++) {
                              var msg1 = document.createElement("div");
                              // msg1.appendChild(document.createTextNode("Start readonly code"));
                              msg1.className = "voc-readonly-top";
                              
                              var label = document.createElement("span");
                              label.className = "label label-warning";
                              label.appendChild(document.createTextNode("READ ONLY"));
                              msg1.appendChild(label);
                              
                              var msg2 = document.createElement("div");
                              // msg2.appendChild(document.createTextNode("End of readonly code"));
                              msg2.className = "voc-readonly-bottom";
                              
                              ro_widget1 = editor.addLineWidget(ro_begins[i], msg1, {above:true, coverGutter: false, noHScroll: true});
                              ro_widget2 = editor.addLineWidget(ro_ends[i], msg2, {coverGutter: false, noHScroll: true});

                              addReadOnlyWidget(ro_widget1);
                              addReadOnlyWidget(ro_widget2);

                              editor.markText(
                                {line: ro_begins[i],ch:0}, {line: ro_ends[i] + 1, ch:0},
                                    {
                                        readOnly:true,
                                        atomic: true,
                                        className:"vocbghighlight",
                                        title:"READONLY"
                                    }
                              );
                              
                        }
                    }
            
					viewer_last_fname = fname;
					viewer_last_fpath = fpath;
					$("#editor_current_file").html((fpath.substring(2)));
                                      					if (lineNum > 0) {
						if (lineNum > 0) lineNum = lineNum - 1;
						editor.setCursor(lineNum);
					}


          showCodeComment(codeComments);
				});
			  return false;
			}
			

            function subTreeInit() {
    			var s3_data;
    			$.ajax({
    		        url: "submissiontree.php",
    		        method: "GET",
    		        dataType: "JSON",
    		        async: false,
    		        data: {
    		            courseid: "54610",
    		            asnid: "890070",
    		            userid: "1975667",
    			        published: "1",
        			    ide: 1
    		        },
    		        success: function(data) {
    		    		s3_data = data;
    		        }
    		    });
    			subDataSource = new DataSourceTree({data: s3_data});
    			
              			$('#trees3').ace_tree({
    				dataSource: subDataSource,
    				multiSelect: false,
    				loadingHTML:'<div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div>',
    				'open-icon' : 'icon-minus',
    				'close-icon' : 'icon-plus',
    				'selectable' : true,
    				'selected-icon' : 'icon-caret-right',
    				'unselected-icon' : 'icon-caret-right',
    				cacheItems: true
    			});
              		}

    		function refreshSubTree() {
    			$('#trees3').remove();
    			$("<div id='trees3' class='tree' style='background:white;'></div>").insertAfter('#tree1');
    			subTreeInit();
    		}
    		
            function voc_get_s3_code(fpath, fname, lineNum, codeComments) {
                $("#editor_current_file").html('<i class="icon-spin icon-spinner"></i>Reading ... ' + (fpath));

    	        var stepstr = "&stepid=890070";
    			var url = "../util/vcprojapi.php?t=filefetch&mode=s&getcode=1&data="+encodeURIComponent(fpath)+"&getlarge=0&userid=1975667&asnid=890069&version=0"+stepstr;
    			var data = fpath;

    			$.post(url,{},function(ret_val) {
    				if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
    					refreshNewSessionPage();
    				}
				if (ret_val.indexOf('VOCAREUM-ERROR') !== -1) { // due to Db traffic or something
                                    show_voc_gritter(false, "Error retrieving file, please try again", true);
                                    return;
                                }
    			  	if (ret_val.indexOf('<ERROR:FILE_TOO_BIG>') !== -1) { // too large to show in editor
    		    		largefileurl = url + "&dl=1";
    					$('#largefile-download').attr('href',largefileurl);
    					$('#largefile-viewer-modal').modal('show');
    					return;
    				}
    			
    				$('#codebtn').tab('show');

    				numEdits = 0; // reset num of edits for this file

    				cm_mode = findMode(fpath);
    				editor.setOption("mode", cm_mode);
                    $("#editor-save-status").show();
                    $('#editor-save-status-btn').hide();
                    editor.setOption("readOnly", true);
                    
                    if(ret_val.length>8388608/*8MB*/ || (fpath && fpath.search(/^\.\/(LIB|ASNLIB|resource\/lib|resource\/asnlib)\/publicdata\//)>=0) ){
                        if(ret_val.length>8388608) {
                            $("#editor-save-status").html("Read only[<font color='red'>8MB+</font>]");
                        } else {
                            $("#editor-save-status").html("Read only");
    					}
    				} else {
    					$("#editor-save-status").html("");
    				}
    				
    				editor.setValue(ret_val);
    				editor.clearHistory();
    				editor_content_change = editor.doc.changeGeneration();
    				$("#editor_current_file").html((fpath));
    				
    				if (lineNum > 0) {
    					if (lineNum > 0) lineNum = lineNum - 1;
    					editor.setCursor(lineNum);
    				}

    				showCodeComment(codeComments);
    			});
    		  return false;
    		}

      
	    var $foldersToUnfold = [];
	    

      var unfoldLoopCount = 0;
      function unfoldTree() {
                    
          if ($foldersToUnfold.length <= 0) return;
          if (unfoldLoopCount++ > 20) {
              $foldersToUnfold = [];
              return;
          }

          $('.tree-folder-header').each(function() {
              $val = $(this).data();
              // console.log("element is "+$val['path']);
              if ('path' in $val) {
                  $val['path'] = $val['path'].trim();
                  var tmpIndex = $foldersToUnfold.indexOf($val['path']);
                  if (tmpIndex != -1) {
                    $('#tree1').tree('openFolder', $(this));
                    $foldersToUnfold.splice(tmpIndex, 1);
                  }
              }
          });
          window.setTimeout('unfoldTree()', 100);
      
      }
	    var tree1_files = "";

        function refreshFileTree(workchanged, retainwork) {
          console.log('inside refreshFileTree()');
                      console.log('refresh file tree');
            $('.tree-folder-header').each(function() {
                    $val = $(this).data();
                    if (1 || ('base' in $val)) {
			                  if ($(this).children(".icon-minus").length) {
			                      if (($val.path == "./work") && (!retainwork)) {
			                      } else {
                                $foldersToUnfold.push($val.path);
                            }
                        }
                    }
            });
            var stepstr = "&stepid=890070";

            $.ajax({
            url: "../util/vcprojapi.php?t=getFileTree&asnid=890069"+stepstr+"&mode=s&name=tree1&version=0" + "&labtype=1&vm=34.209.4.84",
            context: document.body
            }).done(function(ret_val) {

                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                      refreshNewSessionPage();
                  }

                  var errPrefix = '<ERROR:';
                  if (ret_val.indexOf(errPrefix) !== -1) { // failure
                    errStr = ret_val.substring(errPrefix.length);
                    show_voc_gritter(false, "Error retrieving file tree: " + errStr, true);
                    $('.tree-folder-header').each(function() {
                      $val = $(this).data();
                      if ('base' in $val) {
                        $par = $(this).parent();
                        $par.detach();
                      }
                    });
                    return;
                  }

                  eval(ret_val);
                  
                  if (tree_data_files === tree1_files) {
                       console.log("Same tree");
                       $foldersToUnfold = [];
                  } else {
                      console.log("Not same tree");

                      var treeDataSource2 = new DataSourceTree({data: tree1});

                      $('.tree-folder-header').each(function() {
                        $val = $(this).data();
                        if ('base' in $val) {
                          $par = $(this).parent();
                          $par.detach();
                        }
                      });

                      $('#tree1').setDataSource(treeDataSource2);
                      tree_data_files = tree1_files;
                      unfoldLoopCount = 0;
                      //let chromeAgent = navigator.appVersion.indexOf("Chrome") > -1;
                      //if (!chromeAgent) { window.setTimeout('unfoldTree()', 100); }
                      window.setTimeout('unfoldTree()', 100);
                   }
 
                      
                   reportsToOpen = true; // if the refresh happens - click the reports again
            });
            
                    }
 
        function markUpdateChanged(path)
        {
          if( path.search(/^work/)<0 &&
              path.search(/^\.\/work/)<0 ) {
            $('#updatebtntext').html('Update*');
          }
        }
     
        $('#cmdprogressbtn').hide();
        var cmdprogress = 0;
        function voc_create_confirm(type, path, source, msg, qstr)
        {
          bootbox.dialog(qstr, [{
                                 "label" : "Yes",
                                 "class" : "btn vocbtn-ac vocbtn-action",
                                 "callback": function() {
                                      voc_create(type, path, source, msg, true);
                                    }
                                }, {
                                 "label" : "Cancel",
                                 "class" : "btn vocbtn-ac vocbtn-status"
                                }]
                        );
          return false;
        }
        function voc_create(type, path, source, msg, confirm) {
                /* default value to be used for confirm - better to do it this way
                 * than doing it in the funtion signature otherwise some browser
                 * versions e.g. IE, Edge has problem showing IDE page
                 */
                if(confirm === undefined) {
                  confirm = false;
                }
                cmdprogress++;
                var stepstr = "&stepid=890070";
                var url = "../util/vcsave.php?asnid=890069"+stepstr+"&mode=s&version=0&type="+type+(confirm? '&confirm=1' : '') + "&vm=34.209.4.84&labtype=1";
                markUpdateChanged(path);
                $('#cmdprogressbtn').show();
                var paths = $('#tree1').tree('selectedItems').map(function (el) {
          	      var path = el.path.substring(2);
          	      if (el.type == 'folder') {
          	        path += '/';
          	      }
          	      return path;
          	    });
                $.ajax({
                  type: 'POST',
                  url: url,
                  async: false,
                  data: {
                    filepath: "./"+path,
                    sourcepath: "./"+source,
                    files: JSON.stringify(paths)
                  }
                })
                    .done(function(ret_val) {
                            if(cmdprogress) --cmdprogress;
                            if(cmdprogress<1) $('#cmdprogressbtn').hide();
                            if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                                refreshNewSessionPage();
                            }
                            if (ret_val.indexOf('<ERROR:') !== -1) { // error
                              show_voc_gritter(false, ret_val.substring(7), true);
                              $("#filestatuslabel").html("<i class='icon-warning-sign' style='margin-right:3px'> </i><font color=red>error</font>");
                            } else if (ret_val.indexOf('<CONFIRM:') !== -1) {
                              voc_create_confirm(type, path, source, msg, ret_val.substring(9));
                            } else {
                              show_voc_gritter(false, msg, false);
                              refreshFileTree(true, true);
                            }

                    })
                       .fail(function(ret_val) {
                            if(cmdprogress) --cmdprogress;
                            if(cmdprogress<1) $('#cmdprogressbtn').hide();
                            var timenow = new Date().getTime();
                            if (timenow - last_conn_warning > 10*1000) { // 10 seconds
                              show_voc_gritter(false, "File/folder creation/rename failed. Please check your internet connection", true);
                              last_conn_warning = new Date().getTime();
                            }
                    });
 
                    return true;
          }
			
			
		var save_count = 0;
		var last_conn_warning = new Date().getTime();
    function voc_save(showGritter, dspmsg) {
        var save_ok = true;
        save_count++;
    if (save_in_progress) {
      return false;
    }
    save_in_progress = true;

    $('#editor-save-status-btn').hide();
    $("#editor-save-status").show();
    $("#editor-save-status").html('<i class="icon-spin icon-spinner"></i> '+dspmsg);

    $("#save-icon").addClass('icon-spin');
    $("#save-icon").addClass('icon-spinner');
    $('#save-icon').removeClass('vochide');
    var viewerContents = editor.getValue();
    var whichfilepath = viewer_last_fpath;
    if (!whichfilepath) whichfilepath = viewer_first_fpath;
    var filepath = encodeURIComponent(whichfilepath);

    var stepstr = "&stepid=890070";
    var url = "../util/vcsave.php?type=Save&asnid=890069"+stepstr+"&mode=s&version=0&filepath="+filepath + "&vm=34.209.4.84&labtype=1";
    
    editor_content_change = editor.doc.changeGeneration();
    markUpdateChanged(whichfilepath);
    $.ajax({
      type: 'POST',
      url: url,
      async: true,
      data: {code0: viewerContents}
      })
        .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                    refreshNewSessionPage();
                }
                $("#save-icon").removeClass('icon-spin');
                $("#save-icon").removeClass('icon-spinner');
                $("#save-icon").addClass('vochide');
                passed = ( ret_val.indexOf('SAVE SUCCESSFUL') !== -1 );
                $("#editor-save-status").show();
                $('#editor-save-status-btn').hide();
                if (passed) {
                    $("#editor-save-status").html('<i class="icon-ok"></i> Saved');
                                                                                    } else {
                    if (1 || showGritter) {
                        if (ret_val.indexOf('<ERROR:') !== -1) {
                            errStr = ret_val.substring(7);
                        } else {
                            errStr = ret_val;
                        }
                        show_voc_gritter(false, "Save failed. " + errStr, true);
                                                                    }
                    $("#editor-save-status").html('<i class="icon-exclamation-sign"></i> Save failed');
                }
        
             //   editor_content_change = editor.doc.changeGeneration();
                save_in_progress = false;
                var moresave = save_count>1;
                save_count = 0;
                          if( moresave ){
               window.setTimeout(function(){ voc_save(showGritter, dspmsg); } , 100);
             }
        })
       .fail(function(ret_val) {
            $("#save-icon").removeClass('icon-spin');
            $("#save-icon").removeClass('icon-spinner');
            $("#save-icon").addClass('vochide');
    
            var timenow = new Date().getTime();
            if (timenow - last_conn_warning > 10*1000) { // 10 seconds
              show_voc_gritter(false, "File save failed. Please check your internet connection", true);
              last_conn_warning = new Date().getTime();
            }
            save_count = 0;
            save_in_progress = false;
            save_ok = false;
        });

		    return save_ok;
		}
			
			function isSaveNeeded() {
					var codeFileChanged = true;
					if (editor && editor.doc.isClean(editor_content_change)) codeFileChanged = false;
					if (vocIsFileReadOnly(viewer_last_fpath)) codeFileChanged = false;
					return codeFileChanged;
			}

		 var isTermActive = true;
     function periodic_save() {
            var saveNeeded = isSaveNeeded();
      timeNow = new Date().getTime();
      if (saveNeeded && (timeNow - lastEditTime > 5000)) {
        voc_save(false, "Saving");
      }
      if ($('#terminalIframe').length > 0) {
          if (document.activeElement.name == "terminalIframe") {
              if (!isTermActive) {
                 isTermActive = true;
                 console.log("Terminal is now active");
                 // terminalIframe.document.head.innerHTML += '<style type="text/css">.terminal-cursor{background:#AAAAAA !important;}</style>';

                 var el = terminalIframe.document.getElementById('vocCursorStyle');
                 if (el) {
                     el.innerHTML = ".terminal-cursor{background:#AAAAAA !important;";
                 }

              }
          } else { // activeElement is not terminal
              if (isTermActive) {
                 isTermActive = false;
                 console.log("Terminal is NOT active");

                 // terminalIframe.document.head.innerHTML += '<style type="text/css">.terminal-cursor{background:#F3F3F3 !important;}</style>';
                 var el = terminalIframe.document.getElementById('vocCursorStyle');
                 if (el) {
                     el.innerHTML = ".terminal-cursor{background:#F3F3F3 !important;";
                 }
                 
                 refreshFileTree(false, true);
              }
          }
      }
      
      window.setTimeout('periodic_save()', 1000);
     }
			 


		</script>



		<script type="text/javascript">

			var save_in_progress = false;
                        var fileUploadListener = null;
			var runlog_in_progress = false;
			var verify_in_progress = false;
			var log_interval = 1;
			var current_mode = 1;
			var previous_mode = 1;

			var viewer = false;
			var currentEditFileIndex = 0;
			var edit_file = "";
			var edit_file_name = "";


var diffArea = null;


function initDiff() {
  value = editor.getValue();
  var target = document.getElementById("div-diff");
 
  target.innerHTML = "<h4>&nbsp;<i class=\"icon-spin icon-spinner\"></i> Loading diff. Please wait. </h4>";
  
	var filepath = viewer_last_fpath;
	if (!viewer_last_fpath) filepath = viewer_first_fpath;

	// filepath = encodeURIComponent(filepath);
	cm_mode = findMode(filepath);
	
	
	var url = "../util/vcprojapi.php?t=projsource&orig=1&asnid=890069&wa_stepid=890070&id=12222088&data=filepath&version=0";

	$.post(url,{getcode:1,data:filepath},function(ret_val)
	{
		if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
			refreshNewSessionPage();
		}
		// conversion
		$("#scratchpad").val(ret_val);
		orig_val = $("#scratchpad").val();
		
		
		if (ret_val == "") {
		  	target.innerHTML = "<h4>&nbsp; This file has no original version. </h4>";
			diffArea = null;
			return;
		}
		if (orig_val == value) {
		  	target.innerHTML = "<h4>&nbsp;<i class=\"icon-check\"></i> Current version is same as the original version. </h4>";

			// target.innerHTML = "<div style=\"padding: 10px\">Current Version is exactly same as the Original Version.</div>";
			diffArea = null;
			return;
		}
		
		target.innerHTML = "<span style=\"padding-left:10px\">Current Version</span><span class=\"pull-right\" style=\"padding-right:10px\">Original Version</span>";
		  orig2 = orig_val;
		  // value_mod = value.replace(/\u003cscript/g, "\u003cscript type=text/javascript ");
		  value_mod = value;
		  diffArea = CodeMirror.MergeView(target, {
			value: value_mod,
			origLeft: null,
			orig: orig2,
			lineNumbers: true,
			mode: cm_mode,
			highlightDifferences: true
		  });

	});
}

        function setConsoleParams()
        {
                                                          var build_ht = $("#idebox").height() - $("#codeframe").height() - $("#htmlframe").height() - $('#console_divider').height() - $('#html_divider').height() -8 - 10 - 30 - 4; //-ideBtnDiv
                  var console_ht = build_ht - 18;
                                var html_ht = $('#htmlframe').height();
                                      
          $("#buildframe").height(build_ht);
          $("#consolediv").height(console_ht);
        }

        $( document ).ready(function() {
          setConsoleParams();
          window.setTimeout('periodic_save()', 5000);
          

          
			});
			
			function indicate_build_done() {
			}


			
			jQuery(function($){

          $(function() {

          });

          

	function getFilePathStr(unencoded_filepath, encodeIt)
        {
          if (unencoded_filepath.length <= 1)
          {
            return "";
          }
          // if starting with "./work", remove it
          // not sure what to do about asnlib, etc. right now
          fp = unencoded_filepath.replace(/^\.\/work\//, "");
          return "&selectedfile=" + ((encodeIt == true) ? encodeURIComponent(fp) : fp);
        }
          function hideCopyFileBtn() {
              $('#filecopybtn').hide();
          }
          function showCopyFileBtn() {
              $('#downloadbtn').show();
              $('#filecopybtn').show();
          }
          function hidePasteFileBtn() {
              $('#filepastebtn').hide();
          }
          function showPasteFileBtn() {
              if (copyPasteClipboard) {
                  $('#filepastebtn').show();
              }
          }

          function hideAllFileBtn() {
                              $('#fileuploadbtn').hide();
                              $('#filedelbtn').hide();
                              $('#filerenamebtn').hide();
                              $('#newbtn').hide();
                              $("#fileform" ).hide();
                              hideCopyFileBtn();
                              hidePasteFileBtn();
          }
          function showDelFileBtn() {
                              $('#filedelbtn').show();
                              $('#filerenamebtn').show();
          }
          function showCreateFileBtn() {
                              // $("#fileform" ).hide();
                              $('#fileuploadbtn').show();
                              $('#newbtn').show();
          }
          function showNewBtn() {
                              $('#newbtn').show();
          }


     			
				
$("#modal-table-diff").on('shown.bs.modal',
    function (e) {
      initDiff();
    }
);
		
		// File operation handlers
    $('#filecopybtn').on('click', function() {
        $("#filestatuslabel").html("");
        var cb = $('#input_filename').val();
        var paths = $('#tree1').tree('selectedItems').map(function (el) {
  	      var path = el.path.substring(2);
  	      if (el.type == 'folder') {
  	        path += '/';
  	      }
  	      return path;
  	    });
        saveCBClipboard(cb, paths);
    });
    $('#filepastebtn').on('click', function() {
        $("#filestatuslabel").html("");
        var tgt = $("#input_filename").val();
        voc_create("Paste", tgt, '', "Paste successful");
    });



    $('#filecreatebtn').on('click', function() {
        $("#filestatuslabel").html("");
        if (fileoptype=='file') {
            voc_create("File", $("#input_filename").val(), null, "File created");
        } else if (fileoptype=='folder') {
            voc_create("Folder", $("#input_filename").val(), null, "Folder created");
        } else if (fileoptype=='rename') {
            voc_create("Rename", $("#input_filename").val(), $("#span_selectedfile").text(), "Rename successful");
        }
    });

    $('#filedelbtn').on('click', function() {
      var paths = $('#tree1').tree('selectedItems').map(function (el) {
	      var path = el.path.substring(2);
	      if (el.type == 'folder') {
	        path += '/';
	      }
	      return path;
	    });
	var $val = $("#input_filename").val();
	var $type = $("#input_filetype").val();
        $("#filestatuslabel").html("");
	if ($val != '') {
				bootbox.dialog("Are you sure you want to delete " + JSON.stringify(paths).substring(1, JSON.stringify(paths).length-1) + "?", [{
					"label" : "Yes",
					"class" : "btn vocbtn-ac vocbtn-action",
					"callback": function() {
						voc_create("Delete", $("#input_filename").val(), null, "Deleted");
					}
					}, {
					"label" : "Cancel",
					"class" : "btn vocbtn-ac vocbtn-status"
					}]
				);
	}
    });
    
    
    
    function isReadmeVisible() {
      if (left_panel_instructions) {
        return $('#showdocviewicon').hasClass("icon-check");
      }
      return false;
    }

    function showHideDivBasedOnHeight(divId)
    {
      if ($(divId).length) {
        if ( ($(divId).height() == 0) || ($(divId).height() == '0%') ) {
          $(divId).hide();
        } else {
          $(divId).show();
        }
      }
    }

    function showHideFramesBasedOnHeight()
    {
      showHideDivBasedOnHeight('#htmlframe');
      showHideDivBasedOnHeight('#codeframe');
      showHideDivBasedOnHeight('#buildframe');
      showHideDivBasedOnHeight('#consolediv');
    }

    if (left_panel_instructions) {
      var lang_readmes = {"en-us":"ASNLIB\/public\/docs\/lang\/en-us\/README.html","en-us-cli":"ASNLIB\/public\/docs\/lang\/en-us-cli\/README.html","es-es":"ASNLIB\/public\/docs\/lang\/es-es\/README.html","id-id":"ASNLIB\/public\/docs\/lang\/id-id\/README.html","ja-jp":"ASNLIB\/public\/docs\/lang\/ja-jp\/README.html","ko-kr":"ASNLIB\/public\/docs\/lang\/ko-kr\/README.html","pt-br":"ASNLIB\/public\/docs\/lang\/pt-br\/README.html","zh-cn":"ASNLIB\/public\/docs\/lang\/zh-cn\/README.html"};
      $('#localeLangReadmeSelect').on('change', function() {
        var readmelang = $(this).val();
        langReadmePath = lang_readmes[readmelang];
        iframeReadmeSrc ="../web/1975667/890070.0/" + langReadmePath;
        $("#readMeIframe").attr('src', iframeReadmeSrc);
        $.ajax({
                 type: "POST",
                 url: "../util/vcprojapi.php",
                 data: { t : 'changeReadmeLang',
                         stepid : "890070",
                         readmelang : readmelang }
        }) .done(function(ret_val) {
          //just return
        });
      });
    }


    if (left_panel_instructions)
    {
      $('#showdocs').on('click', function()
      {
        $('#instructions').toggle();
        if (! isDocVisible())
        {
          checkDocSelector();
          if ($('#showfiletreeicon').hasClass("icon-check"))
          {
            $('#showfiletree').click();
          }
          if (doc_panel_width == 0)
          {
            doc_panel_width = $('#instructions').width();
          }
          else
          {
            $('#instructions').width(doc_panel_width);
          }
          $('#instructionsdivider').show();

          // // The file list tree is being replaced by the readme
          // // if html is visible, make sure that the "reload" button is not pulled to the leftmost edge
          // if (isHtmlVisible() && $('#htmlreloadbtn').is(':visible'))
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + (doc_panel_width + $('#instructionsdivider').width() + 5) + 'px !important');
          // }
          // else
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + (doc_panel_width + $('#instructionsdivider').width() + 5) + 'px !important; display:none;');
          // }
        }
        else
        {
          uncheckDocSelector();
          $('#instructionsdivider').hide();

          // if (isHtmlVisible() && $('#htmlreloadbtn').is(':visible'))
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + 5 + 'px !important');
          // }
          // else
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + 5 + 'px !important; display: none;');
          // }

          /* the following condition will only be true in case of README 100% */
          if (!isSourceVisible() && !isConsoleVisible() && !isHtmlVisible())
          {
            $('#showfiletree').click();
          }

          /* the following condition will only be true in case of README 100% */
          if (!isSourceVisible() && !isConsoleVisible() && !isHtmlVisible())
          {
            $('#showfiletree').click();
          }
        }
      });
    }
    
    $('#showfiletree').on('click', function()
    {
      $('#filelisting').toggle(); // hide <=> show
      if (! isFileTreeVisible())
      {
        checkFileTreeSelector();
        if (left_panel_instructions)
        {
          if (isDocVisible())
          {
            $('#instructions').width(doc_panel_width);
            $('#showdocs').click();
          }
        }
        $('#filelistdivider').show();
        $('#filelistbuttons').show();
        showFileTreeSource();
      }
      else
      {
        uncheckFileTreeSelector();
        $('#filelistdivider').hide();
        $('#filelistbuttons').hide();
      }
    });

    function showFileTreeSource() {
      /* the following condition will only be true in case of README 100% */
      if ( !isSourceVisible() && !isConsoleVisible() && !isHtmlVisible() )
      {
        viewPreExpandedReadmeFrame();
      }
    }

    function viewSaveData()
    {
      code_ht = $('#codeframe').height();
      build_ht = $('#buildframe').height();
      console_ht = $('#consolediv').height();
      html_ht = $('#htmlframe').height();
      console_divider_ht = $('#console_divider').height();
      infobar_ht = 0;
      initial_frame_count = ((code_ht > 0) ? 1 : 0) + ((build_ht > 0) ? 1 : 0) + ((html_ht > 0) ? 1 : 0);
      intial_total_frame_ht = code_ht + build_ht + html_ht + console_divider_ht;
      frame_idebox_ht = $('#idebox').height();
      frame_idebox_ht = frame_idebox_ht - $('#ideButtonDiv').height();
    }
    
    function viewIsSameAsInitial(hasSource, hasConsole, hasHtml)
    {
      return (   ((hasSource  && (code_ht  > 0)) || (!hasSource  && (code_ht  == 0)))
              && ((hasConsole && (build_ht > 0)) || (!hasConsole && (build_ht == 0)))
              && ((hasHtml    && (html_ht  > 0)) || (!hasHtml    && (html_ht  == 0)))  );
    }

    function hideSourceExtras()
    {
      if (! $('#editor_current_file').hasClass("hidden-1"))
      {
        $('#editor_current_file').addClass("hidden-1");
        $('#file_colon').addClass("hidden-1");
        $('#editor-save-status').addClass("hidden-1");
        $('#editor_current_ts').addClass("hidden-1");
      }
    }

    function showSourceExtras()
    {
      if ($('#editor_current_file').hasClass("hidden-1"))
      {
        $('#editor_current_file').removeClass("hidden-1");
        $('#file_colon').removeClass("hidden-1");
        $('#editor-save-status').removeClass("hidden-1");
        $('#editor_current_ts').removeClass("hidden-1");
      }
    }

    function showHtmlExtras()
    {
      $('#htmlreloadbtn').show();
      $('#showhtml').show();
    }

    function hideHtmlExtras()
    {
      $('#htmlreloadbtn').hide();
      // $('#showhtml').hide();
    }

    function showSourceConsoleExtras()
    {
      $('#console_divider').show();
    }
    
    function hideSourceConsoleExtras()
    {
      $('#console_divider').hide();
    }

    function uncheckConsoleSelector()
    {
      if ($('#showterminalicon').hasClass("icon-check"))
      {
        $('#showterminalicon').removeClass("icon-check");
        $('#showterminalicon').addClass("icon-check-empty");
      }
    }
    
    function checkConsoleSelector()
    {
      if ($('#showterminalicon').hasClass("icon-check-empty"))
      {
        $('#showterminalicon').removeClass("icon-check-empty");
        $('#showterminalicon').addClass("icon-check");
      }
    }

    function isConsoleVisible()
    {
      return ($('#showterminalicon').hasClass("icon-check")) ? true : false;
    }
    
    function uncheckSourceSelector()
    {
      if ($('#showcodeviewicon').hasClass("icon-check"))
      {
        $('#showcodeviewicon').removeClass("icon-check");
        $('#showcodeviewicon').addClass("icon-check-empty");
      }
    }

    function checkSourceSelector()
    {
      if ($('#showcodeviewicon').hasClass("icon-check-empty"))
      {
        $('#showcodeviewicon').removeClass("icon-check-empty");
        $('#showcodeviewicon').addClass("icon-check");
      }
    }

    function isSourceVisible()
    {
      return ($('#showcodeviewicon').hasClass("icon-check")) ? true : false;
    }

    function uncheckHtmlSelector()
    {
      if ($('#showhtmlicon').hasClass("icon-check"))
      {
        $('#showhtmlicon').removeClass("icon-check");
        $('#showhtmlicon').addClass("icon-check-empty");
      }
    }

    function checkHtmlSelector()
    {
      if ($('#showhtmlicon').hasClass("icon-check-empty"))
      {
        $('#showhtmlicon').removeClass("icon-check-empty");
        $('#showhtmlicon').addClass("icon-check");
      }
    }

    function isHtmlVisible()
    {
      return ($('#showhtmlicon').hasClass("icon-check")) ? true : false;
    }

    function uncheckDocSelector()
    {
      if ($('#showdocviewicon').hasClass("icon-check"))
      {
        $('#showdocviewicon').removeClass("icon-check");
        $('#showdocviewicon').addClass("icon-check-empty");
      }
    }

    function checkDocSelector()
    {
      if ($('#showdocviewicon').hasClass("icon-check-empty"))
      {
        $('#showdocviewicon').removeClass("icon-check-empty");
        $('#showdocviewicon').addClass("icon-check");
      }
    }

    function isDocVisible()
    {
      return ($('#showdocviewicon').hasClass("icon-check")) ? true : false;
    }

    function uncheckFileTreeSelector()
    {
      if ($('#showfiletreeicon').hasClass("icon-check"))
      {
        $('#showfiletreeicon').removeClass("icon-check");
        $('#showfiletreeicon').addClass("icon-check-empty");
      }
    }

    function checkFileTreeSelector()
    {
      if ($('#showfiletreeicon').hasClass("icon-check-empty"))
      {
        $('#showfiletreeicon').removeClass("icon-check-empty");
        $('#showfiletreeicon').addClass("icon-check");
      }
    }

    function isFileTreeVisible()
    {
      return ($('#showfiletreeicon').hasClass("icon-check")) ? true : false;
    }

    function viewOnlyConsole()
    {
      $('#codeframe').height(infobar_ht);
      $('#buildframe').height(build_ht + code_ht + html_ht - infobar_ht);
      $('#consolediv').height(console_ht + code_ht + html_ht - infobar_ht);
      $('#htmlframe').height(0);
      // if README is there, it must be full page - so shrink it
      if (isReadmeVisible())
      {
         $('#instructions').width(doc_panel_width);
         $('#instructionsdivider').show();
      }
      showHideFramesBasedOnHeight();
      hideSourceExtras();
      hideHtmlExtras();
    }

    function viewOnlySource()
    {
      $('#codeframe').height(build_ht + code_ht + html_ht);
      $('#consolediv').height(0);
      $('#buildframe').height(0);
      $('#htmlframe').height(0);
      $('#codeform0').height("100%");
      // if README is there, it must be full page - so shrink it
      if (isReadmeVisible())
      {
         $('#instructions').width(doc_panel_width);
         $('#instructionsdivider').show();
      }
      showHideFramesBasedOnHeight();
      showSourceExtras();
      hideHtmlExtras();
      editor.refresh();
    }

    function viewOnlyHtml()
    {
      $('#codeframe').height(infobar_ht);
      $('#consolediv').height(0);
      $('#buildframe').height(0);
      $('#htmlframe').height(build_ht + code_ht + html_ht - infobar_ht);
      // if README is there, it must be full page - so shrink it
      if (isReadmeVisible())
      {
         $('#instructions').width(doc_panel_width);
         $('#instructionsdivider').show();
      }
      showHideFramesBasedOnHeight();
      hideSourceExtras();
      showHtmlExtras();
    }

    function viewSourceConsole(param_code_ht, param_build_ht, param_console_ht)
    {
      $('#codeframe').height(param_code_ht);
      $('#buildframe').height(param_build_ht);
      $('#consolediv').height(param_console_ht);
      $('#codeform0').height("100%");
      $('#htmlframe').height(0);
      showHideFramesBasedOnHeight();
      showSourceExtras();
      hideHtmlExtras();
      showSourceConsoleExtras();
      editor.refresh();
    }

    function viewSourceHtml(param_code_ht, param_html_ht)
    {
      $('#codeframe').height(param_code_ht);
      $('#consolediv').height(0);
      $('#buildframe').height(0);
      $('#htmlframe').height(param_html_ht);
      $('#codeform0').height("100%");
      showHideFramesBasedOnHeight();
      showSourceExtras();
      showHtmlExtras();
      editor.refresh();
    }

    function viewConsoleHtml(param_build_ht, param_console_ht, param_html_ht)
    {
      $('#codeframe').height(0);
      $('#buildframe').height(param_build_ht);
      $('#consolediv').height(param_console_ht);
      $('#htmlframe').height(param_html_ht);
      showHideFramesBasedOnHeight();
      hideSourceExtras();
      showHtmlExtras();
    }

    function viewSourceConsoleHtml(param_code_ht, param_build_ht, param_console_ht, param_html_ht)
    {
      $('#codeframe').height(param_code_ht);
      $('#consolediv').height(param_console_ht);
      $('#buildframe').height(param_build_ht);
      $('#htmlframe').height(param_html_ht);
      $('#codeform0').height("100%");
      showHideFramesBasedOnHeight();
      showSourceExtras();
      showHtmlExtras();
      editor.refresh();
    }

    // 1 -> 2 / 3 -> 2
    // ----------------------
    // if new_cfg == init_cfg:
    //     just use initial settings
    // if new_count == initial_count:
    //     for the one frame that was in the init_cfg, use the same height
    //     for the other one, use the remainder
    // else:
    //     use 50/50 split
    
    // 2 -> 3
    // if new_cfg == init_cfg:
    //     just use initial settings
    // else:
    //     33/33/33 split

    function drawOneFrameElement()
    {
      if (isSourceVisible())
      {
        viewOnlySource();
      }
      else if (isHtmlVisible())
      {
        viewOnlyHtml();
      }
      else
      {
        viewOnlyConsole();
      }
      hideSourceConsoleExtras();
    }

    function drawTwoFrameElements()
    {
      if (isSourceVisible())
      {
        param_code_ht = intial_total_frame_ht * 0.5;
      }
      if (isHtmlVisible())
      {
        param_html_ht = intial_total_frame_ht * 0.5;
      }
      if (isConsoleVisible())
      {
        param_build_ht = intial_total_frame_ht * 0.5;
        param_console_ht = param_build_ht - 20;
      }

      if (isSourceVisible() && isConsoleVisible())
      {
        viewSourceConsole(param_code_ht, param_build_ht, param_console_ht);
      }
      else if (isSourceVisible() && isHtmlVisible())
      {
        viewSourceHtml(param_code_ht, param_html_ht);
      }
      else
      {
        viewConsoleHtml(param_build_ht, param_console_ht, param_html_ht);
      }
    }

    function drawThreeFrameElements()
    {
      param_code_ht = intial_total_frame_ht * 0.333;
      param_html_ht = intial_total_frame_ht * 0.333;
      param_build_ht = intial_total_frame_ht * 0.333;
      param_console_ht = param_build_ht - 20;
      hideSourceConsoleExtras();
      viewSourceConsoleHtml(param_code_ht, param_build_ht, param_console_ht, param_html_ht);
    }

    function drawFrameElements()
    {
      count = (isSourceVisible() ? 1 : 0) + (isConsoleVisible() ? 1 : 0) + (isHtmlVisible() ? 1 : 0);
      switch (count)
      {
        case 1: drawOneFrameElement();    break;
        case 2: drawTwoFrameElements();   break;
        case 3: drawThreeFrameElements(); break;
      }
      viewSaveData();
    }

    function needOneSelectionMsg()
    {
      str = "At least one frame element must be selected";
      bootbox.dialog(str,
           [{
             "label" : "Ok",
             "class" : "btn vocbtn-ac vocbtn-action"
           }]
      );
    }

    $('#showhtml').on('click', function()
    {
      if (isHtmlVisible())
      {
        count = (isSourceVisible() ? 1 : 0) + (isConsoleVisible() ? 1 : 0);
        if (count == 0)
        {
          handleZeroFrameElements();
          return;
        }
        uncheckHtmlSelector();
        drawFrameElements();
      }
      else
      {
        checkHtmlSelector();
        drawFrameElements();
      }
    });

    var preExpandedReadmeCfg = null;

    function viewPreExpandedReadmeFrame()
    {
      if (preExpandedReadmeCfg == "Console")
      {
        checkConsoleSelector();
      }
      else if (preExpandedReadmeCfg == "Html")
      {
        checkHtmlSelector();
      }
      else
      {
        checkSourceSelector();
      }
      drawFrameElements();
    }

    function handleZeroFrameElements()
    {
      // if it's the README that wants to go full-size, let it
      // but save the current setting first
      if (isReadmeVisible())
      {
        if (isSourceVisible())
        {
          preExpandedReadmeCfg = "Source";
          uncheckSourceSelector();
        }
        else if (isHtmlVisible())
        {
          preExpandedReadmeCfg = "Html";
          uncheckHtmlSelector();
        }
        else
        {
          preExpandedReadmeCfg = "Console";
          uncheckConsoleSelector();
        }
        viewOnlyREADME();
      }
      else
      {
        // don't allow zero
        needOneSelectionMsg();
      }
      return;
    }

    function viewOnlyREADME()
    {
      $('#codeframe').height(0);
      $('#buildframe').height(0);
      $('#consolediv').height(0);
      $('#htmlframe').height(0);
      hideSourceExtras();
      hideHtmlExtras();
      $('#instructions').width("100%");
      $('#instructionsdivider').hide();
    }


    $('#showterminal').on('click', function()
    {
      if (isConsoleVisible())
      {
        count = (isSourceVisible() ? 1 : 0) + (isHtmlVisible() ? 1 : 0);
        if (count == 0)
        {
          handleZeroFrameElements();
          return;
        }
        uncheckConsoleSelector();
        drawFrameElements();
      }
      else
      {
        checkConsoleSelector();
        drawFrameElements();
      }
    });

    $('#showcodeview').on('click', function()
    {
      if (isSourceVisible())
      {
        count = (isConsoleVisible() ? 1 : 0) + (isHtmlVisible() ? 1 : 0);
        if (count == 0)
        {
          handleZeroFrameElements();
          return;
        }
        uncheckSourceSelector();
        drawFrameElements();
      }
      else
      {
        checkSourceSelector();
        drawFrameElements();
      }
    });
    

    if (left_panel_instructions)
    {
      if (doc_panel_width == 0) {
        doc_panel_width = $('#instructions').width();
      }
            var input = document.getElementById("readmeframehide");
      if (input !== null) {
        $('#readmeframehide').on('click', function() {
          $('#showfiletree').click();
        });

        input.addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
         event.preventDefault();
         document.getElementById("readmeframehide").click();
        }
      });
    }
          }
    // save the initial sizes so easier to resize later on
    viewSaveData();


    var resizeEnd;
    // var resizeStart = false;

    // function resizeStartFunc()
    // {
    //   console.log("VOC: START resize");
    // }

    function resizeEndFunc()
    {
      // console.log("VOC: END Resize");
      
      new_frame_idebox_ht = $('#idebox').height();
      new_frame_idebox_ht = new_frame_idebox_ht - $('#ideButtonDiv').height();

      idebox_multiplier = new_frame_idebox_ht / frame_idebox_ht;
      // console.log("VOC: mult: " + idebox_multiplier);
      
      if (code_ht) {
        $('#codeframe').height(code_ht * idebox_multiplier);
        // console.log("VOC: code: " + code_ht + " -> " + code_ht * idebox_multiplier);
      }
      if (html_ht) {
        $('#htmlframe').height(html_ht * idebox_multiplier);
        // console.log("VOC: html: " + html_ht + " -> " + html_ht * idebox_multiplier);
      }
      if (build_ht) {
        setConsoleParams();
        // console.log("VOC: build: " + build_ht + " -> " + build_ht * idebox_multiplier);
      }

      //mhui
	    var ht = window.innerHeight - document.getElementById('idebox').offsetTop - $('#ideButtonDiv').height() - 70; //50
	    $('#filelisting').height(ht);
	    
      viewSaveData();
      // resizeStart = false;
    }

    window.addEventListener('resize', function(event) {
      // if (resizeStart == false) {
      //   resizeStart = true;
      //   resizeStartFunc();
      // }
      clearTimeout(resizeEnd);
      resizeEnd = setTimeout(resizeEndFunc, 100);
    });
    
    function resizeCodeFrame()
    {
      ht = frame_idebox_ht - $('#htmlframe').height() - $('#ideButtonDiv').height();
      $('#codeframe').height(ht);
    }

  $('.vocdivider_h1').draggable({
    axis: 'y',
    containment: 'parent',
    helper: 'clone',
    iframeFix: true,
    // refreshPositions: true,
    scroll: false,
    drag: function (event, ui) {
      var parent_height = $(this).parent().height();
      var prev_height = ui.position.top;
      $(this).prev().height(prev_height);
      // console.log("VOC: 1: Draggin'... " + ui.position.top);
      resizeCodeFrame();
    }
  });

  $('.vocdivider_h2').draggable({
    axis: 'y',
    containment: 'parent',
    helper: 'clone',
    iframeFix: true,
    // refreshPositions: true,
    scroll: false,
    drag: function (event, ui) {
      var prev_height = ui.position.top;
      if (prev_height < 50) {
        return;
      }
      var parent_height = $(this).parent().height();
      var height_of_console = parent_height - prev_height - $('#ideButtonDiv').height();
      if (height_of_console < 75) {
        return;
      }
      $(this).prev().height(prev_height);
      // console.log("VOC: 2: Draggin'... " + ui.position.top);
      setConsoleParams();
    }
  });


    // $(document).ready(function() {
    $(window).load(function() {
      // if student and ide == standard, see if we want to change the layout
                        $('#showcodeview').click();
            showHideFramesBasedOnHeight();
      //mhui
	    var ht = window.innerHeight - document.getElementById('idebox').offsetTop - $('#ideButtonDiv').height() - 70; //50
	    $('#filelisting').height(ht);
    });

    $('#fileuploadbtn').on('click', function() {
                  $("#filestatuslabel").html("");
                                    markUpdateChanged($("#input_filename").val());
                  $('#fileuploadfield').val("");
        var args = '&type=Upload&asnid=890069&stepid=890070&mode=s&version=0&vmd=100&filepath=./' + $("#input_filename").val();
        if(fileUploadListener) document.getElementById('fileuploadfield').removeEventListener('change', fileUploadListener, false);
        fileUploadListener = vcUploadFiles('modal-upload-wait', 'uploadWaitMsgBox', null,'fileuploadfield', 10, args, null);
	$("#fileuploadfield").click();
    });
    var wasDelOn = false;
    var fileoptype = '';

    $('#filecancelbtn').on('click', function() {
                        var sel_type = $('#input_filetype').val();
                        var seltxt = $("#span_selectedfile").text();
                        fileoptype = '';
			$("#fileform" ).hide();
                        if(copyPasteClipboard && sel_type=='folder'){
			  $('#newbtn').show();
			  $('#filepastebtn').show();
                        }
			$('#fileuploadbtn').show();
                        if(seltxt.search(/^(ASNLIB|LIB|resource\/lib|resource\/asnlib)\/publicdata\//)<0){
                          showCopyFileBtn();
                        }
			if (wasDelOn) {
			    $('#filedelbtn').show();
			    $('#filerenamebtn').show();
			}
			$("#filestatuslabel").html("");
			//$('#well_selectedfile').show();
			var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "black";
      }
			//document.getElementById('well_selectedfile').style.color = "black";
                        $("#input_filename").val(seltxt);
    });
    $('#filenewbtn').on('click', function() {
                        fileoptype = 'file';
                        $("#filestatuslabel").html("");
			if ($('#filedelbtn').is(":visible")) {
				wasDelOn = true;
			} else {
				wasDelOn = false;
			}
	                $('#filepastebtn').hide();
			$('#fileuploadbtn').hide();
			hideCopyFileBtn();
			$('#filedelbtn').hide();
			$('#filerenamebtn').hide();
			$("#fileform" ).show();
			//$('#well_selectedfile').hide();
			var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "#f5f5f5";
      }
			//document.getElementById('well_selectedfile').style.color = "#f5f5f5";
			$('#input_filename').focus();
    });
    
    $('#foldernewbtn').on('click', function() {
                        fileoptype = 'folder';
                        $("#filestatuslabel").html("");
			if ($('#filedelbtn').is(":visible")) {
				wasDelOn = true;
			} else {
				wasDelOn = false;
			}
	                $('#filepastebtn').hide();
			hideCopyFileBtn();
			$('#fileuploadbtn').hide();
			$('#filedelbtn').hide();
			$('#filerenamebtn').hide();
			$("#fileform" ).show();
			//$('#well_selectedfile').hide();
		  var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "#f5f5f5";
      }
			//document.getElementById('well_selectedfile').style.color = "#f5f5f5";
			$('#input_filename').focus();
    });

    function showCanvas()
    {
      
    }
    function showEditor()
    {
          }


    $('#filerenamebtn').on('click', function() {
                        fileoptype = 'rename';
                        $("#filestatuslabel").html("");
			if ($('#filedelbtn').is(":visible")) {
				wasDelOn = true;
			} else {
				wasDelOn = false;
			}
                        hideCopyFileBtn();
			$('#newbtn').hide();
	                $('#filepastebtn').hide();
			$('#fileuploadbtn').hide();
			$('#filedelbtn').hide();
			$("#fileform" ).show();
			//$('#well_selectedfile').hide();
			var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "#f5f5f5";
      }
			//document.getElementById('well_selectedfile').style.color = "#f5f5f5";
    });

    $('#canvasbtn').on('click', function() {
      // var url = "../web/1975667/890070/" + "work/" + "voc_canvas.html";
      // $('#div_canvas').html("<iframe src=\""+ url +"\" width=\"100%\" height=\"100%\"></iframe>");
      showCanvas();
    });

    $('#fileviewbtn').on('click', function() {
        		if (isSaveNeeded()) {
        				voc_save(true, "Saving");
        		}
      var val = $('#editor_current_file').text();
                 var url = "../web/1975667/890070.0/"+val;
            $('#browser-viewer-title').text(val);
      $('#browser-viewer-iframe').attr("src", url);
      $('#browser-viewer-link').attr("href", url);
      $('#browser-viewer-modal').modal('show');
    });

    var lastHtmlFileShown = null;
    function showHtmlFile(val) {
              var url = "../web/1975667/890070.0/" + val;
           lastHtmlFileShown = val;
     // make sure that the html frame is there
     if (! isHtmlVisible())
     {
       checkHtmlSelector();
       drawFrameElements();
     }
     $('#div_html_frame_inner').html("<span id=\"loadingText\">Loading...</span><iframe id=\"htmliframe\" src=\""+ url +"\" width=\"100%\" height=\"100%\" style=\"border:0px\" title=\"HTML\"></iframe>");
     $('#htmliframe').on('load', function() {
       $('#loadingText').remove();
     });
    }

    function showHtmlFileDelayed(val) {
      if (isSaveNeeded()) {
        voc_save(true, "Saving");
      }
      if (save_in_progress) {
        setTimeout(showHtmlFileDelayed, 300, val);
      } else {
        showHtmlFile(val);
      }
    }
    
    $('#htmlreloadbtn').on('click', function() {
      if (lastHtmlFileShown == null) {
        return;
      }
      showHtmlFileDelayed(lastHtmlFileShown);
    });
	
		$('#tree1').ace_tree({
			dataSource: treeDataSource,
			multiSelect: true,
			loadingHTML:'<div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div>',
			'open-icon' : 'icon-minus',
			'close-icon' : 'icon-plus',
			'selectable' : true,
			'selected-icon' : 'icon-caret-right',
			'unselected-icon' : 'icon-caret-right',
			cacheItems: true
		});
		
 		// one accesibilty handler per panel
		$('#filelisting').off('keydown');
        $('#filelisting').attach_accesible_handler();
        $('#idenav').off('keydown');
        $('#idenav').attach_accesible_handler();
        $('#breadcrumb').off('keydown');
        $('#breadcrumb').attach_accesible_handler();


		$('#tree1').on('loaded', function (evt, data) {
	    console.log('tree1 loaded');
	    // make long file/folder names appear on one line and clip if too long
	    $('div[class="tree-item-name"] span[class="tree-btn"]').css({'display': 'inline-block', 'vertical-align': 'top', 'max-width': '75%', 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'white-space': 'nowrap'});
	    $('div[class="tree-folder-name"] span[class="tree-btn"]').css({'display': 'inline-block', 'vertical-align': 'top', 'max-width': '75%', 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'white-space': 'nowrap'});
	    $('#editor_current_file_div #editor_current_file').css({'display': 'inline-block', 'vertical-align': 'top', 'max-width': '500px', 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'white-space': 'nowrap'});
	    // shift+click is used for multi-select so prevent text from being highlighted
  	  $('div[class="tree-item"]').css({'user-select': 'none', '-ms-user-select': 'none', '-moz-user-select': 'none', '-webkit-user-select': 'none'});
  	  $('div[class="tree-folder-header"]').css({'user-select': 'none', '-ms-user-select': 'none', '-moz-user-select': 'none', '-webkit-user-select': 'none'});

	//		var classList = $('.tree-btn');
	//		$.each(classList, function(index, item) {
	//    		$(item).make_accesible();
	//    	});
	    if(typeof tree_data !== 'undefined') {
  	    //Autoloads files between 0mb-8mb
    	  var widgetFiles = tree_data.work.additionalParameters.children;
    	  if(widgetFiles != null && "" && autoloadFileOccured < 2) {
    	     $.each(widgetFiles, function(i, obj) {
    	      
    	      // File will autoload if file is an item, has a size < 8mb, and the file name doesn't start with a '.'
    	      if(obj.type == 'item' && obj.size >= 0 && obj.size < 8388608 && (obj.name).indexOf('.') != 0) {
    	        var rec = {
    	          name: obj.name,
    	          path: obj.path,
    	          ee: obj.ee,
    	          autoload: 1 // Used to exclude period_save() for filetreeFileSelect() or it'll throw cross-DOM error
    	        }
    	        autoloadFileOccured += 1;
    	        // get the div[class="tree-item"] element for obj.name
    	        // in case of ./resource/.../work/<obj.name>, the correct one is the first child of the work folder
    	          // aka parent().parent().parent().parent().parent().attr('id') == 'tree1';
    	        let htmlEl = $('span[class="tree-btn"]').filter(function() {
                return $(this).text() === obj.name;
              }).filter(function() {
                return $(this).parent().parent().parent().parent().parent().attr('id') == 'tree1';
              }).parent().parent();
              $('#tree1').tree('selectItem', htmlEl);
    	        return false;
    	      }
    	    });
    	  }
	    }
	
	
    });

    function multiSelectShowHideBtns() {
      var showNewBtn = 1;
      var showRenameBtn = 1;
      var showDeleteBtn = 1;
      var showUploadBtn = 1;
      var showCopyBtn = 1;
      var showPasteBtn = 1;
      var showDownloadBtn = 1;

      var selectedItems = $('#tree1').tree('selectedItems');
      if (selectedItems.length > 1) { // can only copy, delete, download multiple items at once
        showNewBtn = 0;
        showRenameBtn = 0;
        showUploadBtn = 0;
        showPasteBtn = 0;
      }
            for (const el of selectedItems) {
        if (selectedItems[0].type == 'item') {
          showNewBtn = 0;
          showUploadBtn = 0;
          showPasteBtn = 0;
        }
        if (el.ed != 1) {
          showDeleteBtn = 0;
          showRenameBtn = 0;
        }
        if (el.ec != 1) {
          showNewBtn = 0;
          showUploadBtn = 0;
          showPasteBtn = 0;
        }
        if (el.path == './resource') {
          showNewBtn = 0;
          showRenameBtn = 0;
          showDeleteBtn = 0;
          showUploadBtn = 0;
          showCopyBtn = 0;
          showPasteBtn = 0;
          showDownloadBtn = 0;
        } else if (el.path.search(/resource/) >= 0) {
                      showNewBtn = 0;
            showRenameBtn = 0;
            showDeleteBtn = 0;
            showUploadBtn = 0;
            showPasteBtn = 0;
                  }
        if (el.path.search(/resource\/(asnlib|lib)\/publicdata/) >= 0) {
          if (el.type == 'item') {
            showCopyBtn = 0;
          }
        }
      }
      if (showNewBtn)      { $('#newbtn').show();        } else { $('#newbtn').hide(); }
      if (showRenameBtn)   { $('#filerenamebtn').show(); } else { $('#filerenamebtn').hide(); }
      if (showDeleteBtn)   { $('#filedelbtn').show();    } else { $('#filedelbtn').hide(); }
      if (showUploadBtn)   { $('#fileuploadbtn').show(); } else { $('#fileuploadbtn').hide(); }
      if (showCopyBtn)     { $('#filecopybtn').show();   } else { $('#filecopybtn').hide(); }
      if (showPasteBtn)    { showPasteFileBtn();         } else { hidePasteFileBtn(); }
      if (showDownloadBtn) { $('#downloadbtn').show();   } else { $('#downloadbtn').hide(); }
    }

		$('#tree1').on('opened', function (evt, data) {
		});

		$('#tree1').on('closed', function (evt, data) {
		});

		$('#tree1').on('selectedfolder', function (evt, data) {
		  if (data.info.length <= 0) { // when an item is unselected and the next item in the selected list is a folder
		    hideAllFileBtn();
        $('#downloadbtn').hide();
    		$('#span_selectedfile').html('');
        //$('#editor_current_file').html('');
		    return;
		  }
		  $('#trees3').find('.tree-selected').removeClass('tree-selected');
			var relpath = data.info[0].path.substring(2);
			$('#input_filename').val(relpath + "/");
			$('#span_selectedfile').html(relpath + "/");
			//$('#editor_current_file').html('');
			//$('#well_selectedfile').show();
			var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "black";
      }
			//document.getElementById('well_selectedfile').style.color = "black";
			$('#input_filetype').val("folder");

			hideAllFileBtn();
      if( relpath == 'resource' ){
        $('#downloadbtn').hide();
        return false;
      }

      
      			  if (data.info[0].ec==1 || relpath.search(/^LatestSubmission/)<0){
                   if( relpath.search(/^resource/)<0 ){
			      showCreateFileBtn();
		  	      showPasteFileBtn();
          } else {
            showCopyFileBtn();
          }
                  if (relpath.search(/resource\/(asnlib|lib)\/publicdata/) >= 0) {
            $('#filenewbtn').css({'visibility': 'hidden'});
          } else {
            $('#filenewbtn').css({'visibility': 'visible'});
          }
        }
            if(relpath.search(/^(ASNLIB|LIB|resource\/lib|resource\/asnlib)\/publicdata($|\/)/)<0){
			  showCopyFileBtn();
      }
			if (data.info[0].ed == 1) {
        if( relpath.search(/^(ASNLIB|LIB)\/publicdata$/)<0 &&
            relpath.search(/^resource\/(lib|asnlib)\/publicdata$/)<0 &&
            relpath.search(/^resource\/(lib|asnlib|scripts|startercode)$/)<0 ){
              showDelFileBtn();
        }
      }
      if ($('#tree1').tree('selectedItems').length > 1) {
        //$('#editor_current_file').html('');
    		$('#span_selectedfile').html('');
        multiSelectShowHideBtns();
        // below: show appropriate buttons when an item is unselected
      } else if ($('#tree1').tree('selectedItems').length == 1) {
        if ($('#tree1').tree('selectedItems')[0].type == 'item') {
          filetreeFileSelect($('#tree1').tree('selectedItems')[0]);
          multiSelectShowHideBtns();
        } else {
          let relpath = $('#tree1').tree('selectedItems')[0].path.substring(2);
          $('#input_filename').val(relpath + "/");
          //$('#editor_current_file').html('');
        }
      }
		});

		function filetreeFileSelect(rec) {
			var relpath = rec.path.substring(2);
			showEditor();
			$('#input_filename').val(relpath);
			$('#span_selectedfile').html(relpath);
			//$('#well_selectedfile').show();
			var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "black";
      }
			//document.getElementById('well_selectedfile').style.color = "black";
			$('#input_filetype').val("file");


                hideAllFileBtn();
          if (rec.ed == 1) {
              if(relpath.search(/^(Scripts|LatestSubmission)/)<0){
                showDelFileBtn();
              }
          }
          if (rec.nc != 1) {
              if( relpath.search(/^(ASNLIB|LIB|resource\/lib|resource\/asnlib)\/publicdata($|\/)/)<0 ){
                showCopyFileBtn();
              }
          }
      
      if (rec.ee == 1) {
          editor.setOption("readOnly", false);
			} else {
          editor.setOption("readOnly", true);
			}

						
			var ext_index = rec.name.lastIndexOf('.');
			if (ext_index == -1) {
				ext = null;
			} else {
      	ext = rec.name.substring(ext_index + 1);
      }
			if (isVidFile(ext)) {
                   var url = "https://labs.vocareum.com/web/1975667/890070/" + relpath;
            var str = '<video width="600px" controls> ' +
                      '<source id="video-viewer-modal-video" src="' + url + '" type="video/mp4">' +
                      'Your browser does not support HTML5 video. </video>';
            $('#video-viewer-modal-div').html(str);
            $('#video-viewer-modal').modal('show');
            return;
			} else if (isImgFile(ext)) {
               $.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', asnid: 890069,  stepid:890070, data: rec.path,version:0, vm:'34.209.4.84', labtype:1}, function(data) {
            $('#image-viewer-modal-image').prop('src', data);
            $('#image-viewer-modal').modal('show');
				});
        return;
			} else if (isOtherFile(ext)) {
                    $.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', asnid: 890069,  stepid:890070, data: rec.path,version:0, vm:'34.209.4.84', labtype:1}, function(data) {
					$('#other-viewer-modal-area').prop('data', data);
					// set application type here
					$('#other-viewer-modal').modal('show');
				});
        return;
			} else {
					// all other
			}
			
      if (isBrowserViewableFile(ext) && true) {
        $('#htmlreloadbtn').show();
        showHtmlFile(relpath);
      }
      else {
  			if (isBrowserViewableFile(ext)) {
  			    $('#fileviewbtn').show();
  			} else {
  			    $('#fileviewbtn').hide();
  			}
      }
			
			var codeFileChanged = true;
			
			if (editor.doc.isClean(editor_content_change)) codeFileChanged = false;
			if (vocIsFileReadOnly(viewer_last_fpath)) codeFileChanged = false;

			if (codeFileChanged) {
					voc_save(true, "Saving, please wait");
			}
      var codeComments = ( (typeof (rec.comments) !== 'undefined') ? rec.comments : '' );
			voc_get_viewer_code(rec.path, rec.name, 0, codeComments);


					
		}

		function S3FileSelect(rec) {
			var fpath = rec.fpath;
			var fname = rec.name;
			showEditor();
			editor.setOption("readOnly", true);
			$('#input_filename').val(fpath);
			$('#span_selectedfile').html(fpath);
			//$('#well_selectedfile').show();
		  var element = document.getElementById('well_selectedfile');
      if (typeof(element) != 'undefined' && element != null) {
        document.getElementById('well_selectedfile').style.color = "black";
      }
			//document.getElementById('well_selectedfile').style.color = "black";
			$('#input_filetype').val("file");
			
							hideAllFileBtn();
				showCopyFileBtn();
			
			var ext_index = fname.lastIndexOf('.');
			if (ext_index == -1) {
				ext = null;
			} else {
            	ext = fname.substring(ext_index + 1);
            }
			if (isVidFile(ext)) {
                               var url = "https://labs.vocareum.com/web/1975667/890070/" + fpath;
                var str = '<video width="600px" controls> ' +
                          '<source id="video-viewer-modal-video" src="' + url + '" type="video/mp4">' +
                          'Your browser does not support HTML5 video. </video>';
                $('#video-viewer-modal-div').html(str);
                $('#video-viewer-modal').modal('show');
                return;
			} else if (isImgFile(ext)) {
                               $.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', userid: 1975667, asnid: 890069,  stepid:890070, data: fpath,version:0, vm:'34.209.4.84', labtype:1}, function(data) {
                    $('#image-viewer-modal-image').prop('src', data);
                    $('#image-viewer-modal').modal('show');
				});
                return;
			} else if (isOtherFile(ext)) {
    			    			$.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', userid: 1975667, asnid: 890069,  stepid:890070, data: fpath,version:0, vm:'34.209.4.84', labtype:1}, function(data) {
                    $('#other-viewer-modal-area').prop('data', data);
                    // set application type here
                    $('#other-viewer-modal').modal('show');
                });
                return;
			} else {
				// all other
			}
			
            if ((isBrowserViewableFile(ext) || ext == 'ipynb') && true) {
                $('#htmlreloadbtn').show();
                showHtmlFile(fpath);
            } else {
    			if (isBrowserViewableFile(ext)) {
    			    $('#fileviewbtn').show();
    			} else {
    			    $('#fileviewbtn').hide();
    			}
            }
			
			var codeFileChanged = true;
			
			if (editor.doc.isClean(editor_content_change)) codeFileChanged = false;
			if (vocIsFileReadOnly(viewer_last_fpath)) codeFileChanged = false;

			if (codeFileChanged) {
				voc_save(true, "Saving, please wait");
			}
			var codeComments = ( (typeof (rec.comments) !== 'undefined') ? rec.comments : '' );
			voc_get_s3_code(fpath, fname, 0, codeComments);
		}

		$('#tree1').on('selected', function (evt, data) {
		  if (data.info.length > 0 && data.info[0] !== null && data.info[0].type != 'folder' && $('#tree1').tree('selectedItems').length == 1) {
		    // if 1 folder & 1 file are selected and then file is unselected, then data.info[0] will be a folder
		    // so we need to check if data is a file and not a folder
  		  filetreeFileSelect(data.info[0]);
		  }
		  $('#trees3').find('.tree-selected').removeClass('tree-selected');
		  if ($('#tree1').tree('selectedItems').length > 1) {
    		$('#span_selectedfile').html('');
		    //$('#editor_current_file').html('');
        multiSelectShowHideBtns();
        // below: show appropriate buttons when an item is unselected
      } else if ($('#tree1').tree('selectedItems').length == 1) {
        if ($('#tree1').tree('selectedItems')[0].type == 'folder') {
          let relpath = $('#tree1').tree('selectedItems')[0].path.substring(2);
    			$('#input_filename').val(relpath + "/");
    			$('#span_selectedfile').html(relpath + "/");
    			//$('#editor_current_file').html('');
        }
        multiSelectShowHideBtns();
      } else {
        hideAllFileBtn();
        $('#downloadbtn').hide();
        //$('#editor_current_file').html('');
      }
		});

		$('.tree-folder-header').each(function(i, obj) {
			$val = $(this).data();
			if ($val['unfold'] == 1) {
				$(this).find('[class*="icon-"]:first-child').trigger('click');
				if ($val['name'] == 'work') {
				  $('#tree1').tree('selectFolder', obj);
				}
			}
		});

		// modes
		$( "#codebtn" ).click(function() {
  		});
 		$( "#actionsdropdown" ).click(function() {
  		});
  		
  		

		// MODE 1: E and C     E8 C4  XP
		// MODE 2: F and E	   F4 E12
		// MODE 3: E		   E12    XP
		
		// B1: M1 > M3
		// B2: M3 > M1
		
		// G1: M1 > M2
		//	   M3 > M2
		// G2: BACK TO M1 OR M3
		function changeEditorMode(modeFrom, modeTo) {
			switch (modeFrom) {
				case 1:
				break;
				case 2:
				break;
				case 3:
				break;
				default:
				break;
			}
			switch (modeTo) {
				case 1:
					$("#filelisting").removeClass('hide');
					$("#icon-folder").removeClass('icon-chevron-down');
					$("#icon-folder").addClass('icon-remove');
				
				break;
				case 2:
					$("#filelisting").addClass('hide');
					$("#icon-folder").removeClass('icon-remove');
					$("#icon-folder").addClass('icon-chevron-down');
				break;
				default:
				break;
			}
			current_mode = modeTo;
		}
		
        $( "#savebutton").click(function() {
				voc_save(true, "Saving");
        });


        function showDefaultEditorFile() {
            var default_file_rec = {
                    name: "",
                    path: "./work/" + "",
                    ee: 1
            }
            filetreeFileSelect(default_file_rec);
        }

       

  $('#input_filename').keydown(function(e) {
      if(e.keyCode == 13) {
          $('#filecreatebtn').trigger("click");
      }
  });
  

  

$('#video-viewer-modal').on('hidden.bs.modal', function (e) {
    $('#video-viewer-modal-div').html("");
})

			$( document ).ready(function() {

		$.extend($.gritter.options, {
			position: 'top-left'
		});
		
		
	                        $('.navbar').hide();
                   
                    
			});
	
			
  
  
  
  
                     
                          //
                          // If we have an embedded terminal, we want to execute the BUILD and RUN
                          // commands om the terminal (not batch) - among other things, it allows
                          // the run to be interactive
                          // Of course, BUILD does not need to be handled this way, but it's better
                          // to be consistent
                          //
                          function vcGetCmdStr(data)
                          {
                            var st = data.search(/@vocbegin@/);
                            var ed = data.search(/@vocend@/);
                            if(st>=0 && ed>=0 ) return data.substring(st+10, ed);
                            else                return '';
                          }
                          function doTerminalBuildRun($type)
                          {
                                                        if (($type == 'RUN') || ($type == 'BUILD'))
                            {
                              if (isSaveNeeded()) {
		                voc_save(false, "Saving");
		              }
                              if( save_in_progress ) {
                                // delay execution
                                window.setTimeout(function(){ doTerminalBuildRun($type); } , 300);
                                return true;
                              }
                              document.getElementById('terminalIframe').contentWindow.displayDataSimple(" [ Executing '" + $type + "'... ] " + String.fromCharCode(13) + "\n");
                              document.getElementById('terminalIframe').contentWindow.executeCommand(String.fromCharCode(21));
                              var whichfilepath = viewer_last_fpath;
                              if (!whichfilepath) whichfilepath = viewer_first_fpath;
                              filepathstr = getFilePathStr(whichfilepath, true);
                              // save the db data into a file - .voc{$type}.sh
                              var fileName = "/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work" + "/";
                              var jqxhr = $.ajax('../util/vcput.php?a=SaveDbScriptToFile'
                                               + '&asnid='+ 890070                                               + '&type=' + $type
                                               + '&mode=s'
                                               + '&version=0'
                                               + '&filename=' + fileName
                                               + filepathstr)
                                           .done(function(data, textStatus, jqXHR) {
                                             document.getElementById('terminalIframe').focus();
                                             document.getElementById('terminalIframe').contentWindow.executeCommand(vcGetCmdStr(data));
                                           })
                                           .fail(function(data, textStatus, jqXHR) {
                                             str = "Unexpected failure. Please contact support";
                                                                                          updateReportStatus($type, '<i class="icon-info"></i>Unexpected error');
                                                                                        });
                              
                              return true;
                            }
                            else
                            {
                              return false;
                            }
                                                        return false;
                          }


    $('#shellinput').keyup(function(e) {
        if(e.keyCode == 13) {
            $('#shellbutton').trigger("click");
        }
    });


    $(".editbutton").click(function() {
      editVers();
    });
    $(".viewbutton").click(function() {
      var type = $(this).data("command");
      setView(type);
    });
    $(".togglebutton").click(function() {
      var type = $(this).data("command");
      setView(type);
    });
    $(".appbutton").click(function() {
      var type = $(this).data("command");
      launchApp(type);
    });
    $(".appstopbutton").click(function() {
      stopApp();
    });
    $(".newtabviewbutton").click(function() {
      var type = $(this).data("command");
      setNewTabView(type);
    });
 
    $(".jupyterbutton").click(function() {
      var type = $(this).data("command");
      if (type == "launch")
      {
        setView(2);
      }
      else if (type == "release")
      {
        processNotebooks(type);
      }
      else if (type == "clear_output")
      {
        processNotebooks(type);
      }
    });

    $( ".commandbutton" ).click(function() {
	var $type = $(this).data("command");
        processThisCommand($type);
    });
    function processThisCommand($type){
	var filepath = viewer_last_fpath;
	if (!viewer_last_fpath) filepath = viewer_first_fpath;
	

        if (doTerminalBuildRun($type))
        {
                return;
        }
        
	if (isSaveNeeded()) {
		voc_save(true, "Saving");
	}
	executeThisCommand($type, filepath, true);
    }
    function executeThisCommand($type, filepath, isfirst)
    {
        if ( ($type=='RUN' || $type=='BUILD') && isfirst) { // activity icon only for RUN as of now
        	updateRunIcon($type, true);
        }

        if( save_in_progress ) {
          // delay execution
          window.setTimeout(function(){ executeThisCommand($type, filepath, false); } , 300);
          return;
        }
	var asyncCommand = false;
	var asyncPollUrl = null;
        var scheduleMode = false;
	if ($type=="Submission" || $type=="Grading" || $type=="RUN" || $type=='BUILD') {
		asyncCommand = true;
	}
        if ($type == "Grading") {
          scheduleMode = true;
        }
        var unencoded_filepath = filepath;
	filepath = encodeURIComponent(filepath);
				
        if (!asyncCommand) {
		$('#buildtextarea').html("<i class=\"icon-spin icon-spinner\"></i>&nbsp; Waiting for output ..");
	}
        // if the Asn Grading Rule is MAX, then we need to make sure we pass the correct rule (ontime/late) here
        // otherwise setting-grades-via-submission will not work
        
        var stepstr = "&stepid=890070" + "&auto_calc_grading=1";

        var filepathstr = "";
        if (($type == 'BUILD') || ($type == 'RUN')) {
          filepathstr = getFilePathStr(unencoded_filepath, true);
        }

        
        if ($type == 'SHELL') {
            var input = encodeURIComponent($('#shellinput').val());
            var url =  "../domains/common_submit.php?loc=3&id=890069&version=0&type="+$type+stepstr+"&input="+input+"&dryrun=1&useworkarea=1"+filepathstr;
        } else {
        
	      if ($type == "Grading") {
                var url = "../domains/common_submit.php?loc=6&id=12222088&version=0"+stepstr+"&type="+$type+filepathstr;
              } else {
                              var url = "../?&file0="+filepath+"&asnid=890069";
                            }
	      url += "&initiatorid=1975667"; // team projects: who performed the action
	      if (asyncCommand) {
	        asyncPollUrl = url + "&getstatus=1";
        	url = url + "&async=1";
              }
	      if (scheduleMode) {
        	url = url + "&scheduleMode=1";
              }
        } // else SHELL
                var msg = "Executing '" + $type + "' script...";
                if (!asyncCommand) {
                                    document.getElementById('terminalIframe').contentWindow.displayDataSimple(msg);
                                }
                $.post(url,{code0: ""},function(ret_val)
                {
                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                    refreshNewSessionPage();
                  }

                                      if ($type == 'Grading') {
                                            if (asyncCommand) {
                        reportsToOpen = true;
                        asyncCheckReportPeriodic($type, asyncPollUrl, false, false, maxPollTv, Math.floor(Date.now() / 1000));
                      }
                                            return;
                    }
                                    // show_voc_gritter(false, $type+" done", false);

                  data = ret_val;
                  if (!asyncCommand) {
                    if ($type=='RUN' || $type=='BUILD' ) { // activity icon only for RUN as of now
                      updateRunIcon($type, false);
                    }
                                      data = jQuery(data).text();
                    consolePrint(data);
                                    }

                  indicate_build_done();
                  build_in_progress = false;
                  
                  
                                        wasUnsubmitted = false;
                      if ($('#workunsubmitted').is(":visible")) {
                          wasUnsubmitted = true;
                      }
                                                          refreshFileTree(false, ($type != "Submission"));
                                             	  refreshSubTree();
                  	                        if (false && wasUnsubmitted) {
                          window.setTimeout(function(){ $('#workunsubmitted').show(); } , 500);
                      }
                                    
                  if (asyncCommand) {
                                            
                                                                                          consolePrint('Waiting for '+$type+' report');
                                                                                                      reportsToOpen = true;
                      var token = false;
                      var chksubmit = false;
                      var chkgrade = false;
                                            asyncCheckReportPeriodic($type, asyncPollUrl, chksubmit, chkgrade, maxPollTv, Math.floor(Date.now() / 1000));
                  }
                  
                });
						
		}

        var $gradesModal = $('#grades-modal'),
            $gradesIframe = $gradesModal.find('iframe'),
            $gradesSpinner = $gradesModal.find('#spinner');
				
        $gradesModal
            .on('show', function() {
                $gradesSpinner.removeClass('hidden-1');
                var url = 'main.php?m=grades_review&modalMode=1&asnId=890069&stepid=890070&userid=1975667';
                                                $gradesIframe.prop('src', url);
            });

        $gradesIframe.on('load', function() {
            $gradesSpinner.addClass('hidden-1');
        });

        function autoPeerReviewStart() {
          var data = "";
	  var urlval = '../util/vcprojapi.php?t=auto_peer_review_end_exam&type=peer_review&asnid=' + 890069 + '&userid=' + 1975667;
          $.ajax({
                 type: "POST",
                 url: urlval,
                 data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  console.log(ret_val + " Invalid session ");
                  // refreshNewSessionPage();
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.status !== 'success') {
                  show_voc_gritter(true, 'Peer review participation failed. <br>' + resp.message, true);
                } else {
                  $("#lisubmit").addClass('hidden');
                  show_peer_review_confirm_dialog = false;
                  $gradesModal.modal('show');
                }
            });
        }

        $('#gradesIdeBtn')
            .on('click', function() {
          var qstr = "Please make sure that you have submitted your work. You will not be allowed to make any more submissions once you start your participation in the peer review process. Are you sure you want to continue?";
          if (auto_peer_review_mode && show_peer_review_confirm_dialog)
          {
           bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              autoPeerReviewStart();
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
                   );
          }
          else
          {
            show_grades(advance_features, 0);
          }
        });

        function endExam() {
          var data = "";
	  var urlval = '../util/vcprojapi.php?t=auto_peer_review_end_exam&type=end_exam&asnid=' + 890069 + '&userid=' + 1975667;
          $.ajax({
                 type: "POST",
                 url: urlval,
                 data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  console.log(ret_val + " Invalid session ");
                  // refreshNewSessionPage();
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.status !== 'success') {
                  show_voc_gritter(true, 'End exam failed. <br>' + resp.message, true);
                } else {
                  $("#lisubmit").addClass('hidden');
                  $("#end-exam-group").addClass('hidden');
                  $("#examTimer").addClass('hidden');
                  show_voc_gritter(true, resp.message, true);
                }
            });
        }

        $('#endExamIdeBtn')
            .on('click', function() {
          var qstr = "Please make sure that you have submitted your work. You will not be allowed to make any more submissions once you end the exam. Are you sure you want to continue?";
          bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              endExam();
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        });
       var lastUpdateTime = 'Wednesday May 04 2022 16:17:36 GMT-0700 (PDT)';
       function syncAsnNow(tonew)
       {
           var d = new Date();
           lastUpdateTime = d.toString();
           $('#updatebtntext').html('<i class="icon-spin icon-spinner"></i>Update');
           var jqxhr = $.ajax('../util/vcput.php?a=syncAsn&stepid=890070'+(tonew? '&isnew=1' : ''))
                 .done(function(data, textStatus, jqXHR) {
                   var ap = data.indexOf('VOCERR::');
                   var bp = data.indexOf('::VOCERR');
                   if(ap>=0 && bp>=0 && bp>ap ){
                     show_voc_gritter(true, 'Update failed:' + data.substring(ap+8, bp), true);
                     $('#updatebtntext').html('Update*');
                   } else {
                     $('#updatebtntext').html('Update');
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   $('#updatebtntext').html('Update');
                 });
       }
       $('#awsbtn').click(function(){
         launchAws(awsscnt);
       });
       $('#c9btn').click(function(){
         launchC9();
       });
       $('#appsbtn').click(function(){
    	   launchAppStream();
         });
       function launchStudentView()
       {
    	   var newide = false;
    	   var appside = false;
    	   var awside = false;
    	   var stulabs = false;
    	   var appsallowed = false;
    	   var std2022ide = false;
    	   var tideUseContainer = false;
    	   
         $.ajax({
           url: '../util/vcput.php?a=resetStudentView&stepid=890070&version=0',
           type: 'get',
           success: function(data) {
               if ((appside || awside) && !std2022ide && !tideUseContainer) {
            	   window.open( "main.php?m=clabide&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0&hideNavBar=1");
               }
               else if ((stulabs || appsallowed) && !std2022ide  && !tideUseContainer) {
            	   window.open( "main.php?m=clabide&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0&hideNavBar=1");
               }
               else if ((newide) && !std2022ide  && !tideUseContainer) {
            	   window.open( "main.php?m=clabide&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0&hideNavBar=1");
               }
               else {
                 window.location = "main.php?m=editor&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0&hideNavBar=1";
               }
             //window.location = "main.php?m=editor&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0&hideNavBar=1";
           }
         });
       }
       function launchClabide()
       {
         $.ajax({
           url: '../util/vcput.php?a=resetStudentView&stepid=890070&version=0',
           type: 'get',
           success: function(data) {
        	   window.open( "main.php?m=clabide&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0");
             //window.location = "main.php?m=clabide&mode=s&asnid=890069&stepid=890070&ownerid=1975667&permit=7&tide=1&version=0";
           }
         });
       }
       var vcPartUpdated = 1;
       $('#studentviewbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
           if (vcPartUpdated != 0) {
             launchStudentViewUpdateWarning();
             return;
           }
           // maybe some other action udated it - like publich in a different window
           var jqxhr = $.ajax({
             type: "POST",
             url: '../util/vcput.php?a=checkForAsnUpdate',
             data: { partid: 890070 }
           })
           .done(function(data, textStatus, jqXHR) {
             try {
               var result = JSON.parse(data);
               if (result['status'] == 'Error') {
                 console.log("Error getting update check results: " + result['message']);
                 launchStudentViewUpdateWarning();
               }
               else {
                 if (result['updated'] == 0) {
                   bootbox.dialog('You must click the Update button at least once for the Student View to be available<br><br>',
                                  [{
                                    "label" : "Ok",
                                    "class" : "btn vocbtn-ac vocbtn-action"
                                  }]
                   );
                 }
                 else {
                   vcPartUpdated = 1;
                   launchStudentViewUpdateWarning();
                 }
               }
             }
             catch(err) {
               console.log("Exception getting update check results: " + err);
               launchStudentViewUpdateWarning();
             }
           })
           .fail(function(data, textStatus, jqXHR) {
             console.log("Failed getting update check results: " + err);
             launchStudentViewUpdateWarning();
           });
       });
       
       function launchStudentViewUpdateWarning() {
                    launchStudentView();
                }

       $('#clabidebtn').click(function(){
           if (isSaveNeeded()) { voc_save(true, "Saving");}
                        launchClabide();
                  });
       $('#teammemberbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
         window.location = "main.php?m=editor&asnid=890069&stepid=890070";
       });
       $('#teacherviewbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
         window.location = "main.php?m=editor&mode=t&asnid=890069&stepid=890070";
       });

       $('#merge_asn_btn').click(function() {
         var type = "merge";
         $('#' + type + '-output').hide();
         $('#' + type + '-ok').hide();
         $('#' + type + '-cancel').show();
         $('#' + type + '-action').show();
         $('#' + type + '-sel-course').trigger('change');
         $('#' + type + 'Assignment').css('height', 'auto');
         $('#' + type + 'Assignment').modal();
       });
       $("#merge-sel-course").change(function() {
         var type = "merge";
         $.post("../util/import_assignment.php",{courseid: $(this).val(), tgtbasnid: 890069, type: type, functionName: 'get_assignment_table'}, function(output) {
           output = JSON.parse(output);
           $('#' + type + '-table').html(output.tbldata);
         })
       });

       $('#merge-table').on('click', '.merge-modal-td-checkbox-all', function() {
         if (this.checked) {
           // check all checkboxes
           $(".merge-modal-td-checkbox-one").prop("checked", true);
           // $('#merge-table .merge-modal-td-checkbox-one').prop("checked", true);
         } else {
           // uncheck all
           $(".merge-modal-td-checkbox-one").prop("checked", false);
           // $('#merge-table .merge-modal-td-checkbox-one').prop("checked", false);
         }
       });

       var mergeAsnTimer;
       function showMergeAnsDots()
       {
         text = $('#merge-output').text();
         $('#merge-output').text(text + '.');
         mergeAsnTimer = setTimeout(showMergeAnsDots, 1000);
       }

       $('#merge-action').click(function() {
         // get the id's of all the selected assignments
         var basnids = [];
         $(".merge-modal-td-checkbox-one").each(function() {
           if (this.checked) {
             basnids.push(this.dataset.asnid);
           }
         });
         console.log(basnids);

         // if nothing selected, give an error and stay open
         if (basnids.length == 0) {
           bootbox.dialog("<br>No assignment selected. Please select at least one assignment to merge.",
                          [{
                            "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action"
                          }]
           );
         } else {
           $('#merge-ok').show();
           $('#merge-cancel').hide();
           $('#merge-action').hide();
           $('#merge-output').show();
           $('#merge-output').text("Merging assignment(s)...");
           mergeAsnTimer = setTimeout(showMergeAnsDots, 1000);

           var src_course = $("#merge-sel-course").val();
           // do the actual merge
           var jqxhr = $.ajax({
             type: "POST",
             url: '../util/vcput.php?a=mergeAssignments',
             data: { tgt_part: 890070, tgt_base: 890069, tgt_version: 0, src_course: src_course, asnuserid: 1975667, workarea: "/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",basnids: basnids }
           })
           .done(function(data, textStatus, jqXHR) {
             console.log(data);
             clearTimeout(mergeAsnTimer);
             try {
               var result = JSON.parse(data);
               if (result['status'] == 'Error') {
                 $('#merge-output').text("Error merging assignments: " + result['output']);
               }
               else {
                    $('#merge-output').text(result['output']);
                    $('#merge-output').animate({
                      scrollTop:$('#merge-output')[0].scrollHeight - $("#merge-output").height()
                    }, 1000);
               }
             }
             catch (err) {
               $('#merge-output').text("Exception merging assignments: " + err);
             }
           })
           .fail(function(data, textStatus, jqXHR) {
             clearTimeout(mergeAsnTimer);
             $('#merge-output').text("Error merging assignments");
           });
           
           //$('#mergeAssignment').modal("hide");
         }
       });
       
       $('#mergeAssignment').on('shown.bs.modal', function() {
         $('#merge-sel-course').chosen();
         $("#merge-sel-course").change();
       });

       function confirmCseVersion(started,verstr)
       {
         var actstr = '';
         var utime = lastUpdateTime;
         var qstr = 'Are you sure you want to update?<br>' + (utime==''? '' : 'Last updated: ' + utime + '<br>') + verstr;
         if(started){
           qstr += '<br><strong>NOTE:</strong> Some students have started the assignment. <br>';
         }
         bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              syncAsnNow(false);
                           }
                         },
                         {
                           "label" : "Cancel",
                           "class" : "btn vocbtn-ac vocbtn-status"
                         }]
                   );
       }
       function cseVersDesc(ver)
       {
          //'{.vocconfig' + ver.versiondata.vocconfig +
          //', lib' + ver.versiondata.lib +
          //', asnlib' + ver.versiondata.asnlib +
          //', scripts' + ver.versiondata.scripts +
          //', startercode' + ver.versiondata.startercode + '}';
         if(ver.versiondata.asnlib.length==0) return ' initial';
         else                                 return ver.versiondata.asnlib.replace('.', ' ');
       }
       function updateCseVersion(data, v)
       {
         var ver = false;
         var verstr = '';
         if( v ){
           try {
             ver = JSON.parse(v);
             if( !ver ||  !ver.hasOwnProperty('versiondata') ){
               ver = false;
             }
           } catch(e){
             ver = false;
             alert('error:' + v);
           }
         }
         if( ver ){ // there is a prior version
           verstr = '';//'Current version:' + cseVersDesc(ver) + '<br>';
         }
         //check if there is student who started the assignment
                var apos = data.search('started::');
         var bpos = data.search('::started');
         if(apos>=0 && bpos>=0 && bpos>apos && data.substring(apos+9, bpos)=='yes'){
           confirmCseVersion(true,verstr);
         } else
                {
           confirmCseVersion(false,verstr);
         }
         return false;
       }
       
       
       $('#quizModal_ok').click(function() {
           var multi_tab;
           var show_hints;
    	   $('#multi_tab').prop('checked') ? multi_tab = 1 : multi_tab = 0;
    	   $('#show_hints').prop('checked') ? show_hints = 1 : show_hints = 0;
    	   $('#quizModal').modal('hide');
    	   $('#quiztext').html('<i class="icon-spin icon-spinner"></i>Generate Quiz');
    	   $.when(generateQuiz(multi_tab, show_hints)).done(function(a1) {
    		   refreshFileTree(false, true);
    		   $('#quiztext').html('Generate Quiz');
    	   });
       });

       function generateQuiz(multi_tab, show_hints) {
		  return $.ajax('../util/vcput.php?a=generateQuizAjax'
	              + '&courseid='  + 54610	              + '&stepid='    + 890070	              + '&asnuserid=' + 1975667	              + '&multi_tab=' + multi_tab
	              + '&show_hints=' + show_hints)
	          .done(function(data, textStatus, jqXHR) {
	          	  console.log(data);
	              try {
		              // alert(data);
	            	  var result = JSON.parse(data);
                      if (result['status'] == 'Error') {
                    	  show_voc_gritter(false, "Error generating quiz: " + result['msg'], true);
                      } else {
                    	  show_voc_gritter(false, "Quiz successfully generated", false);
                      }
	              } catch(err) {
	                alert("Exception generating quiz: " + err);
	              }
	          })
	          .fail(function(data, textStatus, jqXHR) {
	          		alert("Error generating quiz");
	          });
		}
       
       var jupyterOnDemandClearOutputStr = "\
           <h3>Jupyter</h3>\
           <h6>\
             This will clear out all the output arrays in the selected notebook(s) and save the modified notebook(s) under new name(s); the original(s) will not be modified.\
           </h6>\
           <h6>\
             This is useful when notebook sizes get very large due to debug print statements and they take a long time to load.\
           </h6>\
       ";
       var jupyterAutoClearOutputStr = "\
           <h3>Jupyter</h3>\
           <h6>\
             At least one of your notebooks is very large; perhaps due to debug print statements in the outputs. If you are experiencing long load times, you can use choose to clear the output arrays from you notebooks(s).\
           </h6>\
           <h6>\
             The modified notebook(s) will be saved with new name(s); the original notebook(s) will not be modified.\
           </h6>\
       ";

       function showJupyterClearOutputModal(nbsWsz, type)
       {
         if (nbsWsz.length == 0)
         {
           alert("Jupyter: No notebooks found in the workarea");
           return;
         }

         var max_size_in_kb = 10 * 1000;
         var data = ''
                  + '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">'
         ;
         for (var i = 0; i < nbsWsz.length; i++)
         {
           nba = nbsWsz[i];
           data += '<tr id="jupyter_file_' + i + '">';

           sz = nba[1];
           if (sz > 1000)
           {
             sz = Math.round(sz / 1000);
             sz = sz + ' MB';
           }
           else
           {
             sz = sz + ' KB';
           }

           data += '<td class="jupyter-modal-td-file"><input id="jupyter_co_file_cb_' + i + '" class="span1 jupyter-modal-td-checkbox" type="checkbox" ';
           if (nba[1] >= max_size_in_kb)
           {
             data += 'checked>';
           }
           else
           {
             data += '>';
           }
           data += nba[0] + ' [' + sz + ']';
           data += '</td></tr>';
         }

         var str = "";
         if (type == 'auto')
         {
           str = jupyterAutoClearOutputStr;
         }
         else if (type == 'on_demand')
         {
           str = jupyterOnDemandClearOutputStr;
         }
         $('#jupyterClearOutputModal_header').html(str);
         $('#jupyterClearOutputModal_files').html(data);
         $('#jupyterClearOutputModal_ta').hide();
         $('#jupyterClearOutputModal_cancel').show();
         $('#jupyterClearOutputModal_co').show();
         $('#jupyterClearOutputModal_ok').hide();
         $("#jupyterClearOutputModal").css('height', 'auto');
         $('#jupyterClearOutputModal').modal();
       }

       var lastNotebookReleaseTime = '';
       function showJupyterReleaseModal(nbs, opts)
       {
         if (nbs.length == 0)
         {
           alert("Jupyter: No notebooks found in the workarea");
           return;
         }
         
         var releaseTimeText = '';
         if (lastNotebookReleaseTime) {
           releaseTimeText = 'Last released: ' + lastNotebookReleaseTime + '<br><br>';
         }

         var data = ''
                  + releaseTimeText
                  + 'Notebook(s) to be released:'
                  + '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">'
         ;
         for (var i = 0; i < nbs.length; i++)
         {
           data += '<tr id="jupyter_file_' + i + '">';
           data += '<td class="jupyter-modal-td-file"><input id="jupyter_file_cb_' + i + '" class="span1 jupyter-modal-td-checkbox" type="checkbox" checked>';
           data += nbs[i];
           data += '</td></tr>';
         }
         data += '</table>';
         data += '<br>';
         data += 'Options:';
         data += '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">';
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_extract_rubric" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['extractrubric'] === 'undefined') || (opts['extractrubric'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Extract rubric items from notebook(s)';
         data += '</td></tr>';

         
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_resource_link" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['createresourceLink'] === 'undefined') || (opts['createresourceLink'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Create resource link in Starter Code';
         data += '</td></tr>';
         data += '</table>';

         // Script Options:
         data += '</table>';
         data += '<br>';
         data += 'Script Options:';
         data += '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">';

         // Generate grading script
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_ow" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['owgrdscript'] === 'undefined') || (opts['owgrdscript'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Generate grading script';
         data += '</td></tr>';

         // Show traceback
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_traceback" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"';
         if (!opts || (typeof opts['tbgrdscript'] === 'undefined') || (opts['tbgrdscript'] == "1")) {
           data += ' checked ';
         }
         if (opts && (typeof opts['owgrdscript'] !== 'undefined') && (opts['owgrdscript'] == "0")) {
           data += ' disabled ';
         }
         data += '>';
         data += 'Show traceback for errors';
         data += '</td></tr>';

         // Show feedback (via html report)
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_feedback" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"';
         // default is unchecked
         if (opts && (typeof opts['fbgrdscript'] !== 'undefined') && (opts['fbgrdscript'] == "1")) {
           data += ' checked ';
         }
         if (opts && (typeof opts['owgrdscript'] !== 'undefined') && (opts['owgrdscript'] == "0")) {
           data += ' disabled ';
         }
         data += '>';
         data += 'Show html feedback report';
         data += '</td></tr>';

         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_embed_output" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['embedoutput'] === 'undefined') || (opts['embedoutput'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Display autograde test output in open notebook';
         data += '</td></tr>';

         data += '</table>';
         // Extensions
         data += '<br>';
         data += 'Extensions Enabled By Default:';
         data += '<div style="display: flex; flex-wrap: wrap;">';
         data += '<div style="margin: 5px;"><input class="jupyterExtensionCheckbox" id="toc2/main" style="margin-bottom: 6px; width: 20px;" type="checkbox">Table of Contents (2)</div>';         data += '</div>';

         $('#jupyterModal_files').html(data);

         $('#jupyterModal_ta').hide();
         $('#jupyterModal_ok').hide();
         $('#jupyterModal_cancel').show();
         $('#jupyterModal_release').show();

         $("#jupyterModal").css('height', 'auto');
         $('#jupyterModal').modal();
       }

       var releaseNotebooks = [];
       var notebooksWithSizes = [];
       function processNotebooks(type)
       {
         // get a list of notebooks
         releaseNotebooks = [];
         var jqxhr = $.ajax('../util/vcput.php?a=getNotebooksViaWebServer'
                          + '&courseid='  + 54610                          + '&basnid='    + 890069                          + '&stepid='    + 890070                          + '&asnuserid=' + 1975667                          + '&workarea='  + "/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work")
                      .done(function(data, textStatus, jqXHR) {
                        // console.log(data);
                        try {
             	          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error retrieving notebook list: " + result['msg'])
                          }
                          else {
                            var prev_options = null;
                            if (typeof result['options'] === 'undefined') {
                              console.log("Options not found");
                            } else {
                              console.log("Options: ");
                              console.log(result['options']);
                              prev_options = result['options'];
                            }
                            notebooksWithSizes = result['notebooks'];
                            for (i = 0; i < notebooksWithSizes.length; i++) {
                              nba = notebooksWithSizes[i];
                              releaseNotebooks.push(nba[0]);
                            }
                            if (type == "release")
                            {
                              showJupyterReleaseModal(releaseNotebooks, prev_options);
                              if (prev_options !== null && prev_options.hasOwnProperty('extensions')) {
                                prev_options['extensions'].forEach(ext => $('#' + ext.replace('/', '\\/')).prop('checked', true));
                              }
                            }
                            else if (type == "clear_output")
                            {
                              showJupyterClearOutputModal(notebooksWithSizes, 'on_demand');
                            }
                            else if (type == "notebook_size_check")
                            {
                              checkNotebookSize(notebooksWithSizes);
                            }
                          }
                        }
                        catch(err) {
                          alert("Exception retrieving notebook list: " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        alert("Error retrieving notebook list");
                      });
       }

       var jupyterModalDotTimer;

       function showJupyterModalDots()
       {
         text = $('#jupyterModal_ta').text();
         $('#jupyterModal_ta').text(text + '.');
         jupyterModalDotTimer = setTimeout(showJupyterModalDots, 1000);
       }

       $(document).on('change', '#jupyter_script_ow', function() {
         var val = this.checked ? false : true;
         $('#jupyter_script_traceback').prop("disabled", val);
         $('#jupyter_script_feedback').prop("disabled", val);
         $('#jupyter_embed_output').prop("disabled", val);;
       });

       function jupyterReleaseNotebooks()
       {
         if (releaseNotebooks.length == 0)
         {
           alert("No notebooks found");
           return;
         }
         nbsToRelease = [];
         for (var i = 0; i < releaseNotebooks.length; i++)
         {
           if ($('#jupyter_file_cb_' + i).prop('checked'))
           {
             nbsToRelease.push(releaseNotebooks[i]);
           }
         }
         if (nbsToRelease.length == 0)
         {
           alert("No notebook(s) selected for release");
           return;
         }

         var generateGradingScript = 0;
         if ($('#jupyter_script_ow').prop('checked'))
         {
           generateGradingScript = 1;
         }
         var extractRubric = 0;
         if ($('#jupyter_extract_rubric').prop('checked'))
         {
           extractRubric = 1;
         }
         var deleteRubric = 0;
         if ($('#jupyter_delete_rubric').prop('checked'))
         {
           deleteRubric = 1;
         }
         var createResourceLink = 0;
         if ($('#jupyter_script_resource_link').prop('checked'))
         {
           createResourceLink = 1;
         }
         var tracebackGradingScript = 0;
         if ($('#jupyter_script_traceback').prop('checked'))
         {
           tracebackGradingScript = 1;
         }
         var feedbackGradingScript = 0;
         if ($('#jupyter_script_feedback').prop('checked'))
         {
           feedbackGradingScript = 1;
         }
         var embedOutput = 0;
         if ($('#jupyter_embed_output').prop('checked'))
         {
           embedOutput = 1;
         }
         
         var checkedExtensions = [];
         $('input[class="jupyterExtensionCheckbox"]:checked').each(function() {
           checkedExtensions.push($(this).attr("id"));
         });

         ht = $('#jupyterModal').height();
         $('#jupyterModal_ok').show();
         $('#jupyterModal_cancel').hide();
         $('#jupyterModal_release').hide();
         $('#jupyterModal_ta').text("Releasing notebook(s).");
         $('#jupyterModal_ta').show();
         $("#jupyterModal").animate({ scrollTop: $('#jupyterModal').prop("scrollHeight")}, 1000);
         jupyterModalDotTimer = setTimeout(showJupyterModalDots, 500);

         var jqxhr = $.ajax({
           url: '../util/vcput.php?a=releaseNotebooks'
                + '&courseid='  + 54610                + '&basnid='    + 890069                + '&stepid='    + 890070                + '&asnuserid=' + 1975667                + '&workarea='  + "/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work"
                + '&notebooks='  + encodeURIComponent(nbsToRelease.join('_____'))
                + '&owgrdscript=' + generateGradingScript
                + '&extractrubric=' + extractRubric
                + '&createresourceLink=' + createResourceLink
                + '&deleterubric=' + deleteRubric
                + '&tbgrdscript=' + tracebackGradingScript
                + '&fbgrdscript=' + feedbackGradingScript
                + '&embedoutput=' + embedOutput,
           data: {
             extensions: checkedExtensions
           },
           type: 'POST'
         }).done(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterModalDotTimer);
                        console.log(data);
                        try {
                          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error releasing notebook(s): " + result['msg'])
                          }
                          else {
                            if ('release_time' in result) {
                              lastNotebookReleaseTime = new Date(result['release_time']*1000).toString();
                            }
                            $('#jupyterModal_ta').text(result['stdout']);
                            $("#jupyterModal_ta").animate({
                              scrollTop:$("#jupyterModal_ta")[0].scrollHeight - $("#jupyterModal_ta").height()
                            },1000);
                            $('#updatebtntext').html('Update*');
                          }
                        }
                        catch(err) {
                          alert("Exception releasing notebook(s): " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterModalDotTimer);
                        alert("Error releasing notebook(s)");
                      });
       }

       $('#jupyterModal_release').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(jupyterReleaseNotebooks, 500);
       });

       var jupyterClearOutputModalDotTimer;

       function showJupyterClearOutputModalDots()
       {
         text = $('#jupyterClearOutputModal_ta').text();
         $('#jupyterClearOutputModal_ta').text(text + '.');
         jupyterClearOutputModalDotTimer = setTimeout(showJupyterClearOutputModalDots, 1000);
       }


       function jupyterNotebookClearOutput()
       {
         if (releaseNotebooks.length == 0)
         {
           alert("No notebooks found");
           return;
         }
         nbsToClear = [];
         for (var i = 0; i < releaseNotebooks.length; i++)
         {
           if ($('#jupyter_co_file_cb_' + i).prop('checked'))
           {
             nbsToClear.push(releaseNotebooks[i]);
           }
         }
         if (nbsToClear.length == 0)
         {
           alert("No notebook(s) selected for clearing output");
           return;
         }

         $('#jupyterClearOutputModal_ta').text("Clearing output for notebook(s).");
         $('#jupyterClearOutputModal_ta').show();
         $('#jupyterClearOutputModal_ok').show();
         $('#jupyterClearOutputModal_co').hide();
         $('#jupyterClearOutputModal_cancel').hide();
         $("#jupyterClearOutputModal").animate({ scrollTop: $('#jupyterClearOutputModal').prop("scrollHeight")}, 1000);
         jupyterClearOutputModalDotTimer = setTimeout(showJupyterClearOutputModalDots, 500);

         var jqxhr = $.ajax('../util/vcput.php?a=notebookClearOutput'
                          + '&courseid='  + 54610                          + '&basnid='    + 890069                          + '&stepid='    + 890070                          + '&asnuserid=' + 1975667                          + '&workarea='  + "/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work"
                          + '&notebooks='  + nbsToClear.join('_____'))
                      .done(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterClearOutputModalDotTimer);
                        console.log(data);
                        try {
                          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error clearing output: " + result['msg'])
                          }
                          else {
                            $('#jupyterClearOutputModal_ta').text(result['stdout']);
                            $("#jupyterClearOutputModal_ta").animate({
                              scrollTop:$("#jupyterClearOutputModal_ta")[0].scrollHeight - $("#jupyterClearOutputModal_ta").height()
                            },1000);
                          }
                        }
                        catch(err) {
                          alert("Exception clearing output: " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterClearOutputModalDotTimer);
                        alert("Error clearing output");
                      });

       }

       $('#jupyterClearOutputModal_co').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(jupyterNotebookClearOutput, 500);
       });

       $('#clear_notebook_output').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(processNotebooks, 500, 'clear_output');
       });

                          function checkNotebookSize(nbsWsz)
                          {
                            var max_size_in_kb = 10 * 1000;
                            for (i = 0; i < nbsWsz.length; i++) {
                              nba = nbsWsz[i];
                              if (nba[1] >= max_size_in_kb)
                              {
                                showJupyterClearOutputModal(nbsWsz, 'auto');
                                return;
                              }
                            }
                          }
                          
	          $(document).ready(function() {
                                      });

       $('#updatebtn').click(function(){
         $.ajax({
           url: '../util/vcput.php?a=courseversion&stepid=890070',
           type: 'get',
           success: function(data) {
              var apos = data.search('voc::');
              var bpos = data.search('::voc');
              if(apos>=0 && bpos>=0 && bpos>apos){
                updateCseVersion(data, data.substring(apos+5, bpos));
              } else {
                updateCseVersion(data, data.substring(apos+5, bpos));
              }
            }
         });
       });
       $('#help-window' ).click(function(){
            if (!$('#jspanelWindow').length) {
		$.jsPanel({
			id: "jspanelWindow",
    			theme:    "light",
    			title:    "Instructions",
			addClass: {
				header: "voc-jpanel-header",
				content: "voc-jpanel-content",
			},
			position: { top: 130, right: "auto" },
			size: { width: 400, height: 500 },
			resizable: "disabled",
			content:  "<iframe src='../util/vcprojapi.php?vockey=XNq%2FfFNUfQ7fTY32Uz71Ew%3D%3D&t=gethelp&asnid=890069&version=0' width='100%' height='100%' style='' title='Help'></iframe>",
 			controls: { buttons: 'closeonly', iconfont: 'font-awesome' },
		});
	    }
        });
				
		});

/* turtle start */
/* turtle end */

function unescapeHtml(safe) {
    return safe.replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#039;/g, "'")
        .replace(/<br>/g, "");
}


/* we always get the str as htmlspecialchars from php - now print depends whether on terminal or console
 * to unescape html */
function consolePrint(str) {
    if ((typeof(str) === 'undefined') || (str == null)) {
      return;
    }
            str = unescapeHtml(str);
        str = str.replace(/VOC_NL/gm, "");
        str = str.replace(/^/gm, String.fromCharCode(13) + "    ");
        document.getElementById('terminalIframe').contentWindow.displayData(str);
    }

function widgetModalOutput(str) {
    $('#div-widgetoutput').html("<i class=\"icon-spin icon-spinner\"></i>&nbsp; Waiting for output ..");
    $('#modal-table-widgetoutput').modal('show');
    $('#div-widgetoutput').html(str);
}

var reportsToOpen = true;
function updateReportStatus(type, str) {
    var statusElem = '#'+type+'ReportStatus';
    $(statusElem).html(str);
    $(statusElem).show();

    if (!($('#reports').hasClass('open')) && reportsToOpen) {
        $('#reportsdropdown').trigger('click');
        reportsToOpen = false;
    }
}
function updateReportProgress(type, str) {
    var statusElem = '#'+type+'ReportProgress';
    if( str!='' ){
      $(statusElem).html(str);
      $(statusElem).show();
    } else {
      $(statusElem).hide();
    }
}
function updateReportReady(type, show) {
    var statusElem = '#'+type+'reportbutton';
    if( show ) $(statusElem).show();
    else       $(statusElem).hide();
}

function stopCheckReportTimeout(type) {
  if ($("body").data("timeout"+type) != null) {
    clearTimeout($("body").data("timeout"+type));
  }
}

function startCheckReportTimeout(type, url, chksubmit, chkgrade, tv, st) {
  stopCheckReportTimeout(type);
  timeoutVar = setTimeout(function() {
                 asyncCheckReportPeriodic(type, url, chksubmit, chkgrade, tv, st);
               }, 2000);
  $("body").data("timeout"+type, timeoutVar);
}

var waitingForReport = false;
var maxPollTv = 120; //3m
function asyncCheckReportPeriodic(type, url, chksubmit, chkgrade, tv, st) {
    var statusElem = '#'+type+'ReportStatus';
            if( tv>0 ){
          var elapsed = (Math.floor(Date.now() / 1000) - st);
                    if( true || type!='Submission' || chksubmit===0 ){
            updateReportStatus(type, '<i class="icon-spin icon-spinner"></i>waiting for report ' + elapsed + 's');
          }
        } else {
          waitingForReport = true;
          $("body").data("timeout"+type, null);
          updateReportStatus(type, 'Please come back and click here for the report ...');
          if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
            updateRunIcon(type, false);
          }
          return false;
        }
        if( tv <= (maxPollTv-10) ) { // after 10s
          if( tv>(maxPollTv-60) )  { // before 1m
            if( (tv % 10) != 0 ){
              startCheckReportTimeout(type, url, chksubmit, chkgrade, tv-2, st);
              return false;
            }
          } else if (tv>0){
            if( (tv % 30) != 0 ){
              startCheckReportTimeout(type, url, chksubmit, chkgrade, tv-2, st);
              return false;
            }
          }
        }
        tv -= 2;
        $.ajax({
            url: url,
            data: {},
            success: function(ret_val) {

                if (ret_val.indexOf('ERROR:INVALID_SESSION>') == 1) { // invalid session
                  refreshNewSessionPage();
                }

                try {
                  resp = jQuery.parseJSON(ret_val);
                } catch(err) {
                    show_voc_gritter(false, "Internal error: invalid json", true);
                    consolePrint('Internal error: invalid json');
                    if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
                      updateRunIcon(type, false);
                    }
                    return;
                }
                                if (resp.state != 2) {
                    startCheckReportTimeout(type, url, chksubmit, chkgrade, tv, st);
                } else {  // done
                    $("body").data("timeout"+type, null);
                    if ( (resp.status == 1) ||
                                (resp.status == 2) ) {
                        
                        if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
                                                    if(resp.status == 1){
                            show_voc_gritter(false, type + ' completed successfully', false);
                          } else {
                            show_voc_gritter(false, type + ' completed with errors', true);
                          }
                          updateRunIcon(type, false);
                                                  }
                                                                                                           reportsToOpen = true;
                               if( true ) {
                                 updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                               }
                               consolePrint(type + " Report:");
                               consolePrint(resp.output);
                                                        refreshFileTree(false, true);
                                                
                                                       reportsToOpen = true;
                               if( true ) {
                                 updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                                 if (type == 'Grading') {
                                   vcJupyterExtraGradingComplete();
                                 }
                                 //mhui
                                 var element =  document.getElementById('gradeframe');
                                 if (typeof(element) != 'undefined' && element != null && advance_features == 1)
                                 {
                                 	 $('#gradesIdeBtn').click();
                                 }
                               }
                                                
                    } else {
                        str = "Unexpected failure. Please contact support";
                                                    reportsToOpen = true;
                            updateReportStatus(type, '<i class="icon-info"></i>Unexpected error');
                                                        
                                            }
                    
                }
            }
    });
    
}


var submit_maxcount = -1;
var submit_count = 0;
var submit_in_progress = false;
var submission_open = 0;
var show_peer_review_confirm_dialog = 0;
var auto_peer_review_mode = 0;


function showSolutionAlert() {
          bootbox.dialog("You can now download the solution from the Actions drop-down menu",
                         [{
                           "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action"
                          }]
          );
}

function updateSubmitDetails(resp) {
    if( (typeof resp.data !== "undefined") && resp.data ) {
        var subData = resp.data;
        var str = "";
              str += '';
        str += '';
        str += '';
        str += '<tr><td>AWS:</td><td> <div  class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button" style="border:0px; line-height:17px !important"  onclick="showawsact(0);" id="showawsbtn">Show</div></td></tr>';
        str += '';
        if (str != '') {
            $('#subdetails').html(str);
        }
    }
}

  // if ($canSubmit)

function updateSubmitIcon(inprogress) {
    submit_in_progress = inprogress;
    if (inprogress) {
        $('#btn-submitasn').html('<i class="icon-spin icon-spinner"></i>Submitting</button>');
    } else {
        if ((submit_maxcount < 0) || (submit_count <= submit_maxcount) || (submission_open != 0)) {
            $('#btn-submitasn').html('Submit');
        } else {
            $('#btn-submitasn').hide();
        }
    }
}

function updateRunIcon(type, inprogress) {
    var btn = '#' + type + '-btn';
    var name = type=='RUN'? 'Run' : 'Build';
    if (inprogress) {
        $(btn).html('<i class="icon-spin icon-spinner"></i>' + name);
    } else {
        $(btn).html(name);
    }
}

		
		
	            function verifyResubmit(url, resubmit)
        {
          var str = "Are you sure you want to submit?";
          if(resubmit){
            str += '<br>Your earlier submission is still being processed. If you submit again, the previous submission may be terminated.';
          }
                      bootbox.dialog(str,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                             handleSubmitUpdate(url);
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
          return false;
        }

                  function checkAndVerifyResubmit(url) {
                                                            $.ajax({
                      url: "../util/vcput.php?a=chkResubmit&tv="+Date.now()+"&stepid=890070&version=0",
                    })
                     .done(function(ret_val) {
                       return verifyResubmit(url, ret_val.indexOf('status::progress')>=0);
                     })
                     .fail(function(ret_val) {
                       // procees to submit anyway
                       return verifyResubmit(url, false);
                     });
                                      }
                  
                  
        function confirmSubmitAsnBtn(url) {

                  

 				if (isSaveNeeded()) {
					voc_save(true, "Saving");
				}
                  checkAndVerifyResubmit(url);
        };
        function gotoTeam(pid, name)
        {
          bootbox.dialog('Are you sure you want to switch to the workarea owned by [' + name + ']?',
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                             window.location = "main.php?m=editor&asnid=890069&stepid=890070&ownerid="+pid+"&permit=7";
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        }
        function copyworkarea()
        {
          saveCBClipboard('work\/');
          return false;
        }
        function pasteworkarea()
        {
          pasteCB("Paste", 'work\/', '', "Paste successful", true);
          return false;
        }
        function confirmResetAsnBtn(url) {
          var str = 'Reset will delete all your content in the work area  and replace it with the starter code.<br><br>' +
                    '' +
                    'Are you sure you want to reset your work-area?';
                                    bootbox.dialog(str,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                                                            show_voc_gritter(true, ' Resetting work-area ...', true);
                                                          window.location = url;
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
              );
                              };
      

			if ($.cookie('buildtextareaData')) {
				$.removeCookie('buildtextareaData');
			}
			
      $(window).bind('beforeunload', function() {
          if (isSaveNeeded()) {
              voc_save(true, "Saving before you quit page, please wait");
              return 'Please wait till we save your unsaved changes';
          }
      });
      
      var vocClipboard = '';
      $(window).bind({
                copy : function(e){
                        var str = window.getSelection().toString();
                        if ((str == "") && e.target && e.target.value) {
                            console.log(e.target.value);
                            str = e.target.value;
                        }
                        vocClipboard = str.trim();
                        console.log('copied: ' + vocClipboard);
                }
      });

  // if we wanted to use the terminal but could not, print an error msg
  
  var vcChkSubmitFP = false;
  
  $( "#downloadbtn" ).click(function() {
  	if ($('#input_filename').val().startsWith("Submissions/")) {
  		var url = "../main/submissionurl.php?asnid=890070&mode=s&version=0&courseid=54610&userid=1975667&data=" + $('#input_filename').val();
  	} else {
  	    var paths = $('#tree1').tree('selectedItems').map(function (el) {
  	      var path = el.path.substring(2);
  	      if (el.type == 'folder') {
  	        path += '/';
  	      }
  	      return path;
  	    });
      	var filepath = "./" + $('#input_filename').val();
      	var url = "../domains/ide_src_zip.php?stepid=890070&mode=s&version=0&filepath=" + filepath;
  	}
  	$('#div-output-download_from_ide').html('');
  	$.ajax({
  	  url: url,
  	  type: 'post',
  	  data: {
  	    files: JSON.stringify(paths)
  	  },
  	  success: function(data) {
  	    $('#div-output-download_from_ide').html(data);
  	  }
  	});
    //$('#div-output-download_from_ide').html("<iframe src=\""+url+"\" width=\"100%\" height=\"100%\" title=\"Download\"></iframe>");
  });

  function getStudentReport(target, targetDiv, type, num) {
    var jqxhr = $.ajax('../util/vcput.php?a=getStudentReport'
                     + '&stepid='+ 890070                     + '&userid='+ 1975667                     + '&type=' + type
                     + '&version=0'
                     + '&num=' + num)
                 .done(function(data, textStatus, jqXHR) {
                   // alert(data);
                   target.innerHTML = data;
                   targetDiv.scrollTop = targetDiv.scrollHeight;
                               if( waitingForReport && data.search(/Executed/)>=0 ){
                     waitingForReport = false;
                     if( true ) {
                       updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                     }
                     consolePrint(data);
                   }
                             })
                 .fail(function(data, textStatus, jqXHR) {
                   target.innerHTML = "<p>No " + type + " Report has been generated<p>";
                   targetDiv.scrollTop = targetDiv.scrollHeight;
                 });
  }
  
  function showStudentReportHtml(modalHtml, iframeHtml, iframeTitle, type, fileName)
  {
     var url = "../web/1975667/890070/work/" + fileName;
     iframeTitle.html(type + " Report");
     iframeHtml.attr("src", url);
     modalHtml.modal('show');
  }
  
  function showStudentReportText(modalDiv, target, targetDiv, text)
  {
     modalDiv.modal('show');
     str = text.replace(/(?:\r\n|\r|\n)/g, '<br />');
     target.innerHTML = str;
     targetDiv.scrollTop = targetDiv.scrollHeight;
  }
  
  function showStudentReport(modalDiv, target, targetDiv, modalHtml, iframeHtml, iframeTitle, type, num) {
    var jqxhr = $.ajax('../util/vcput.php?a=showStudentReport'
                     + '&stepid='+ 890070                     + '&userid='+ 1975667                     + '&type=' + type
                     + '&work=' + "/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work"
                     + ''                     + '&version=0'
                     + '&num=' + num)
                 .done(function(data, textStatus, jqXHR) {
                   try {
                     var result = JSON.parse(data);
                     if (result['status'] == 'Error') {
                       showStudentReportText(modalDiv, target, targetDiv, result['msg']);
                     } else {
                       if (result['msg']) {
                         showStudentReportText(modalDiv, target, targetDiv, result['msg']);
                       } else if (result['fileType'] == "text") {
                         showStudentReportText(modalDiv, target, targetDiv, result['reportFile']);
                       } else {
                         showStudentReportHtml(modalHtml, iframeHtml, iframeTitle, type, result['reportFileName']);
                       }
                     }
                   }
                   catch (e) {
                     showStudentReportText(modalDiv, target, targetDiv, 'Parse error getting student report: ' + e);
                   }
                               if (waitingForReport) {
                     waitingForReport = false;
                     if( true ) {
                       updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                     }
                     consolePrint(data);
                   }
                             })
                  .fail(function(data, textStatus, jqXHR) {
                    showStudentReportText(modalDiv, target, targetDiv, "<p>No " + type + " Report has been generated<p>");
                 });
  }

  function showrep(grading)
  {
    var name, type;
    if(grading) {
      name = 'grading';
      type = 'Grading';
    } else {
      name = 'submission';
      type = 'Submission';
    }
    var target = document.getElementById("report_" + name + "_msg_box");
    var targetDiv = document.getElementById("report_" + name + "_div");

    // if course has new flag set
          $('#modal-table-report-all-html-iframe').attr("src", "");
      showStudentReport($('#modal-table-report-' + name), target, targetDiv,
                        $('#modal-table-report-all-html'), $('#modal-table-report-all-html-iframe'),
                        $('#modal-table-report-all-html-title'), type, 0);
      }
  $('#gradingreportbutton').click(function(e) {
    showrep(1);
    e.preventDefault();// prevent the default anchor functionality
  });
  
  $('#submissionreportbutton').click(function(e) {
    showrep(0);
    e.preventDefault();// prevent the default anchor functionality
  });

  $('#runreportbutton').click(function(e) {
    var target = document.getElementById("report_run_msg_box");
    var targetDiv = document.getElementById("report_run_div");

    $('#modal-table-report-run').modal('show');
    getStudentReport(target, targetDiv, 'RUN', 0);

    e.preventDefault();// prevent the default anchor functionality
  });
  $('#buildreportbutton').click(function(e) {
    var target = document.getElementById("report_build_msg_box");
    var targetDiv = document.getElementById("report_build_div");

    $('#modal-table-report-build').modal('show');
    getStudentReport(target, targetDiv, 'BUILD', 0);

    e.preventDefault();// prevent the default anchor functionality
  });

  var dottyTimeout;
  var jupyterHtmlStyle = 'style="text-align:left; margin-left: 10px; padding-top:10px"';

  function vcLogJupyterError(jid, msg, ip, url)
  {
    var jqxhr = $.ajax({
      type: 'POST',
      url: '../util/vcput.php',
      data: { a: 'logJupyterError', msg: msg, jid: jid, ip: ip, url: url }
    })
    .done(function(data, textStatus, jqXHR) {
       // all done
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      // if the error logging itself failed, don't know what else to do...
    });
  }
  
  function editVers()
  {
    $('#modal-edit-vers').modal('show');
  }
  function setView(type) {
        name = "vocview_1975667_890070_s";
    str = name + "=" + type + "; path=/";
    // if this cookie is already set with the same value as "type", nothing to do
    var re = new RegExp(name + '=(\\w*)');
    allcookies = document.cookie;
    var matches = allcookies.match(re);
    if (matches && (matches.length > 1) && (matches[1] == type))
    {
      return;
    }
    document.cookie = str;
    location.reload();
  }

  function setNewTabView(type)
  {
    var loc = "main.php?m=editor&asnid=890069&stepid=890070&hideNavBar=1" + '&force_idetype=' + type + '&force_noreadme=1';
    window.open(loc);
  }

  function openAppWindow(loc)
  {
    window.open(loc);
  }

  function getXstartupFileName(type)
  {
    switch (type) {
              case 0: return "xstartup.test";
              case 1: return "xstartup.eclipse";
              case 2: return "xstartup.mysqlwb";
              case 5: return "xstartup.pgadmin";
              case 3: return "xstartup.spyder3";
              case 4: return "xstartup.desktop";
              case 6: return "xstartup.android-studio";
              case 11: return "xstartup.thonny";
              default: return "xstartup.desktop";
    }
  }

  var vocLaunchingApp = false;
  function vocLaunchTimer()
  {
    vocLaunchingApp = false;
  }
  
  function launchApp(type)
  {
    $('#app_spinbox_' + type).show();

    if (vocLaunchingApp == true) {
      return;
    }
    vocLaunchingApp = true;
    setTimeout(vocLaunchTimer, 5000);

    xstartup_file = '/home/lib/ubuntu1604/vdi/xstartup_files/' + getXstartupFileName(type);
    data = { 'action': 'Launch', 'token': '114828974619756671975667890070016280fd90e03961.58076310', 'proxy_path': 'proxy.vocareum.com/hostip/172.31.27.250:5000/vocproxy/110056375719756671975667890070016280fd90b115c3.55177772', 'proxy_scheme': 'https', 'xstartup_file': xstartup_file };

    var jqxhr = $.ajax({
      type: 'POST',
      url: "https://proxy.vocareum.com/hostip/172.31.27.250:9000/",
      data: JSON.stringify(data)
    })
    .done(function(data, textStatus, jqXHR) {
       $('#app_spinbox_' + type).hide();
       console.log(data);
       if (data['status'] == 'Error') {
         alert("VDI: Error: " + data['msg'])
       }
       else {
         // alert("location = " + data['location']);
         window.setTimeout(function() { openAppWindow(data['location']); } , 1000);
       }
       $('#actionsdropdown_liactions2').parent().removeClass('open');
       clearTimeout(vocLaunchTimer);
       vocLaunchingApp = false;
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      $('#app_spinbox_' + type).hide();
      alert("VDI: Launch Failed");
      $('#actionsdropdown_liactions2').parent().removeClass('open');
      clearTimeout(vocLaunchTimer);
      vocLaunchingApp = false;
    });
  }

  function stopApp()
  {
    $('#app_spinbox_stop').show();

    data = { 'action': 'Stop', 'token': '114828974619756671975667890070016280fd90e03961.58076310' }

    var jqxhr = $.ajax({
      type: 'POST',
      url: "https://proxy.vocareum.com/hostip/172.31.27.250:9000/",
      data: JSON.stringify(data)
    })
    .done(function(data, textStatus, jqXHR) {
       $('#app_spinbox_stop').hide();
       console.log(data);
       if (data['status'] == 'Error') {
         alert("VDI: Error: " + data['msg'])
       }
       $('#actionsdropdown_liactions2').parent().removeClass('open');
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      $('#app_spinbox_stop').hide();
      $('#actionsdropdown_liactions2').parent().removeClass('open');
    });
  }

  function vcJupyterExtraNewSubmission()
  {
    // if this is jupyter and we're embedding output, need to clear it on a new submission
      }

  function vcJupyterExtraGradingComplete()
  {
    // if this is jupyter and we're embedding output, tell jupyter to do it's thing
      }

  // called by jupyter if it needs to show something in an opened notebook
  function vocareum_be_getOutputData(notebookName)
  {
      }                  

  $("#justdoit").click(function() {
    vcJupyterExtraGradingComplete();
    return;
  });

  function dotty()
  {
    val = $('#jupyterIframeParent').text();
    $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >' + val + '. </p>');
    dottyTimeout = setTimeout(dotty, 1000);
  }
  function startDotty(type)
  {
    $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >Loading ' + type +' server' + ' </p>');
    dottyTimeout = setTimeout(dotty, 1000);
  }
  function stopDotty()
  {
    clearTimeout(dottyTimeout);
  }
  function launchRStudio()
  {
     return false;
  }
  function launchAws(v)
  {
     if( v===0 ){
       bootbox.dialog("<br>Your lab has not started yet. Please click StartLab in order to access AWS console",
                       [{
                         "label" : "Ok",
                         "class" : "btn vocbtn-ac vocbtn-action"
                       }]
                  );
       return;
     }
     var tv = v<0? '' : ('&tv=' + v);
     $.ajax({
              url: "../util/vcput.php?vockey=XNq%2FfFNUfQ7fTY32Uz71Ew%3D%3D&a=getawsurl"+tv+"&asnid=890070&userid=1975667&mode=s&version=0",
              data: {},
              success: function(data) {
                 var apos = data.search('voc::');
                 var bpos = data.search('::voc');
                 if(apos>=0 && bpos>=0 && bpos>apos){
                   if( data.search('voc::Error:')>=0 ){
                     consolePrint(data.substring(apos+5,bpos) + ' -- failed to launch AWS Console');
                   } else {
                     window.open(data.substring(apos+5,bpos), "JONAS LUCAS DUARTE LIMA");
                   }
                 } else {
                   consolePrint('Failed to launch AWS Console');
                 }
              }
           });

  }
  function launchC9()
  {
     $.ajax({
        url: "../util/vcput.php?vockey=XNq%2FfFNUfQ7fTY32Uz71Ew%3D%3D&a=getawsc9&asnid=890070&userid=1975667&mode=s&version=0",
        data: {},
        success: function(data) {
           var apos = data.search('voc::');
           var bpos = data.search('::voc');
           if(apos>=0 && bpos>=0 && bpos>apos){
             if( data.search('voc::Error:')>=0 ){
               consolePrint(data.substring(apos+5,bpos) + ' -- failed to launch Cloud9 Console');
             } else {
               window.open(data.substring(apos+5,bpos), "JONAS LUCAS DUARTE LIMA");
             }
           } else {
             consolePrint('Failed to launch Cloud9 Console');
           }
        }
     });
  }
  
  function launchAppStream()
  {
    return false;
  }
  
  function launchJupyter()
  {
    
    return false;
  }


  function vocCheckJupyterConsistency(username)
  {
    jif = document.getElementById('jupyterIframe');
    if (jif)
    {
      cw = jif.contentWindow;
      if (cw)
      {
        if (typeof(cw.vocExtGetUniqUserName) === typeof(Function))
        {
          name = cw.vocExtGetUniqUserName();
          if ((name != 'unset') && (name != username))
          {
            console.log("VOC name check: " + name + " :: " + username);
            window.location.replace($('#breadcrumb').find('a').attr("href") + "&w=Jupyter+session+closed");
          }
        }
      }
    }
    setTimeout(vocCheckJupyterConsistency, 1000, username);
  }


                  

  var vocPanelTerminalTryMax = 20; // 10s

  function vocTerminalTabTimeout(el, vm, counter)
  {
    if (el.contentWindow.tabReadyForCmd(vm['name']))
    {
      el.contentWindow.executeCommandOnTab(vm['name'], 'exec ' + vm['ssh_cmd']);
      return;
    }
    counter += 1;
    if (counter <= vocPanelTerminalTryMax)
    {
      setTimeout(vocTerminalTabTimeout, 500, el, vm, counter);
    }
    else
    {
      alert("Could not open new tab in terminal");
    }
  }

  function vocTerminalTimeoutInternal(el, vm, isNewWin)
  {
    if (isNewWin)
    {
      el.contentWindow.setTabTitle(0, vm['name']);
      el.contentWindow.executeCommand('exec ' + vm['ssh_cmd']);
    }
    else
    {
      if (el.contentWindow.createTabIfNoneExists(vm['name']) == true)
      {
        // so a new tab is being created - we need to wait for it
        // no need for else clause - coz the above call will focus on the correct tab
        setTimeout(vocTerminalTabTimeout, 500, el, vm, 0);
      }
    }
  }

  function vocTerminalTimeout(el, vm, isNewWin, counter)
  { 
     try 
     {
       if (el.contentWindow.vocTerminalIsAvailable())
       {
         setTimeout(vocTerminalTimeoutInternal, 500, el, vm, isNewWin);
         return;
       }
     }
     catch(err)
     {
       // nothing to do - we'll just try again
     }

     counter += 1;
     if (counter <= vocPanelTerminalTryMax)
     {
       setTimeout(vocTerminalTimeout, 500, el, vm, isNewWin, counter);
     }
     else
     {
       alert("Could not start terminal");
     }
  }
                  
  $('.vmtoolbarbtn').click(function(e) 
  {
    
    var vm_indx = e.target.dataset.indx;
    var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work" + '&novnc=1' + '&vm_indx=' + vm_indx)
      .done(function(data, textStatus, jqXHR)
      {
        try 
        {
          var result = JSON.parse(data);
          if (result['status'] == 'Error')
          {
             show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);
          }
          else
          {
            state = result['lab_state'];

            // get the appropriate container/vm
            vm = result['vms'][vm_indx];
            state = vm['state'];
                    
            if (state != "Ready")
            {
              bootbox.dialog("This machine is not in Ready state; please launch it before attempting to access it.", 
                             [{
                               "label" : "Ok",
                               "class" : "btn vocbtn-ac vocbtn-action",
                             }]
              );
            }
            else
            {
              if ((typeof vm['novnc_proxy'] !== "undefined") && vm['novnc_proxy']) 
              {
                $('#panel2Iframe').attr("src", vm['novnc_proxy']);
              }
              else if ((typeof vm['ssh_cmd'] !== "undefined") && vm['ssh_cmd']) 
              {
                console.log(vm);
                console.log(result);

                // Three cases:
                // 
                // 1. no terminal has ever been launched
                //    - start terminal
                //    - ssh cntnr
                // 2. terminal disappeared
                //    - "press" the launch button
                //    - ssh cntnr
                // 3. terminal is present
                //    - check if tab for this vm is already there
                //      - if so, select it
                //      - if not, open a new tab and ssh cntnr

                var isNewWin = true;
                const termExp = /\/terminal\//;
                var telement = document.getElementById('panel2Iframe');
                if ($('#panel2Iframe').attr("src") == "")
                {
                  $('#panel2Iframe').attr("src", "https://proxy.vocareum.com/hostip/172.31.27.250:3000/terminal/?uid=1975667&token=298b9cb1e1614e5787338ac9088c3032");
                }
                else if (termExp.test($('#panel2Iframe').attr("src")) === false)
                {
                  $('#panel2Iframe').attr("src", "https://proxy.vocareum.com/hostip/172.31.27.250:3000/terminal/?uid=1975667&token=298b9cb1e1614e5787338ac9088c3032");
                }
                else if (! telement.contentWindow.vocTerminalIsAvailable())
                {
                  console.log("voc-start-term");
                  telement.contentWindow.vocStartTerminal();
                }
                else
                {
                  isNewWin = false;
                }
                setTimeout(vocTerminalTimeout, 500, telement, vm, isNewWin, 0);
              }
              else if ((typeof vm['err'] !== "undefined") && vm['err'])
              {
                bootbox.dialog("Unable to access:  " + vm['err'], 
                               [{
                                 "label" : "Ok",
                                 "class" : "btn vocbtn-ac vocbtn-action",
                               }]
                );                      
              }
            }
          }
        }
        catch(err)
        {
          console.log("Exception: " + err);
          show_voc_gritter(false, "Could not get lab1 information", true);
        }
      })
      .fail(function(data, textStatus, jqXHR)
      {
        show_voc_gritter(false, "Could not get lab2 information", true);
      });
  });

                  function reallyResetClab()
                  {
                    show_voc_gritter_duration(true, "Resetting lab...", true, 15);
                    $.ajax({
                      url: "../util/vcput.php?a=resetclabsblocking&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
                    })
                     .done(function(ret_val) {
                       $.gritter.removeAll();
                       // wait for "None" state - when we have the new container-server flow (and don't use blocking above)
                       // setTimeout(waitForNoneState, 5000, "endResetClab");
                       setTimeout(show_voc_gritter, 1000, false, "Lab Reset Done", false);
                     })
                     .fail(function(ret_val) {
                       $.gritter.removeAll();
                       setTimeout(show_voc_gritter, 1000, false, "Reset failed", true);
                     });
                  }

                  function resetclabs()
                  {
                    $.ajax({
                      url: "../util/vcput.php?a=vcGetLabInfo&stepid=890070&version=0&labworkdir=/mnt/vocwork5/ddd_v1_w_RsM_1234414/asn890069_1/asn890070_1/work",
                    })
                     .done(function(data) {
                       try {
                         var result = JSON.parse(data);
                         if (result['status'] == 'Error') {
                           show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);
                         }
                         else {
                           state = result['lab_state'];
                           if (state == "Ready") {
                             bootbox.dialog("The lab cannot be reset while it is running; please end the lab before proceeding.", 
                                            [{
                                              "label" : "Ok",
                                              "class" : "btn vocbtn-ac vocbtn-action",
                                            }]
                             );
                           }
                           else {
                             reallyResetClab();
                           }
                         }
                       } catch(err) {
                         show_voc_gritter(false, "Could not get lab1 information", true);
                       }
                     })
                     .fail(function(data, textStatus, jqXHR) {
                       show_voc_gritter(false, "Could not get lab2 information", true);
                     });
                    
                    return;
                  }

                  function confirmLabReset()
                  {
                    bootbox.dialog("The operation will remove all host-mounted writeable data stores (such as databases).<br><br>Press Ok to continue or Cancel to abort.", 
                               [
                                 {
                                   "label" : "Ok",
                                   "class" : "btn vocbtn-ac vocbtn-action",
                                   "callback": function() {
                                     resetclabs();
                                   }
                                 },
                                 {
                                   "label" : "Cancel",
                                   "class" : "btn vocbtn-ac vocbtn-status"
                                 }                                   
                               ]
                    );
                  }

        function useSlipDays() {
          var data = "";
          var urlval = "../util/vcput.php?m=editor&vocajax=1&stepid=" + 890070 + "&a=useMySlipDays&caller=ide&ajaxData=1&q1=asnid=" + 890069;
          $.ajax({
           type: "POST",
           url: urlval,
           data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  refreshNewSessionPage();                                    
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.success !== 'true') {
                    show_voc_gritter(true, 'Failed: ' + resp.msg, true);
                } else {
                // success
                    if( (typeof resp.msg !== "undefined") && resp.msg ) {
                      show_voc_gritter(true, 'Failed: ' + resp.msg, true);
                    } else {
                      show_voc_gritter(false, resp.ret_arg1 + ' slip day(s) used', false);
                    }
                }       
                return false;   
            })
            .fail(function(ret_val) {
                    show_voc_gritter(false, ' Operation failed. Please try again', true);
                    return false;
            });
        }

        $('#useSlipDays').click(function() {
          var str = "Are you sure you want to use slip days for your submission?";
          bootbox.dialog(str, 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                               useSlipDays();
                           }
                         }, 
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        });

        var wcClusterSshCmd = "";

        function showclusteract(display)
        {
                  var jqxhr = $.ajax('../util/vcput.php?a=clusterInfo'
                                   + '&courseid='+ 54610                                   + '&asnid='+ 890069                      
                                   + '&stepid='+ 890070                                   + '&userid='+ 1975667                                   + '&asnuserid='+ 0)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Could not get cluster information: " + result['msg'], true);
                                         }
                                         else
                                         {
                                           var state_status = result['cluster_state'];
                                           if ((result['cluster_status'] !== undefined) && (result['cluster_status'] != 'Ok'))
                                           {
                                             state_status = state_status + ' (' + result['cluster_status'] + ')';
                                           }
                                           if ((result['cluster_ssh_cmd'] !== undefined) && (result['cluster_ssh_cmd'] != ''))
                                           {
                                             wcClusterSshCmd = result['cluster_ssh_cmd'];
                                           }
                                           if (display == true)
                                           {
                                             var target = document.getElementById("report_cluster_msg_box");
                                             target.innerHTML = "<strong>Status: </strong>" + state_status + "<br>"
                                                              + "<strong>Cluster IP: </strong>" + result['cluster_ip'] + "<br>"
                                                              + "<strong>SSH Cmd: </strong>" + wcClusterSshCmd;
                                             $('#modal-table-report-cluster').modal('show');
                                           }
				         }
                                       }
                                       catch(err)
                                       {
                                         show_voc_gritter(false, "Could not get cluster1 information", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR)
                                     {
                                       show_voc_gritter(false, "Could not get cluster2 information", true);
                                     });
                      
        }
                  
        $('#clusterStartOld').click(function()
        {
                    var jqxhr = $.ajax('../util/vcput.php?a=clusterStartOld'
                                       + '&courseid='+ 54610                                       + '&asnid='+ 890069                      
                                       + '&stepid='+ 890070                                       + '&userid='+ 1975667                                       + '&asnuserid='+ 1975667)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Could not start cluster: " + result['msg'], true);
                                         }
                                         else
                                         {
                                           // ok - got some information back...
                                           msg = "Unknown";
                                           switch (result['state'])
                                           {
                                             case null:
                                             case "Unknown":
                                               msg = "Launching a new cluster; this operation will take a few minutes.";
                                               break;
                                             case "Launching":
                                               msg = "A new cluster is currently being launched.";
                                               break;
                                             case "Starting":
                                               msg = "A new cluster is currently being started.";
                                               break;
                                             case "Stopped":
                                             case "Stopping":
                                               msg = "The cluster is being restarted.";
                                               break;
                                             case "Running":
                                               msg = "The cluster is already running.";
                                               break;
                                             case "Failed":
                                               msg = "The cluster is in failed state; please contact Vocareum Technical Support to resolve this.";
                                               break;
                                           }
                                           bootbox.dialog(msg, 
                                                          [{
                                                            "label" : "Ok",
                                                            "class" : "btn vocbtn-ac vocbtn-action",
                                                          }]);
                                         }
				       }
                                       catch(err)
                                       {
                                         show_voc_gritter(false, "Starting of cluster1 failed", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR)
                                     {
                                       show_voc_gritter(false, "Starting of cluster2 failed", true);
                                     });
                      
                  }
                  );

                  var clusterState = "Unknown";
                  var clusterStatus = "Unknown";
                  var clusterExtIp = "Unknown";
                  var clusterLaunchTimeAvg = 0;
                  var clusterRestartTimeAvg = 0;
                  var clusterActionTimeElapsed = 0;

                  $('#clusterdropdown').on('click', function (event) {
                    $('#clusterState').html("<i class='icon-info-sign' style='margin-right:5px'></i>" + "State: Retrieving...");
                    getClusterState();
                  });
                  function getClusterState()
                  {
                    var jqxhr = $.ajax('../util/vcput.php?a=getClusterState'
                                       + '&courseid='+ 54610                                       + '&stepid='+ 890070                                       + '&userid='+ 1975667)
                                 .done(function(data, textStatus, jqXHR)
                                   {
                                     try 
                                     {
				       var result = JSON.parse(data);
                                       if (result['status'] == 'Error') 
                                       {
                                         show_voc_gritter(false, "Could not get cluster state: " + result['msg'], true);
                                       }
                                       else 
                                       {
                                         clusterState = result['cluster_state'];
                                         clusterStatus = result['cluster_status'];
                                         clusterExtIp = result['cluster_ext_ip'];

                                         clusterLaunchTimeAvg = result['cluster_launch_avg'];
                                         clusterRestartTimeAvg = result['cluster_restart_avg'];
                                         clusterActionTimeElapsed = result['cluster_action_time_elapsed'];

                                         showClusterState = clusterState;
                                         if (result['cluster_status'] == "Error") {
                                           showClusterState += " (Error)";
                                         }
                                         if (clusterState == "None") {
                                           showClusterState = 'Not launched';
                                         }
                                         else if (clusterState == "Ready") {
                                           wcClusterSshCmd = '';
                                           showclusteract(false);
                                         }
                                         $('#clusterState').html("<i class='icon-info-sign' style='margin-right:5px'></i>" + "State: " + showClusterState);
				       }
                                     }
                                     catch(err) 
                                     {
                                       show_voc_gritter(false, "Could not get cluster state1", true);
                                     }
                                   })
                                 .fail(function(data, textStatus, jqXHR)
                                   {
                                     show_voc_gritter(false, "Could not get cluster state2", true);
                                   });
  		  }	
                  
                  function changeClusterState(ctrlState)
                  {
                    var jqxhr = $.ajax('../util/vcput.php?a=changeClusterState'
                                     + '&courseid='+ 54610                                     + '&stepid='+ 890070                                     + '&userid='+ 1975667                                     + '&ctrlstate=' + ctrlState)
                                 .done(function(data, textStatus, jqXHR)
                                   {
                                     try 
                                     {
				       var result = JSON.parse(data);
                                       if (result['status'] == 'Error') 
                                       {
                                         show_voc_gritter(false, "Could not change cluster state: " + result['msg'], true);
                                       }
                                     }
                                     catch(err) 
                                     {
                                       show_voc_gritter(false, "Could not change cluster state1", true);
                                     }
                                   })
                                 .fail(function(data, textStatus, jqXHR)
                                   {
                                     show_voc_gritter(false, "Could not change cluster state2", true);
                                   });
                  }

                  $('#clusterStart').on('click', function (e) {
                    var str = "";
                    if (clusterState == "Ready") {
                      str = "The cluster is already in the Ready state; resetting the Idle timer...";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(4);
                                         }
                                       }
                                     ]);
                    } else {
                      str = "Are you sure you want to start the cluster?<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                                                                        changeClusterState(4);
                                                                                    }
                                       },
                                      {
                                        "label" : "No",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                  });
                  $('#clusterStop').on('click', function (e) {
                    var str = "";

                    if (    (clusterState == "Ready")
                         || ((clusterState == "Starting" || clusterState == "Initializing") && (clusterStatus == "Error"))) {
                      str = "Are you sure you want to stop the cluster?<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(5);
                                         }
                                       },
                                      {
                                        "label" : "No",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                    else {
                      str = "The cluster is neither running nor in an Error state.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    }
                  });

                  $('#clusterReInit').on('click', function (e) {
                    var str = "";
                    if ((clusterState != "Ready") && (clusterState != "Initializing")) {
                      str = "The cluster is not running.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      str = "The instructor's init script will be run on the cluster.<br><br><strong>Warning:</strong> This operation will <strong>re-format</strong> the namenode.<br><br>Click Ok to start the operation or Cancel to quit.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(2);
                                         }
                                       },
                                      {
                                        "label" : "Cancel",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                  });
                  $('#clusterTerminate').on('click', function (e) {
                    var str = "";
                    if (clusterState == "None") {
                      str = "The cluster is not running.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      str = "Are you sure you want to terminate the cluster?<br><br><strong>Warning:</strong> This operation <strong>cannot</strong> be undone.<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(6);
                                         }
                                       },
                                       {
                                         "label" : "No",
                                         "class" : "btn vocbtn-ac vocbtn-status"
                                       }
                                     ]);
                    }
                  });
                    
                  function showClouderaUI(type)
                  {
                    var str = "";
                    if (clusterState != 'Ready') {
                      str = "The cluster is not running at this time.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      if (clusterExtIp == "Unknown") {
                        str = "Could not determine cluster ip address";
                        bootbox.dialog(str,
                                       [
                                         {
                                           "label" : "Ok",
                                           "class" : "btn vocbtn-ac vocbtn-action",
                                         }
                                       ]);
                      } else {
                        if (type == "ssh") {
                          wcSendSshCmd();
                        }
                        else if (type == "manager") {
                          window.open("http://" + clusterExtIp + ":7180");
                        }
                        else {
                          window.open("http://" + clusterExtIp + ":8889");
                        }
                      }
                    }
                    $('#actionsdropdown_liactions2').parent().removeClass('open');
                  }

                  $(".clouderaButton").click(function() {
                    var $type = $(this).data("command");
                    showClouderaUI($type);
                  });


                  var last_saved_ide_indent = 4;
                  var last_saved_ide_t2s = "1";
                  
                  function saveIdeOptions()
                  {
                                        return;
                                        var ind = $("#ide_indent_size").find("option:selected").text();
                    var t2s = 0;
                    if ($('#ide_tab_to_spaces').is(':checked')) {
                      t2s = 1;
                    }
                    if ((ind != last_saved_ide_indent) || (t2s != last_saved_ide_t2s))
                    {
                      if (ind != last_saved_ide_indent)
                      {
                        last_saved_ide_indent = ind;
                        editor.setOption("indentUnit", last_saved_ide_indent);
                      }
                      if (t2s != last_saved_ide_t2s)
                      {
                        last_saved_ide_t2s = t2s;
                        if (t2s == 0)
                        {
                          editor.setOption("extraKeys", { Tab: vocDefaultTab });
                        }
                        else
                        {
                          editor.setOption("extraKeys", { Tab: vocBetterTab });
                        }
                      }
                      
                      var jqxhr = $.ajax('../util/vcput.php?a=saveIdeOptions'
                                       + '&stepid='+ 890070                                       + '&userid='+ 1975667                                       + '&indent_size=' + ind
                                       + '&tab_to_spaces=' + t2s)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Saving of IDE data failed: " + result['msg'], true);
                                         }
				       } catch(err) {
                                         show_voc_gritter(false, "Saving of IDE data 1 failed", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR) {
                                     show_voc_gritter(false, "Saving of IDE data 2 failed", true);
                                   });
                      
                    }
                  }
                  
                  $('#actionsdropdown_liactions2').on('click', function (event) {
                    if ($('#actionsdropdown_liactions2').parent().hasClass('open'))
                    {
                      saveIdeOptions();
                    }
                    $(this).parent().toggleClass('open');
                  });

                  $('body').on('click', function (e) {
                    if (  !$('#liactions2').is(e.target)
                        && ($('#liactions2').has(e.target).length === 0)
                        && ($('.open').has(e.target).length === 0))
                    {
                      if ($('#actionsdropdown_liactions2').parent().hasClass('open'))
                      {
                        $('#actionsdropdown_liactions2').parent().removeClass('open');
                        saveIdeOptions();
                      }
                    }
                  });

                  $( document ).ready(function() {
                                          $('.linux_app').removeClass('disabled');
                                      });

                  function wcSetupTerminal()
                  {
                    // send the ssh cmd
                    // first check of terminal is still open
                    //     if yes - send cmd
                    //     if not - start it
                    var telement = document.getElementById('terminalIframe');
                    if (! telement.contentWindow.vocTerminalIsAvailable())
                    {
                      telement.contentWindow.vocStartTerminal();
                    }
                    else
                    {
                      telement.contentWindow.executeCommand(wcClusterSshCmd);
                    }
                  }

                  var wcShowClusterState = 'Unknown';
                  var wcClusterWaitAvgTime = 0;
                  var wcClusterTimeElapsed = 0;
                  var wcClusterShowProgressTimeout;

                  function wcPeriodicCheckClusterState()
                  {
                    getClusterState();
                    // has the state changed? the above function is non-blocking so we'll see it next time around
                    if (wcShowClusterState != showClusterState)
                    {
                      wcShowClusterState = showClusterState;
                      $('#waitCluster_header').text("Cluster: " + wcShowClusterState);
                      // state changed
                      // if Ready state, great
                      // otherwise it's Error state - what to do?? Show msg and "Ok" button
                      if (clusterStatus == 'Error')
                      {
                        $('#waitClusterMsg').text("There was an error starting your cluster; please terminate it and try again.");
                        $('#waitClusterButton').prop('disabled', false);
                      }
                      else
                      {
                        switch (clusterState)
                        {
                          case "Ready":
                            clearTimeout(wcClusterShowProgressTimeout);
                            wcSetProgressBar(100);
                            $('#waitClusterMsg').text("Your cluster is now ready for use.");
                            $('#waitClusterButton').prop('disabled', false);
                            wcSetupTerminal();
                            break;

                          case "Starting":
                          case "Initializing":
                          case "Launching":
                            setTimeout(wcPeriodicCheckClusterState, 3000);
                            break;

                          default:
                            $('#waitClusterMsg').text("The cluster is in an unexpected state; please terminate it and try again.");
                            clearTimeout(wcClusterShowProgressTimeout);
                            $('#waitClusterButton').prop('disabled', false);
                            break;
                        }
                      }
                    }
                    else
                    {
                      setTimeout(wcPeriodicCheckClusterState, 3000);
                    }
                  }

                  function wcSetProgressBar(val)
                  {
                    $progressBar = $('#waitClusterProgress');
                    $progressBar
                      .attr('data-percent', val + '%')
                      .find('.bar')
                      .css({
                        width: val + '%'
                      });
                  }

                  function wcPeriodicShowProgress()
                  {
                    wcClusterTimeElapsed += 0.5;
                    wcClusterWaitProgress = Math.floor(100 * wcClusterTimeElapsed / wcClusterWaitAvgTime);
                    if (wcClusterWaitProgress >= 100) { wcClusterWaitProgress = 99; } // 100 will be set when the state changes
                    wcSetProgressBar(wcClusterWaitProgress);
                    wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                  }
                  
                  function wcShowModal(clusterState)
                  {
                    // should we show the progress bar or the spinner?
                    wcClusterWaitAvgTime = 0;
                    switch (clusterState)
                    {
                      case "Terminated":
                      case "Launching":
                      case "None":
                        wcClusterWaitAvgTime = clusterLaunchTimeAvg;
                        break;

                      case "Stopped":
                      case "Starting":
                        wcClusterWaitAvgTime = clusterRestartTimeAvg;
                        break;
                    }
                    if (wcClusterWaitAvgTime > 0)
                    {
                      if (  (clusterState == "Launching")
                         || (clusterState == "Starting") )
                      {
                        if ((clusterActionTimeElapsed > 0) && (clusterActionTimeElapsed < wcClusterWaitAvgTime))
                        {
                          wcClusterTimeElapsed = clusterActionTimeElapsed;
                        }
                        else
                        {
                          wcClusterTimeElapsed = 0;
                        }
                      }
                      $('#waitClusterProgress').show();
                      $('#waitClusterSpinner').hide();
                      wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                    }
                    else
                    {
                      $('#waitClusterSpinner').show();
                      $('#waitClusterProgress').hide();
                    }

                    $('#waitCluster').modal();
                    // start the monitoring process
                    setTimeout(wcPeriodicCheckClusterState, 2000);
                  }
                  
                  function wcCheckForClusterState()
                  {
                    if (clusterState == "Unknown")
                    {
                      setTimeout(wcCheckForClusterState, 500);
                      return;
                    }
                    wcShowClusterState = showClusterState;
                    $('#waitCluster_header').text("Cluster: " + wcShowClusterState);

                    // If the state is Stopped/Terminated/Launching/Starting/Initializing, bring up modal
                    // If state is Stopped/Terminate, start cluster
                    switch (clusterState)
                    {
                      case "Stopped":
                      case "Terminated":
                      case "None":
                        changeClusterState(4);
                        if (clusterState == "Stopped")
                        {
                          stateStr = "Starting";
                        }
                        else
                        {
                          stateStr = "Launching";
                        }
                        $('#waitCluster_header').text("Cluster: " + stateStr);
                        wcShowModal(clusterState);
                        break;
                      case "Starting":
                      // case "Initializing":
                      case "Launching":
                        wcShowModal(clusterState);
                        break;
                    }
                  }

                  var wcSshWait = 0;
                  var wcClusterSshCmdWaitMax = 6;

                  function wcWaitForSshCmd()
                  {
                    while ((wcClusterSshCmd == '') && (wcSshWait < wcClusterSshCmdWaitMax))
                    {
                      wcSshWait += 1;
                      setTimeout(wcWaitForSshCmd, 500);
                    }
                    if (wcClusterSshCmd == '')
                    {
                      str = "Unable to determine cluster ssh cmd; please try again in a few seconds.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    }
                  }

                  function wcSendSshCmd()
                  {
                    if (wcClusterSshCmd != '')
                    {
                      document.getElementById('terminalIframe').contentWindow.executeCommand(wcClusterSshCmd);
                    }
                    else
                    {
                      wcSshWait = 0;
                      showclusteract(false);
                      setTimeout(wcWaitForSshCmd, 500);
                    }
                  }

                  function wcTestLater()
                  {
                    clearTimeout(wcClusterShowProgressTimeout);
                    wcSetProgressBar(100);
                    wcSendSshCmd();
                    $('#waitClusterMsg').text("Your cluster is now ready for use.");
                    $('#waitClusterButton').prop('disabled', false);
                  }
                  function wcTestSetupProgress()
                  {
                    // setup the variables and show the progress bar
                    wcClusterTimeElapsed = 0;
                    wcClusterWaitAvgTime = 8;
                    $('#waitClusterProgress').show();
                    wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                  }
                  function wcTest()
                  {
                    if (1)
                    {
                      $('#waitClusterSpinner').hide();
                      wcTestSetupProgress();
                    }
                    else
                    {
                      $('#waitClusterSpinner').show();
                      $('#waitClusterProgress').hide();
                    }
                    $('#waitCluster').modal();
                    setTimeout(wcTestLater, 20000);
                  }

                  function wcStartCluster()
                  {
                    // wcTest();
                    getClusterState();
                    setTimeout(wcCheckForClusterState, 500);                    
                  }

                  function wcAutoStartCluster()
                  {
                    // need to reset the modal elements first
                    $('#waitCluster_header').text("Cluster");
                    $('#waitClusterMsg').text("Your cluster is being started. This operation may take a few minutes.");
                    $('#waitClusterButton').prop('disabled', true);
                    wcClusterTimeElapsed = 0;
                    wcSetProgressBar(0);
                    setTimeout(wcStartCluster, 1000);
                  }

	          $(document).ready(function() {   
                                        
                  });
	</script>
	

	



                </div>
            </div>
        
    

    <div id="push"></div>

    <!--[if lte IE 8]>
    <script src="../shared/ace/assets/js/excanvas.min.js"></script>
    <![endif]-->


    <script src="main_data/ace-elements.js"></script>
    <!-- <script src="../shared/ace/assets/js/jquery.autosize-min.js"></script> -->
    <script src="main_data/jquery.js"></script>

    <!-- functions start : remove unused ones -->

    <script type="text/javascript"> <!-- PCHECK -->


      function voc_set_tabindex() {
        console.log("voc_set_tabindex");
        $(".vocelem").each(function (i) {
          $(this).attr('tabindex', i + 1);
          console.log($(this));
        });
      }

      $('#navbar-inner-div').off('keydown');
      $('#navbar-inner-div').attach_accesible_handler();

      $(function () {

          
        $('textarea[class*=autosize]').autosize({append: "\n"});

        $('#accordion2').on('hide', function (e) {
          $(e.target).prev().children(0).addClass('collapsed');
        })
        $('#accordion2').on('hidden', function (e) {
          $(e.target).prev().children(0).addClass('collapsed');
        })
        $('#accordion2').on('show', function (e) {
          $(e.target).prev().children(0).removeClass('collapsed');
        })
        $('#accordion2').on('shown', function (e) {
          $(e.target).prev().children(0).removeClass('collapsed');
        })

        $('#accordion-style').on('click', function (ev) {
          var target = $('input', ev.target);
          var which = parseInt(target.val());
          if (which == 2) $('#accordion').addClass('accordion-style2');
          else $('#accordion').removeClass('accordion-style2');
        });

        var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
        $('.easy-pie-chart.percentage').each(function () {
          $(this).easyPieChart({
            barColor: $(this).data('color'),
            trackColor: '#EEEEEE',
            scaleColor: false,
            lineCap: 'butt',
            lineWidth: 8,
            animate: oldie ? false : 1000,
            size: 75
          }).css('color', $(this).data('color'));
        });

        $('[data-rel=tooltip]').tooltip();
        $('[data-rel=popover]').popover({html: true});


        $('#gritter-regular').on(ace.click_event, function () {
          $.gritter.add({
            title: 'This is a regular notice!',
            text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="blue">magnis dis parturient</a> montes, nascetur ridiculus mus.',
            image: $assets + '/avatars/avatar1.png',
            sticky: false,
            time: '',
            class_name: (!$('#gritter-light').get(0).checked ? 'gritter-light' : '')
          });

          return false;
        });

        $('#gritter-sticky').on(ace.click_event, function () {
          var unique_id = $.gritter.add({
            title: 'This is a sticky notice!',
            text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="red">magnis dis parturient</a> montes, nascetur ridiculus mus.',
            image: $assets + '/avatars/avatar.png',
            sticky: true,
            time: '',
            class_name: 'gritter-info' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
          });

          return false;
        });


        $('#gritter-without-image').on(ace.click_event, function () {
          $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'This is a notice without an image!',
            // (string | mandatory) the text inside the notification
            text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="orange">magnis dis parturient</a> montes, nascetur ridiculus mus.',
            class_name: 'gritter-success' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
          });

          return false;
        });


        $('#gritter-max3').on(ace.click_event, function () {
          $.gritter.add({
            title: 'This is a notice with a max of 3 on screen at one time!',
            text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="green">magnis dis parturient</a> montes, nascetur ridiculus mus.',
            image: $assets + '/avatars/avatar3.png',
            sticky: false,
            before_open: function () {
              if ($('.gritter-item-wrapper').length >= 3) {
                return false;
              }
            },
            class_name: 'gritter-warning' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
          });

          return false;
        });


        $('#gritter-center').on(ace.click_event, function () {
          $.gritter.add({
            title: 'This is a centered notification',
            text: 'Just add a "gritter-center" class_name to your $.gritter.add or globally to $.gritter.options.class_name',
            class_name: 'gritter-info gritter-center' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
          });

          return false;
        });

        $('#gritter-error').on(ace.click_event, function () {
          $.gritter.add({
            title: 'This is a warning notification',
            text: 'Just add a "gritter-light" class_name to your $.gritter.add or globally to $.gritter.options.class_name',
            class_name: 'gritter-error' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
          });

          return false;
        });


        $("#gritter-remove").on(ace.click_event, function () {
          $.gritter.removeAll();
          return false;
        });


        ///////


        $("#bootbox-regular").on(ace.click_event, function () {
          bootbox.prompt("What is your name?", function (result) {
            if (result === null) {
              //Example.show("Prompt dismissed");
            } else {
              //Example.show("Hi <b>"+result+"</b>");
            }
          });
        });

        $("#bootbox-confirm").on(ace.click_event, function () {
          bootbox.confirm("Are you sure?", function (result) {
            if (result) {
              bootbox.alert("You are sure!");
            }
          });
        });

        $("#bootbox-options").on(ace.click_event, function () {
          bootbox.dialog("I am a custom dialog with smaller buttons", [{
              "label": "Success!",
              "class": "btn-small btn-success",
              "callback": function () {
                //Example.show("great success");
              }
            }, {
              "label": "Danger!",
              "class": "btn-small btn-danger",
              "callback": function () {
                //Example.show("uh oh, look out!");
              }
            }, {
              "label": "Click ME!",
              "class": "btn-small btn-primary",
              "callback": function () {
                //Example.show("Primary button");
              }
            }, {
              "label": "Just a button...",
              "class": "btn-small"
            }]
          );
        });


        $('#spinner-opts small').css({display: 'inline-block', width: '60px'})

        var slide_styles = ['', 'green', 'red', 'purple', 'orange', 'dark'];
        var ii = 0;
        $("#spinner-opts input[type=text]").each(function () {
          var $this = $(this);
          $this.hide().after('<span />');
          $this.next().addClass('ui-slider-small').addClass("inline ui-slider-" + slide_styles[ii++ % slide_styles.length]).css({'width': '125px'}).slider({
            value: parseInt($this.val()),
            range: "min",
            animate: true,
            min: parseInt($this.data('min')),
            max: parseInt($this.data('max')),
            step: parseFloat($this.data('step')),
            slide: function (event, ui) {
              $this.attr('value', ui.value);
              spinner_update();
            }
          });
        });


        $.fn.spin = function (opts) {
          this.each(function () {
            var $this = $(this),
              data = $this.data();

            if (data.spinner) {
              data.spinner.stop();
              delete data.spinner;
            }
            if (opts !== false) {
              data.spinner = new Spinner($.extend({color: $this.css('color')}, opts)).spin(this);
            }
          });
          return this;
        };

        function spinner_update() {
          var opts = {};
          $('#spinner-opts input[type=text]').each(function () {
            opts[this.name] = parseFloat(this.value);
          });
          $('#spinner-preview').spin(opts);
        }


        $('#id-pills-stacked').removeAttr('checked').on('click', function () {
          $('.nav-pills').toggleClass('nav-stacked');
        });


      });
    </script>
    <!-- functions end -->


    <!-- it might be used by both TA and grader so putting it under main.php -->
    <script>
      function hideNamesOnDashboard() {
        $('.studentNameDashboard').addClass('hidden-1');
        $('.anonymousInfoDashboard').removeClass('hidden-1');
      }

      function showNamesOnDashboard() {
        $('.studentNameDashboard').removeClass('hidden-1');
        $('.anonymousInfoDashboard').addClass('hidden-1');
      }

      $('#showHideStudentNameDashboard').on('click', function () {
        if ($(this).text() == 'Hide Names') {
          hideNamesOnDashboard();
          $(this).html('Show Names');
          hideNamesDashboard = 1;
        } else {
          showNamesOnDashboard();
          $(this).html('Hide Names');
          hideNamesDashboard = 0;
        }
      });
    </script>

    <script defer="defer" src="main_data/v652eace1692a40cfa3763df669d7439c1639079717194" integrity="sha512-Gi7xpJR8tSkrpF7aordPZQlW2DLtzUlZcumS8dMQjwDHEnw9I7ZLyiOj/6tZStRBGtGgN6ceN6cMH8z7etPGlw==" data-cf-beacon="{&quot;rayId&quot;:&quot;70bc285a4b108df1&quot;,&quot;token&quot;:&quot;a73834a4a1444e9ab89e8da06da41720&quot;,&quot;version&quot;:&quot;2021.12.0&quot;,&quot;si&quot;:100}" crossorigin="anonymous"></script>

    
<div id="cboxOverlay" style="display: none;"></div><div id="colorbox" class="" role="dialog" tabindex="-1" style="display: none;"><div id="cboxWrapper"><div><div id="cboxTopLeft" style="float: left;"></div><div id="cboxTopCenter" style="float: left;"></div><div id="cboxTopRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxMiddleLeft" style="float: left;"></div><div id="cboxContent" style="float: left;"><div id="cboxTitle" style="float: left;"></div><div id="cboxCurrent" style="float: left;"></div><button type="button" id="cboxPrevious"></button><button type="button" id="cboxNext"></button><button id="cboxSlideshow"></button><div id="cboxLoadingOverlay" style="float: left;"></div><div id="cboxLoadingGraphic" style="float: left;"></div></div><div id="cboxMiddleRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxBottomLeft" style="float: left;"></div><div id="cboxBottomCenter" style="float: left;"></div><div id="cboxBottomRight" style="float: left;"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div><textarea tabindex="-1" style="position: absolute; inset: -999px auto auto 0px; border: 0px none; box-sizing: content-box; overflow-wrap: break-word; height: 0px !important; min-height: 0px !important; overflow: hidden; transition: none 0s ease 0s;"></textarea></body></html>